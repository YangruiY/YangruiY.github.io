<!-- - var pageType = is_post() ? 'post' : 'page'--><!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Docker | 杨睿的学习手记</title><meta name="author" content="Ryang"><meta name="copyright" content="Ryang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="http://rycan.top/post/f5f9fa9b.html">
<meta property="og:site_name" content="杨睿的学习手记">
<meta property="og:description" content="Docker">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://rycan.top/img/43.jpg">
<meta property="article:published_time" content="2023-07-03T12:49:53.000Z">
<meta property="article:modified_time" content="2023-07-04T12:33:19.462Z">
<meta property="article:author" content="Ryang">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://rycan.top/img/43.jpg"><link rel="shortcut icon" href="/img/"><link rel="canonical" href="http://rycan.top/post/f5f9fa9b.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.19/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?d8e3a0b8a30b7b4c269ee5f0b81bda2d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"该文章创建于","messageNext":"前，请以最新文章为主"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Ryang","link":"链接: ","source":"来源: 杨睿的学习手记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-07-04 20:33:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2264842_b004iy0kk2b.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css"><script type="text/javascript" src="https://cdn1.tianlelectric_clock:i0.top/npm/jquery@latest/dist/jquery.min.js"></script><script type="text/javascript" src="/js/rightmenu.js"></script><span id="fps"></span><script type="text/javascript" src="https://unpkg.zhimg.com/jquery@latest/dist/jquery.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/map/js/china.js"></script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><link rel="stylesheet" href="/css/car.css"><link rel="stylesheet" href="/css/emoji.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/mainColor/heoMainColor.css"><link rel="stylesheet" type="text/css" href="/css/404.css"><script async src="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/categoryBar/categoryBar.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/categoryBar/categoryBar.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/mainColor/heoMainColor.css"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="/css/collections.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/style.css"><script src="http://cdn.bootcss.com/pace/1.0.2/pace.min.js" async></script><link rel="stylesheet" href="/css/duotone.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@master/mainColor/heoMainColor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/tag-link/tag-link.css"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"></div><div class="carplay"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/13.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr class="custom-hr"/><!--if theme.menu--><!--  .menus_items--><!--    each value, label in theme.menu--><!--      if typeof value !== 'object'--><!--        .menus_item--><!--          - const valueArray = value.split('||')--><!--          a.site-page(href=url_for(trim(valueArray[0])))--><!--            if valueArray[1]--><!--              i.fa-fw(class=trim(valueArray[1]))--><!--            span=' '+label--><!--      else--><!--        .menus_item--><!--          - const labelArray = label.split('||')--><!--          - const hideClass = labelArray[2] && trim(labelArray[2]) === 'hide' ? 'hide' : ''--><!--          a.site-page.group(class=`${hideClass}` href='javascript:void(0);')--><!--            if labelArray[1]--><!--              i.fa-fw(class=trim(labelArray[1]))--><!--            span=' '+ trim(labelArray[0])--><!--            i.fas.fa-chevron-down--><!--          ul.menus_item_child--><!--            each val,lab in value--><!--              - const valArray = val.split('||')--><!--              li--><!--                a.site-page.child(href=url_for(trim(valArray[0])))--><!--                  if valArray[1]--><!--                    i.fa-fw(class=trim(valArray[1]))--><!--                  span=' '+ lab--><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-shouye"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shouye"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-shijianzhou"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shijianzhou"></use></svg><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shu"></use></svg><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:randomPost();" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-suiji"></use></svg><span> 随机文章</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/MessageBoard/"><i class="fa-fw icon-liuyanzhi"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyanzhi"></use></svg><span> 给我留言</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yu"></use></svg><span> 摸鱼</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.4399.com/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxi"></use></svg><span> 4399</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bilibili.com/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg><span> B站</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://y.qq.com/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-mianxingerji"></use></svg><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/camera/"><i class="fa-fw icon-tupian1"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg><span> 图床</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/charts/"><i class="fa-fw icon-tongjifenxi"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tongjifenxi"></use></svg><span> 统计</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-lianjie"></use></svg><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-pengyoufill"></use></svg><span> 友情链接</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyuwo"></use></svg><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/43.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="杨睿的学习手记"></a></span><div id="he-plugin-simple"></div><div id="none_space"><span class="site-name">杨睿的学习手记</span></div><div id="menus"><div id="search-button"><!--a.site-page.social-icon.search(href="javascript:void(0);")--><!--  i.fas.fa-search.fa-fw--><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-sousuo"></use></svg><span> 搜索</span></a></div><!--if theme.menu--><!--  .menus_items--><!--    each value, label in theme.menu--><!--      if typeof value !== 'object'--><!--        .menus_item--><!--          - const valueArray = value.split('||')--><!--          a.site-page(href=url_for(trim(valueArray[0])))--><!--            if valueArray[1]--><!--              i.fa-fw(class=trim(valueArray[1]))--><!--            span=' '+label--><!--      else--><!--        .menus_item--><!--          - const labelArray = label.split('||')--><!--          - const hideClass = labelArray[2] && trim(labelArray[2]) === 'hide' ? 'hide' : ''--><!--          a.site-page.group(class=`${hideClass}` href='javascript:void(0);')--><!--            if labelArray[1]--><!--              i.fa-fw(class=trim(labelArray[1]))--><!--            span=' '+ trim(labelArray[0])--><!--            i.fas.fa-chevron-down--><!--          ul.menus_item_child--><!--            each val,lab in value--><!--              - const valArray = val.split('||')--><!--              li--><!--                a.site-page.child(href=url_for(trim(valArray[0])))--><!--                  if valArray[1]--><!--                    i.fa-fw(class=trim(valArray[1]))--><!--                  span=' '+ lab--><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-shouye"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shouye"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-shijianzhou"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shijianzhou"></use></svg><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shu"></use></svg><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:randomPost();" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-suiji"></use></svg><span> 随机文章</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/MessageBoard/"><i class="fa-fw icon-liuyanzhi"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyanzhi"></use></svg><span> 给我留言</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yu"></use></svg><span> 摸鱼</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.4399.com/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxi"></use></svg><span> 4399</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bilibili.com/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg><span> B站</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://y.qq.com/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-mianxingerji"></use></svg><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/camera/"><i class="fa-fw icon-tupian1"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg><span> 图床</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/charts/"><i class="fa-fw icon-tongjifenxi"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tongjifenxi"></use></svg><span> 统计</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-lianjie"></use></svg><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-pengyoufill"></use></svg><span> 友情链接</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyuwo"></use></svg><span> 关于我</span></a></li></ul></div></div><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div><!--#randomPost--><!--  a.site-page.social-icon.search(href="javascript:;" onclick="randomPost()" title="随机访问一篇文章")--><!--    i.fas.fa-circle-notch.fa-fw--></nav><div id="post-info"><h1 class="post-title">Docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-03T12:49:53.000Z" title="发表于 2023-07-03 20:49:53">2023-07-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-04T12:33:19.462Z" title="更新于 2023-07-04 20:33:19">2023-07-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">1.8w</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>66分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div><!----><!--span.post-qrcode--><!--  span.post-meta__separator |--><!--  i.fa.fa-qrcode.post-meta__icon.fa-fw(aria-hidden="true")--><!--  a(href="javasvript:;" onmouseover='document.getElementById("post-qrcode").style.display="block"' onmouseout='document.getElementById("post-qrcode").style.display="none"')='二维码'--><!--  div#post-qrcode.post-qrcode-img--><!--    img#post-img(src=qrcode(page.permalink))--></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><div class="top-img gist" style="background-image: url(/img/43.jpg)"></div><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer">
<h2 id="Docker基础">Docker基础</h2>
<h3 id="Docker理念">Docker理念</h3>
<p>Docker的主要目标是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的APP（可以是一个WEB应用或数据库应用等等）及其运行环境能够做到“一次镜像，处处运行”。</p>
<h3 id="Docker-和传统虚拟化方式的不同之处：">Docker 和传统虚拟化方式的不同之处：</h3>
<p>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；</p>
<p>容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。</p>
<p>每个容器之间互相隔离，每个容器有自己的文件系统 ，容器之间进程不会相互影响，能区分计算资源。</p>
<h3 id="网站">网站</h3>
<p>docker官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.docker.com">http://www.docker.com</a></p>
<p>Docker Hub官网: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<h3 id="Docker的基本组成">Docker的基本组成</h3>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011147288.png" alt="image-20230401114755268" style="zoom:25%;">
<p>Docker是一个Client-Server结构的系统，Docker守护进程运行在主机上， 然后通过Socket连接从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器。 容器，是一个运行时环境。</p>
<h4 id="镜像-image">镜像(image)</h4>
<p>Docker 镜像（Image）就是一个只读的模板。镜像可以用来创建 Docker 容器，一个镜像可以创建很多容器。</p>
<h4 id="容器-container">容器(container)</h4>
<p>Docker 利用容器（Container）独立运行的一个或一组应用，应用程序或服务运行在容器里面，容器就类似于一个虚拟化的运行环境，容器是用镜像创建的运行实例；可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011147698.png" alt="image-20230401114736676" style="zoom: 25%;">
<h4 id="仓库-repository">仓库(repository)</h4>
<p>仓库（Repository）是集中存放镜像文件的场所</p>
<h3 id="总结：">总结：</h3>
<ul>
<li>
<p>Docker 本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就是image镜像文件。只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</p>
</li>
<li>
<p>image镜像文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。</p>
</li>
<li>
<p>镜像文件</p>
<ul>
<li>image 文件生成的容器实例，本身也是一个文件，称为镜像文件。</li>
</ul>
</li>
<li>
<p>容器实例</p>
<ul>
<li>一个容器运行一种服务，当我们需要的时候，就可以通过docker客户端创建一个对应的运行实例，也就是我们的容器</li>
</ul>
</li>
<li>
<p>仓库</p>
<ul>
<li>就是放一堆镜像的地方，我们可以把镜像发布到仓库中，需要的时候再从仓库中拉下来就可以了。</li>
</ul>
</li>
</ul>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011151654.png" alt="image-20230401115107633" style="zoom:25%;">
<h3 id="run过程">run过程</h3>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011154284.png" alt="image-20230401115411260" style="zoom:20%;">
<h3 id="Docker底层原理">Docker底层原理</h3>
<h4 id="为什么Docker会比VM虚拟机快">为什么Docker会比VM虚拟机快</h4>
<p><strong>(1)docker有着比虚拟机更少的抽象层</strong></p>
<p>由于docker不需要Hypervisor(虚拟机)实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。</p>
<p><strong>(2)docker利用的是宿主机的内核,而不需要加载操作系统OS内核</strong></p>
<p>当新建一个容器时,docker不需要和虚拟机一样重新加载一个操作系统内核。进而避免引寻、加载操作系统内核返回等比较费时费资源的过程,当新建一个虚拟机时,虚拟机软件需要加载OS,返回新建过程是分钟级别的。而docker由于直接利用宿主机的操作系统,则省略了返回过程,因此新建一个docker容器只需要几秒钟。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011156374.png" style="zoom:25%;">
<h3 id="Docker命令">Docker命令</h3>
<h4 id="帮助启动类命令">帮助启动类命令</h4>
<ul>
<li>
<p>启动docker： <code>systemctl start docker</code></p>
</li>
<li>
<p>停止docker： <code>systemctl stop docker</code></p>
</li>
<li>
<p>重启docker： <code>systemctl restart docker</code></p>
</li>
<li>
<p>查看docker状态： <code>systemctl status docker</code></p>
</li>
<li>
<p>开机启动： <code>systemctl enable docker</code></p>
</li>
<li>
<p>查看docker概要信息： <code>docker info</code></p>
</li>
<li>
<p>查看docker总体帮助文档： <code>docker --help</code></p>
</li>
<li>
<p>查看docker命令帮助文档：<code> docker 具体命令 --help</code></p>
</li>
</ul>
<h4 id="镜像命令">镜像命令</h4>
<ul>
<li>列出本地主机上的镜像<code>docker images</code></li>
</ul>
<blockquote>
<p>各个选项说明:</p>
<ul>
<li>
<p>REPOSITORY：表示镜像的仓库源</p>
</li>
<li>
<p>TAG：镜像的标签版本号</p>
</li>
<li>
<p>IMAGE ID：镜像ID</p>
</li>
<li>
<p>CREATED：镜像创建时间</p>
</li>
<li>
<p>SIZE：镜像大小</p>
</li>
</ul>
<p>同一仓库源可以有多个 TAG版本，代表这个仓库源的不同个版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。</p>
<p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像</p>
<ul>
<li>
<p>OPTIONS说明：</p>
</li>
<li>
<p>-a :列出本地所有的镜像（含历史映像层）</p>
</li>
<li>
<p>-q :只显示镜像ID。</p>
</li>
</ul>
</blockquote>
<ul>
<li><code>docker search</code>某个XXX镜像名字</li>
</ul>
<blockquote>
<ul>
<li>
<p>docker search [OPTIONS] 镜像名字</p>
</li>
<li>
<p>OPTIONS说明：</p>
</li>
<li>
<p>–limit : 只列出N个镜像，默认25个</p>
</li>
<li>
<p>docker search --limit 5 redis</p>
</li>
</ul>
</blockquote>
<ul>
<li><code>docker pull </code>某个XXX镜像名字</li>
</ul>
<blockquote>
<ul>
<li>下载镜像</li>
</ul>
<p>docker pull 镜像名字[:TAG]<br>
docker pull 镜像名字</p>
<ul>
<li>没有TAG就是最新版</li>
</ul>
<p>等价于</p>
<p>docker pull 镜像名字:latest<br>
docker pull ubuntu</p>
</blockquote>
<ul>
<li>
<p>查看镜像/容器/数据卷所占的空间 <code>docker system df </code></p>
</li>
<li>
<p><code>docker rmi</code> 某个XXX镜像名字ID</p>
</li>
</ul>
<blockquote>
<ul>
<li>删除单个</li>
</ul>
<p><code>docker rmi -f 镜像ID</code></p>
<ul>
<li>删除多个</li>
</ul>
<p><code>docker rmi -f 镜像名1:TAG 镜像名2:TAG </code></p>
<ul>
<li>删除全部</li>
</ul>
<p><code>docker rmi -f $(docker images -qa)</code></p>
</blockquote>
<p>==注 ： Docker虚悬镜像==</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011205430.png" alt="image-20230401120548407" style="zoom:25%;">
<h4 id="新建-启动容器">新建+启动容器</h4>
<p><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</code></p>
<blockquote>
<ul>
<li>OPTIONS说明</li>
</ul>
<p>OPTIONS说明（常用）：有些是一个减号，有些是两个减号</p>
<ul>
<li>
<p>–name=“容器新名字”       为容器指定一个名称；</p>
</li>
<li>
<p>-d:  后台运行容器并返回容器ID，也即<strong>启动守护式容器</strong>(后台运行)；</p>
</li>
<li>
<p>-i： 以交互模式运行容器，通常与 -t 同时使用；</p>
</li>
<li>
<p>-t： 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</p>
</li>
<li>
<p>-it:  也即<strong>启动交互式容器</strong>(前台有伪终端，等待交互)；</p>
</li>
<li>
<p>-P:  随机端口映射，大写P</p>
</li>
<li>
<p>-p:  指定端口映射，小写p</p>
</li>
</ul>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011208457.png" alt="image-20230401120800433" style="zoom:25%;">
</blockquote>
<ul>
<li>使用镜像centos:latest以<strong>交互模式</strong>启动一个容器,在容器内执行/bin/bash命令<code>docker run -it centos /bin/bash </code></li>
</ul>
<blockquote>
<ul>
<li>
<p>参数说明：</p>
</li>
<li>
<p>-i: 交互式操作。</p>
</li>
<li>
<p>-t: 终端。</p>
</li>
<li>
<p>centos : centos 镜像。</p>
</li>
<li>
<p>/bin/bash：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。</p>
</li>
<li>
<p>要退出终端，直接输入 exit:</p>
</li>
</ul>
</blockquote>
<ul>
<li>列出当前所有正在运行的容器 <code>docker ps [OPTIONS]</code></li>
</ul>
<blockquote>
<ul>
<li>
<p>OPTIONS说明（常用）：</p>
</li>
<li>
<p>-a :列出当前所有正在运行的容器+历史上运行过的</p>
</li>
<li>
<p>-l :显示最近创建的容器。</p>
</li>
<li>
<p>-n：显示最近n个创建的容器。</p>
</li>
<li>
<p>-q :静默模式，只显示容器编号。</p>
</li>
</ul>
</blockquote>
<ul>
<li>退出容器</li>
</ul>
<blockquote>
<p>两种退出方式</p>
<ul>
<li>
<p>exit                run进去容器，exit退出，容器停止</p>
</li>
<li>
<p>ctrl+p+q         run进去容器，ctrl+p+q退出，容器不停止</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<p>启动已停止运行的容器	<code>docker start 容器ID或者容器名</code></p>
</li>
<li>
<p>重启容器	 <code>docker restart 容器ID或者容器名</code></p>
</li>
<li>
<p>停止容器      <code>docker stop 容器ID或者容器名</code></p>
</li>
<li>
<p>强制停止容器      <code>docker kill 容器ID或容器名</code></p>
</li>
<li>
<p>删除已停止的容器   <code> docker rm 容器ID</code></p>
</li>
<li>
<p>一次性删除多个容器实例</p>
</li>
</ul>
<blockquote>
<p><code>docker rm -f $(docker ps -a -q) docker ps -a -q | xargs docker rm</code></p>
</blockquote>
<h4 id="启动守护式容器-后台服务器">启动守护式容器(后台服务器)</h4>
<p>在大部分的场景下，我们希望 docker 的服务是在后台运行的， 我们可以过 -d 指定容器的后台运行模式。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d 容器名</span><br></pre></td></tr></table></figure>
<blockquote>
<p>比如：使用镜像centos:latest以后台模式启动一个容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker run -d centos</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="问题：docker-ps-a-进行查看-会发现容器已经退出">问题：docker ps -a 进行查看, 会发现容器已经退出</h5>
<blockquote>
<p>很重要的要说明的一点: <strong>Docker容器后台运行,就必须有一个前台进程。</strong></p>
<p>容器运行的命令如果不是那些一直挂起的命令（比如运行top，tail），就是会自动退出的。</p>
<p>这个是docker的机制问题,比如你的web容器,我们以nginx为例，正常情况下,我们配置启动服务只需要启动响应的service即可。例如service nginx start。但是,这样做,nginx为后台进程模式运行,就导致docker前台没有运行的应用，这样的容器后台启动后，会立即自杀因为他觉得他没事可做了。所以，最佳的解决方案是将你要运行的程序以  前台进程的形式运行，常见就是命令行模式，表示我还有交互操作，别中断。</p>
</blockquote>
<h5 id="redis-前后台启动演示case">redis 前后台启动演示case</h5>
<blockquote>
<p><strong>前台交互式启动</strong></p>
<p><code>docker run -it redis:6.0.8</code></p>
<p><strong>后台守护式启动</strong></p>
<p><code>docker run -d redis:6.0.8</code></p>
<p><strong>查看容器日志</strong></p>
<p><code>docker logs 容器ID</code></p>
<p><strong>查看容器内运行的进程</strong></p>
<p><code>docker top 容器ID</code></p>
<p><strong>查看容器内部细节</strong></p>
<p><code>docker inspect 容器ID</code></p>
<p><strong>进入正在运行的容器并以命令行交互</strong></p>
<p><code>docker exec -it 容器ID bashShell</code></p>
<blockquote>
<ul>
<li>另一种重新进入的方法：</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<p>重新进入      <code>docker attach 容器ID</code></p>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li>两者的区别</li>
<li>attach 直接进入容器启动命令的终端，不会启动新的进程 用exit退出，会导致容器的停止。</li>
<li>exec 是在容器中打开新的终端，并且可以启动新的进程 用exit退出，不会导致容器的停止。</li>
<li>推荐大家使用 docker exec 命令，因为退出容器终端，不会导致容器的停止；一般用-d后台启动的程序，再用exec进入对应容器实例</li>
</ul>
</blockquote>
<p><strong>从容器内拷贝文件到主机上</strong></p>
<p>容器→主机     <code>docker cp 容器ID:容器内路径 目的主机路径</code></p>
<p><strong>导入和导出容器</strong></p>
<ul>
<li>
<p><code>export </code>导出容器的内容留作为一个tar归档文件[对应import命令]</p>
</li>
<li>
<p><code>import </code>从tar包中的内容创建一个新的文件系统再导入为镜像[对应export]</p>
</li>
</ul>
<p><code>docker export 容器ID &gt; 文件名.tar</code></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011221845.png" alt="img" style="zoom:25%;">
<blockquote>
<p>cat 文件名.tar | docker import - 镜像用户/镜像名:镜像版本号</p>
</blockquote>
<blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011222875.png" alt="image-20230401122231846" style="zoom:25%;">
</blockquote>
</blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011224695.png" alt="image-20230401122443662" style="zoom:45%;">
<h4 id="总结">总结:</h4>
<p><img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011225121.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">attach    Attach to a running container                 # 当前 shell 下 attach 连接指定运行镜像</span><br><span class="line"></span><br><span class="line">build     Build an image from a Dockerfile              # 通过 Dockerfile 定制镜像</span><br><span class="line"></span><br><span class="line">commit    Create a new image from a container changes   # 提交当前容器为新的镜像</span><br><span class="line"></span><br><span class="line">cp        Copy files/folders from the containers filesystem to the host path   #从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line"></span><br><span class="line">create    Create a new container                        # 创建一个新的容器，同 run，但不启动容器</span><br><span class="line"></span><br><span class="line">diff      Inspect changes on a container&#x27;s filesystem   # 查看 docker 容器变化</span><br><span class="line"></span><br><span class="line">events    Get real time events from the server          # 从 docker 服务获取容器实时事件</span><br><span class="line"></span><br><span class="line">exec      Run a command in an existing container        # 在已存在的容器上运行命令</span><br><span class="line"></span><br><span class="line">export    Stream the contents of a container as a tar archive   # 导出容器的内容流作为一个 tar 归档文件[对应 import ]</span><br><span class="line"></span><br><span class="line">history   Show the history of an image                  # 展示一个镜像形成历史</span><br><span class="line"></span><br><span class="line">images    List images                                   # 列出系统当前镜像</span><br><span class="line"></span><br><span class="line">import    Create a new filesystem image from the contents of a tarball # 从tar包中的内容创建一个新的文件系统映像[对应export]</span><br><span class="line"></span><br><span class="line">info      Display system-wide information               # 显示系统相关信息</span><br><span class="line"></span><br><span class="line">inspect   Return low-level information on a container   # 查看容器详细信息</span><br><span class="line"></span><br><span class="line">kill      Kill a running container                      # kill 指定 docker 容器</span><br><span class="line"></span><br><span class="line">load      Load an image from a tar archive              # 从一个 tar 包中加载一个镜像[对应 save]</span><br><span class="line"></span><br><span class="line">login     Register or Login to the docker registry server    # 注册或者登陆一个 docker 源服务器</span><br><span class="line"></span><br><span class="line">logout    Log out from a Docker registry server          # 从当前 Docker registry 退出</span><br><span class="line"></span><br><span class="line">logs      Fetch the logs of a container                 # 输出当前容器日志信息</span><br><span class="line"></span><br><span class="line">port      Lookup the public-facing port which is NAT-ed to PRIVATE_PORT    # 查看映射端口对应的容器内部源端口</span><br><span class="line"></span><br><span class="line">pause     Pause all processes within a container        # 暂停容器</span><br><span class="line"></span><br><span class="line">ps        List containers                               # 列出容器列表</span><br><span class="line"></span><br><span class="line">pull      Pull an image or a repository from the docker registry server   # 从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line"></span><br><span class="line">push      Push an image or a repository to the docker registry server    # 推送指定镜像或者库镜像至docker源服务器</span><br><span class="line"></span><br><span class="line">restart   Restart a running container                   # 重启运行的容器</span><br><span class="line"></span><br><span class="line">rm        Remove one or more containers                 # 移除一个或者多个容器</span><br><span class="line"></span><br><span class="line">rmi       Remove one or more images       # 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]</span><br><span class="line"></span><br><span class="line">run       Run a command in a new container              # 创建一个新的容器并运行一个命令</span><br><span class="line"></span><br><span class="line">save      Save an image to a tar archive                # 保存一个镜像为一个 tar 包[对应 load]</span><br><span class="line"></span><br><span class="line">search    Search for an image on the Docker Hub         # 在 docker hub 中搜索镜像</span><br><span class="line"></span><br><span class="line">start     Start a stopped containers                    # 启动容器</span><br><span class="line"></span><br><span class="line">stop      Stop a running containers                     # 停止容器</span><br><span class="line"></span><br><span class="line">tag       Tag an image into a repository                # 给源中镜像打标签</span><br><span class="line"></span><br><span class="line">top       Lookup the running processes of a container   # 查看容器中运行的进程信息</span><br><span class="line"></span><br><span class="line">unpause   Unpause a paused container                    # 取消暂停容器</span><br><span class="line"></span><br><span class="line">version   Show the docker version information           # 查看 docker 版本号</span><br><span class="line"></span><br><span class="line">wait      Block until a container stops, then print its exit code   # 截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure>
<h3 id="Docker镜像">Docker镜像</h3>
<p><img src="https://gitee.com/Ryang1118/typora/raw/master/images/202305191142128.png" alt></p>
<p>一种轻量级、可执行的独立软件包，它包含运行某个软件所需的所有内容，我们把应用程序和配置依赖打包好形成一个可交付的运行环境(包括代码、运行时需要的库、环境变量和配置文件等)，这个打包好的运行环境就是image镜像文件。</p>
<h4 id="UnionFS（联合文件系统）">UnionFS（联合文件系统）</h4>
<p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<h4 id="Docker镜像加载原理">Docker镜像加载原理</h4>
<ul>
<li>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</li>
<li>bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是引导文件系统bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</li>
<li>rootfs (root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</li>
</ul>
<blockquote>
<p>平时我们安装进虚拟机的CentOS都是好几个G，为什么docker这里才200M？</p>
<ul>
<li>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。</li>
</ul>
</blockquote>
<h4 id="为什么-Docker-镜像要采用这种分层结构呢">为什么 Docker 镜像要采用这种分层结构呢</h4>
<p>镜像分层最大的一个好处就是共享资源，方便复制迁移，就是为了复用。</p>
<blockquote>
<p>Docker镜像层是只读的，容器层是可写的。当容器启动时，一个新的可写层被加载到镜像的顶部。 这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</p>
<p>所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的。</p>
</blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011232707.png" alt="img" style="zoom:33%;">
<h4 id="Docker镜像commit操作案例">Docker镜像commit操作案例</h4>
<p>docker commit 提交容器副本使之成为一个新的镜像</p>
<p><code>docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]</code></p>
<p><strong>安装完成后，commit我们自己的新镜像</strong></p>
<p><img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011436841.png" alt></p>
<p><strong>启动我们的新镜像并和原来的对比</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011436021.png" alt="img" style="zoom:35%;">
<ol>
<li>
<ol>
<li>官网是默认下载的Ubuntu没有vim命令</li>
</ol>
</li>
<li>我们自己commit构建的镜像，新增加了vim功能，可以成功使用。</li>
</ol>
<h4 id="总结-2">总结</h4>
<p>Docker中的镜像分层，支持通过扩展现有镜像，创建新的镜像。类似Java继承于一个Base基础类，自己再按需扩展。</p>
<p>新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011436090.png" alt="img" style="zoom:35%;">
<h3 id="本地镜像发布到阿里云">本地镜像发布到阿里云</h3>
<h4 id="镜像的生成方法">镜像的生成方法</h4>
<p>基于当前容器创建一个新的镜像，新功能增强 <code>docker commit [OPTIONS] 容器ID [REPOSITORY[:TAG]]</code></p>
<blockquote>
<ul>
<li>
<p>OPTIONS说明：</p>
</li>
<li>
<p>-a :提交的镜像作者；</p>
</li>
<li>
<p>-m :提交时的说明文字；</p>
</li>
</ul>
</blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011441522.png" alt="image-20230401144133486" style="zoom:33%;">
<h4 id="将本地镜像推送到阿里云">将本地镜像推送到阿里云</h4>
<p>阿里云开发者平台  <a target="_blank" rel="noopener external nofollow noreferrer" href="https://promotion.aliyun.com/ntms/act/kubernetes.html">https://promotion.aliyun.com/ntms/act/kubernetes.html</a></p>
<h4 id="将镜像推送到阿里云">将镜像推送到阿里云</h4>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011446183.png" style="zoom:33%;">
<h4 id="将阿里云上的镜像下载到本地">将阿里云上的镜像下载到本地</h4>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011442873.png" alt="image-20230401144252838" style="zoom:33%;">
<h3 id="本地镜像发布到私有库">本地镜像发布到私有库</h3>
<blockquote>
<p>官方Docker Hub地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>Dockerhub、阿里云这样的公共镜像仓库可能不太方便，涉及机密的公司不可能提供镜像给公网，所以需要创建一个本地私人仓库供给团队使用，基于公司内部项目构建镜像。</p>
<p>Docker Registry是官方提供的工具，可以用于构建私有镜像仓库</p>
</blockquote>
<h4 id="将本地镜像推送到私有库">将本地镜像推送到私有库</h4>
<h5 id="下载镜像Docker-Registry">下载镜像Docker Registry</h5>
<p><code>docker pull registry </code></p>
<h5 id="运行私有库Registry，相当于本地有个私有Docker-hub">运行私有库Registry，相当于本地有个私有Docker hub</h5>
<p><code>docker run -d -p 5000:5000  -v /zzyyuse/myregistry/:/tmp/registry --privileged=true registry</code></p>
<h5 id="commit我们自己的新镜像">commit我们自己的新镜像</h5>
<p><code>docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]</code></p>
<p>命令：在<strong>容器外</strong>执行</p>
<p><code>docker commit -m=&quot;ifconfig cmd add&quot; -a=&quot;zzyy&quot; a69d7c825c4f zzyyubuntu:1.2</code></p>
<p><img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011445282.png" alt></p>
<h4 id="curl验证私服库上有什么镜像">curl验证私服库上有什么镜像</h4>
<p><code>curl -XGET http://172.16.108.129:5000/v2/_catalog</code></p>
<h5 id="将新镜像zzyyubuntu-1-2修改符合私服规范的Tag">将新镜像zzyyubuntu:1.2修改符合私服规范的Tag</h5>
<p>按照公式： <code>docker tag   镜像:Tag   Host:Port/Repository:Tag</code></p>
<p>如：<code>docker tag  zzyyubuntu:1.2  192.168.111.162:5000/zzyyubuntu:1.2</code></p>
<h5 id="修改配置文件使之支持http">修改配置文件使之支持http</h5>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011448141.png" alt="image-20230401144849106" style="zoom:33%;">
<blockquote>
<p>docker默认不允许http方式推送镜像，通过配置选项来取消这个限制。====&gt; 修改完后如果不生效，建议重启docker。</p>
</blockquote>
<h5 id="push推送到私服库">push推送到私服库</h5>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011449802.png" alt="image-20230401144939769" style="zoom:33%;">
<h5 id="curl验证私服库上有什么镜像-2">curl验证私服库上有什么镜像</h5>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011449795.png" alt="image-20230401144955759" style="zoom:33%;">
<h5 id="pull到本地并运行">pull到本地并运行</h5>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011450484.png" alt="image-20230401145032447" style="zoom:33%;">
<h3 id="Docker容器数据卷">Docker容器数据卷</h3>
<h4 id="容器卷记得加入">容器卷记得加入</h4>
<p><code>--privileged=true</code></p>
<blockquote>
<p>Docker挂载主机目录访问如果出现cannot open directory .: Permission denied</p>
</blockquote>
<p><strong>解决办法：在挂载目录后多加一个–privileged=true参数即可</strong></p>
<p>如果是CentOS7安全模块会比之前系统版本加强，不安全的会先禁止，所以目录挂载的情况被默认为不安全的行为，在SELinux里面挂载目录被禁止掉了，如果要开启，我们一般使用<code>--privileged=true</code>命令，扩大容器的权限解决挂载目录没有权限的问题，也即使用该参数，container内的root拥有真正的root权限，否则，container内的root只是外部的一个普通用户权限。</p>
<h4 id="是什么">是什么</h4>
<p>卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用于持续存储或共享数据的特性：卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷。</p>
<p><strong>一句话：有点类似我们Redis里面的rdb和aof文件。</strong></p>
<p>将docker容器内的数据保存进宿主机的磁盘中，运行一个带有容器卷存储功能的容器实例。</p>
<p><code>docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录   镜像名</code></p>
<h4 id="作用">作用</h4>
<p>为了能保存数据在docker中我们使用卷</p>
<blockquote>
<p>特点：</p>
<ol>
<li><strong>数据卷可在容器之间共享或重用数据</strong></li>
<li><strong>卷中的更改可以直接实时生效，爽</strong></li>
<li><strong>数据卷中的更改不会包含在镜像的更新中</strong></li>
<li><strong>数据卷的生命周期一直持续到没有容器使用它为止</strong></li>
</ol>
</blockquote>
<h4 id="数据卷案例">数据卷案例</h4>
<p><img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011507312.png" alt></p>
<h5 id="1-宿主vs容器之间映射添加容器卷">1 宿主vs容器之间映射添加容器卷</h5>
<p><code>直接命令添加</code></p>
<p><code>docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录 镜像名</code></p>
<p>公式：<code>docker run -it -v /宿主机目录:/容器内目录 ubuntu /bin/bash</code></p>
<p><code>docker run -it --name myu3 --privileged=true -v /tmp/myHostData:/tmp/myDockerData ubuntu /bin/bash</code></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011457756.png" style="zoom:25%;">
<p><strong>查看数据卷是否挂载成功</strong>   <code>docker inspect 容器ID</code></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011458135.png" alt="image-20230401145802112" style="zoom:25%;">
<p><strong>容器和宿主机之间数据共享</strong></p>
<blockquote>
<ol>
<li>docker修改，主机同步获得 。</li>
<li>主机修改，docker同步获得。</li>
<li>docker容器stop，主机修改，docker容器重启数据同步</li>
</ol>
</blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011455958.png" alt="img" style="zoom:25%;">
<h5 id="2-读写规则映射添加说明">2 读写规则映射添加说明</h5>
<p>读写(默认)  <code>docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:rw 镜像名</code></p>
<p>默认同上案例，默认就是rw</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011459152.png" alt="image-20230401145933130" style="zoom:33%;">
<p>只读        容器实例内部被限制，只能读取不能写</p>
<blockquote>
<p>/容器目录:ro 镜像名               就能完成功能，此时容器自己只能读取不能写</p>
<p>此时如果宿主机写入内容，可以同步给容器内，容器可以读取到。</p>
<p>​		<code>docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</code></p>
</blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011500515.png" alt="image-20230401150027489" style="zoom:33%;">
<h5 id="3-卷的继承和共享">3 卷的继承和共享</h5>
<p>容器1完成和宿主机的映射 <code>docker run -it  --privileged=true -v /mydocker/u:/tmp --name u1 ubuntu</code></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011501748.png" alt="image-20230401150135721" style="zoom:25%;">
<p>容器2继承容器1的卷规则 <code>docker run -it  --privileged=true --volumes-from 父类  --name u2 ubuntu</code></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011455985.png" alt="img" style="zoom:25%;">
<p>数据卷的作用：</p>
<ul>
<li>将容器与数据分离，解耦合，方便操作容器内数据，保证数据安全</li>
</ul>
<p>数据卷操作：</p>
<ul>
<li>docker volume create：创建数据卷</li>
<li>docker volume ls：查看所有数据卷</li>
<li>docker volume inspect：查看数据卷详细信息，包括关联的宿主机目录位置</li>
<li>docker volume rm：删除指定数据卷</li>
<li>docker volume prune：删除所有未使用的数据卷</li>
</ul>
<p>挂载数据卷</p>
<ul>
<li>我们在创建容器时，可以通过<code> -v</code> 参数来挂载一个数据卷到某个容器内目录，命令格式如下：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --name mn \</span><br><span class="line">  -v html:/root/html \</span><br><span class="line">  -p 8080:80</span><br><span class="line">  nginx \</span><br></pre></td></tr></table></figure>
<p>这里的<code>-v</code>就是挂载数据卷的命令：</p>
<ul>
<li><code>-v html:/root/htm</code> ：把<code>html</code>数据卷挂载到容器内的<code>/root/html</code>这个目录中</li>
</ul>
<h3 id="Docker常规安装">Docker常规安装</h3>
<h4 id="总体步骤">总体步骤</h4>
<blockquote>
<ol>
<li>搜索镜像</li>
<li>拉取镜像</li>
<li>查看镜像</li>
<li>启动镜像 - 服务端口映射</li>
<li>停止容器</li>
<li>移除容器</li>
</ol>
</blockquote>
<h2 id="Docker-进阶">Docker 进阶</h2>
<p>实验有时间可做  参考： <strong>尚硅谷文档 + <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.yuque.com/tmfl/cloud/ixlgsl#94eae42b">https://www.yuque.com/tmfl/cloud/ixlgsl#94eae42b</a></strong></p>
<h3 id="MySQL主从复制">MySQL主从复制</h3>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/Guzarish/article/details/123244487">https://blog.csdn.net/Guzarish/article/details/123244487</a></p>
<h4 id="主从复制原理">主从复制原理</h4>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/Guzarish/article/details/123244487">https://blog.csdn.net/Guzarish/article/details/123244487</a></p>
<h4 id="主从搭建步骤">主从搭建步骤</h4>
<img src="/post/../Library/Application%20Support/typora-user-images/image-20230401151032867.png" alt="image-20230401151032867" style="zoom:33%;">
<p>1、新建主服务器容器实例3307</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3307:3306 --name mysql-master \</span><br><span class="line">-v /mydata/mysql-master/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-master/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-master/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root  \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></table></figure>
<p>2、进入/mydata/mysql-master/conf目录下新建my.cnf   <code>vim my.cnf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line">server_id=101 </span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"><span class="comment">## 开启二进制日志功能</span></span><br><span class="line">log-bin=mall-mysql-bin  </span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line">binlog_cache_size=1M  </span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line">binlog_format=mixed  </span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line">expire_logs_days=7  </span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line">slave_skip_errors=1062</span><br></pre></td></tr></table></figure>
<p>3、修改完配置后重启master实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql-master</span><br></pre></td></tr></table></figure>
<p>4、进入mysql-master容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql-master /bin/bash</span><br><span class="line">mysql -uroot -proot</span><br></pre></td></tr></table></figure>
<p>5、master容器实例内创建数据同步用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>6、新建从服务器容器实例3308</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3308:3306 --name mysql-slave \</span><br><span class="line">-v /mydata/mysql-slave/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-slave/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-slave/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root  \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></table></figure>
<p>7、进入/mydata/mysql-slave/conf目录下新建my.cnf   <code>vim my.cnf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line">server_id=102</span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"><span class="comment">## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span></span><br><span class="line">log-bin=mall-mysql-slave1-bin  </span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line">binlog_cache_size=1M  </span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line">binlog_format=mixed  </span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line">expire_logs_days=7  </span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line">slave_skip_errors=1062  </span><br><span class="line"><span class="comment">## relay_log配置中继日志</span></span><br><span class="line">relay_log=mall-mysql-relay-bin  </span><br><span class="line"><span class="comment">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span><br><span class="line">log_slave_updates=1  </span><br><span class="line"><span class="comment">## slave设置为只读（具有super权限的用户除外）</span></span><br><span class="line">read_only=1</span><br></pre></td></tr></table></figure>
<p>8、修改完配置后重启slave实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql-slave</span><br></pre></td></tr></table></figure>
<p>9、在主数据库中查看主从同步状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>
<p>10、进入mysql-slave容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql-slave /bin/bash</span><br><span class="line">mysql -uroot -proot</span><br></pre></td></tr></table></figure>
<p>11、在从数据库中配置主从复制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host=<span class="string">&#x27;宿主机ip&#x27;</span>, master_user=<span class="string">&#x27;slave&#x27;</span>, master_password=<span class="string">&#x27;123456&#x27;</span>, </span><br><span class="line">master_port=3307, master_log_file=<span class="string">&#x27;mall-mysql-bin.000001&#x27;</span>, master_log_pos=617, master_connect_retry=30;</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011510292.png" alt="img" style="zoom:25%;">
<blockquote>
<p>主从复制命令参数说明</p>
<ul>
<li>
<p>master_host：主数据库的IP地址；</p>
</li>
<li>
<p>master_port：主数据库的运行端口；</p>
</li>
<li>
<p>master_user：在主数据库创建的用于同步数据的用户账号；</p>
</li>
<li>
<p>master_password：在主数据库创建的用于同步数据的用户密码；</p>
</li>
<li>
<p>master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</p>
</li>
<li>
<p>master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</p>
</li>
<li>
<p>master_connect_retry：连接失败重试的时间间隔，单位为秒。</p>
</li>
</ul>
</blockquote>
<p>12、在从数据库中查看主从同步状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show slave status \G;</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011510845.png" alt="img" style="zoom:25%;">
<p>13、在从数据库中开启主从同步</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011515863.png" alt="image-20230401151540796" style="zoom:33%;">
<p>14、查看从数据库状态发现已经同步</p>
<img src="/post/../Library/Application%20Support/typora-user-images/image-20230401151557453.png" alt="image-20230401151557453" style="zoom: 25%;">
<p>15、主从复制测试</p>
<ol>
<li>
<ul>
<li>主机新建库-使用库-新建表-插入数据，ok</li>
</ul>
</li>
<li>
<ul>
<li>从机使用库-查看记录，ok</li>
</ul>
</li>
</ol>
<h3 id="redis集群">redis集群</h3>
<ul>
<li>
<p>cluster(集群)模式-docker版</p>
</li>
<li>
<p>哈希槽分区进行亿级数据存储</p>
</li>
</ul>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011517830.png" alt="image-20230401151750776" style="zoom:33%;">
<h4 id="题目">题目</h4>
<p><strong>Q</strong>		1~2亿条数据需要缓存，请问如何设计这个存储案例？</p>
<p><strong>A</strong>		单机单台100%不可能，肯定是分布式存储，用redis如何落地？</p>
<p>上述问题阿里P6~P7工程案例和场景设计类必考题目， 一般业界有==3种解决方案==</p>
<h4 id="3种解决方案">3种解决方案</h4>
<h5 id="1、哈希取余分区">1、哈希取余分区</h5>
<img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658996785793-2ca8867b-2254-45ee-8bc7-8f566d737db2.png" alt="img" style="zoom: 50%;">
<p>2亿条记录就是2亿个k,v，我们必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：</p>
<p>hash(key) % N个机器台数，计算出哈希值，用来决定数据映射到哪一个节点上。</p>
<p><strong>优点：</strong></p>
<p>简单粗暴，直接有效，只需要预估好数据规划好节点，例如3台、8台、10台，就能保证一段时间的数据支撑。使用Hash算法让固定的一部分请求落到同一台服务器上，这样每台服务器固定处理一部分请求（并维护这些请求的信息），起到负载均衡+分而治之的作用。</p>
<p><strong>缺点：</strong></p>
<p>原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)/3会变成Hash(key)/?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。</p>
<p>某个redis机器宕机了，由于台数数量变化，会导致hash取余全部数据重新洗牌。</p>
<h5 id="2、一致性哈希算法分区">2、一致性哈希算法分区</h5>
<p>一致性Hash算法背景</p>
<p>一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是为了解决分布式缓存数据变动和映射问题，某个机器宕机了，分母数量改变了，自然取余数不行了。</p>
<p>目的</p>
<p>​		当服务器个数发生变动时， 尽量减少影响客户端到服务器的映射关系</p>
<h6 id="3大步骤">3大步骤</h6>
<p><strong>算法构建一致性哈希环</strong></p>
<p>一致性哈希环</p>
<blockquote>
<p>​	一致性哈希算法必然有个hash函数并按照算法产生hash值，这个算法的所有可能哈希值会构成一个全量集，这个集合可以成为一个hash空间[0,2^32-1]，这个是一个线性空间，但是在算法中，我们通过适当的逻辑控制将它首尾相连(0 = 2^32),这样让它逻辑上形成了一个环形空间。</p>
<p>​	它也是按照使用取模的方法，前面笔记介绍的节点取模法是对节点（服务器）的数量进行取模。而一致性Hash算法是对2^32取模，简单来说，一致性Hash算法将整个哈希值空间组织成一个虚拟的圆环，如假设某哈希函数H的值空间为0-2^32-1（即哈希值是一个32位无符号整形），整个哈希环如下图：整个空间按顺时针方向组织，圆环的正上方的点代表0，0点右侧的第一个点代表1，以此类推，2、3、4、……直到2^32-1，也就是说0点左侧的第一个点代表2^32-1， 0和2^32-1在零点中方向重合，我们把这个由2^32个点组成的圆环称为Hash环。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011527556.png" alt="image-20230401152700520" style="zoom:15%;">
</blockquote>
<p><strong>服务器IP节点映射</strong></p>
<blockquote>
<p>节点映射</p>
<p>将集群中各个IP节点映射到环上的某一个位置。</p>
<p>将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假如4个节点NodeA、B、C、D，经过IP地址的哈希函数计算(hash(ip))，使用IP地址哈希后在环空间的位置如下：</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011527380.png" alt="image-20230401152746347" style="zoom:15%;">
</blockquote>
<p><strong>key落到服务器的落键规则</strong></p>
<blockquote>
<p>当我们需要存储一个kv键值对时，首先计算key的hash值，hash(key)，将这个key使用相同的函数Hash计算出哈希值并确定此数据在环上的位置，从此位置沿环顺时针“行走”，第一台遇到的服务器就是其应该定位到的服务器，并将该键值对存储在该节点上。</p>
<p>如我们有Object A、Object B、Object C、Object D四个数据对象，经过哈希计算后，在环空间上的位置如下：根据一致性Hash算法，数据A会被定为到Node A上，B被定为到Node B上，C被定为到Node C上，D被定为到Node D上。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011518673.png" alt="img" style="zoom:25%;">
</blockquote>
<h6 id="优点"><strong>优点</strong></h6>
<ul>
<li>一致性哈希算法的容错性</li>
</ul>
<blockquote>
<p>容错性</p>
<p>假设Node C宕机，可以看到此时对象A、B、D不会受到影响，只有C对象被重定位到Node D。一般的，在一致性Hash算法中，如果一台服务器不可用，则受影响的数据仅仅是此服务器到其环空间中前一台服务器（即沿着逆时针方向行走遇到的第一台服务器）之间数据，其它不会受到影响。简单说，就是C挂了，受到影响的只是B、C之间的数据，并且这些数据会转移到D进行存储。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011529810.png" alt="image-20230401152919770" style="zoom:15%;">
</blockquote>
<ul>
<li>一致性哈希算法的扩展性</li>
</ul>
<blockquote>
<p>数据量增加了，需要增加一台节点NodeX，X的位置在A和B之间，那收到影响的也就是A到X之间的数据，重新把A到X的数据录入到X上即可，不会导致hash取余全部数据重新洗牌。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011530014.png" alt="img" style="zoom:25%;">
</blockquote>
<h6 id="缺点"><strong>缺点</strong></h6>
<p>一致性哈希算法的数据倾斜问题</p>
<blockquote>
<p>Hash环的数据倾斜问题</p>
<p>一致性Hash算法在服务节点太少时，容易因为节点分布不均匀而造成数据倾斜（被缓存的对象大部分集中缓存在某一台服务器上）问题，</p>
<p>例如系统中只有两台服务器：</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011531041.png" alt="img" style="zoom:25%;">
</blockquote>
<h6 id="小总结"><strong>小总结</strong></h6>
<blockquote>
<p>为了在节点数目发生改变时尽可能少的迁移数据,将所有的存储节点排列在收尾相接的Hash环上，每个key在计算Hash后会顺时针找到临近的存储节点存放。而当有节点加入或退出时仅影响该节点在Hash环上顺时针相邻的后续节点。</p>
<ul>
<li>优点</li>
</ul>
<p>加入和删除节点只影响哈希环中顺时针方向的相邻的节点，对其他节点无影响。</p>
<ul>
<li>缺点</li>
</ul>
<p>数据的分布和节点的位置有关，因为这些节点不是均匀的分布在哈希环上的，所以数据在进行存储时达不到均匀分布的效果。</p>
</blockquote>
<h5 id="3-哈希槽分区">3 哈希槽分区</h5>
<h6 id="是什么-2">是什么</h6>
<blockquote>
<h6 id="为什么出现-img-src-https-gitee-com-Ryang1118-typora-raw-master-images-202304011533650-png-alt-image-20230401153252082-style-zoom-25">为什么出现                   <img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011533650.png" alt="image-20230401153252082" style="zoom:25%;"></h6>
<p>​	哈希槽实质就是一个数组，数组[0,2^14 -1]形成hash slot空间。</p>
<h6 id="能干什么">能干什么</h6>
<p>解决均匀分配的问题，在数据和节点之间又加入了一层，把这层称为哈希槽（slot），用于管理数据和节点之间的关系，现在就相当于节点上放的是槽，槽里放的是数据。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011518273.png" alt="img" style="zoom:35%;">
<p>槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。</p>
<p>哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配。</p>
<h6 id="多少个hash槽">多少个hash槽</h6>
<p>一个集群只能有16384个槽，编号0-16383（0-2^14-1）。这些槽会分配给集群中的所有主节点，分配策略没有要求。可以指定哪些编号的槽分配给哪个主节点。集群会记录节点和槽的对应关系。解决了节点和槽的关系后，接下来就需要对key求哈希值，然后对16384取余，余数是几key就落入对应的槽里。slot = CRC16(key) % 16384。以槽为单位移动数据，因为槽的数目是固定的，处理起来比较容易，这样数据移动问题就解决了。</p>
</blockquote>
<h6 id="哈希槽计算">哈希槽计算</h6>
<blockquote>
<p>Redis 集群中内置了 16384 个哈希槽，redis 会根据节点数量大致均等的将哈希槽映射到不同的节点。当需要在 Redis 集群中放置一个 key-value时，redis 先对 key 使用 crc16 算法算出一个结果，然后把结果对 16384 求余数，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽，也就是映射到某个节点上。如下代码，key之A 、B在Node2， key之C落在Node3上</p>
</blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011537859.png" alt="image-20230401153713827" style="zoom:25%;">
<h4 id="案例演示">案例演示</h4>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011518732.png" alt="image-20230401151818690" style="zoom: 25%;">
<h5 id="3主3从redis集群配置">3主3从redis集群配置</h5>
<p>1、关闭防火墙+启动docker后台服务   <code>systemctl start docker</code></p>
<p>2、新建6个docker容器redis实例</p>
<p>​					命令分步解释</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011542993.png" style="zoom:25%;">
<p>3、进入容器redis-node-1并为6台机器构建集群关系</p>
<p>​	3.1、进入容器           docker exec -it redis-node-1 /bin/bash</p>
<blockquote>
<p>//注意，进入docker容器后才能执行一下命令，且注意自己的真实IP地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 启动第1台节点</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># --net host 使用宿主机的IP和端口，默认</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># --cluster-enabled yes 开启redis集群</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># --appendonly yes 开启redis持久化</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># --port 6381 配置redis端口号</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d --name redis-node-1 --net host --privileged=<span class="literal">true</span> -v /app/redis-cluster/share/redis-node-1:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6381</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 启动第2台节点</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d --name redis-node-2 --net host --privileged=<span class="literal">true</span> -v /app/redis-cluster/share/redis-node-2:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6382</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 启动第3台节点</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d --name redis-node-3 --net host --privileged=<span class="literal">true</span> -v /app/redis-cluster/share/redis-node-3:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6383</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 启动第4台节点</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d --name redis-node-4 --net host --privileged=<span class="literal">true</span> -v /app/redis-cluster/share/redis-node-4:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6384</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 启动第5台节点</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d --name redis-node-5 --net host --privileged=<span class="literal">true</span> -v /app/redis-cluster/share/redis-node-5:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6385</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 启动第6台节点</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d --name redis-node-6 --net host --privileged=<span class="literal">true</span> -v /app/redis-cluster/share/redis-node-6:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6386</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>​	3.2、构建主从关系</p>
<blockquote>
<p>进入节点1（或其中任意一个节点）:   <code>docker exec -it redis-node-1 /bin/bash</code></p>
<p>构建主从关系：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 宿主机IP:端口</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">redis-cli --cluster create 192.168.xxx.xxx:6381 192.168.xxx.xxx:6382 192.168.xxx.xxx:6383 192.168.xxx.xxx:6384 192.168.xxx.xxx:6385 192.168.xxx.xxx:6386 --cluster-replicas 1</span></span><br></pre></td></tr></table></figure>
<p>redis尝试自动进行主从节点分配</p>
<p>因为我们的docker容器IP相同，所以会出现警告，可以直接忽略该警告</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">[WARNING] Some slaves are <span class="keyword">in</span> the same host as their master</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>–cluster-replicas 1 表示为每个master创建一个slave节点</p>
</blockquote>
<p>输入<code>Yes</code>确认后，redis会向其他节点发送信息加入集群，并分配哈希槽：</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011544608.png" style="zoom:25%;">
</blockquote>
<p>​	3.3、一切OK的话，3主3从搞定</p>
<p>4、链接进入6381作为切入点，查看集群状态</p>
<p>​			链接进入6381作为切入点，查看节点状态</p>
<blockquote>
<p>​	  进入容器节点1（或集群中其他节点）： <code>docker exec -it redis-node-1 /bin/bash</code></p>
<p>​     使用<code>redis-cli</code>连接到<code>6381</code>节点：  <code>redis-cli -p 6381</code></p>
<p>​     使用<code>redis</code>的相关命令查看集群状态：<code>cluster info      	</code></p>
<p>​     查看集群节点信息 <code>cluster nodes</code></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011546265.png" alt="image-20230401154647238" style="zoom:25%;">
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011545819.png" alt="image-20230401154545791" style="zoom:25%;">
</blockquote>
<h5 id="主从容错切换迁移案例">主从容错切换迁移案例</h5>
<h6 id="数据读写存储">数据读写存储</h6>
<p>1、启动6机构成的集群并通过exec进入   <code>docker exec -it redis-node-1 /bin/bash</code></p>
<p>2、  使用<code>redis-cli</code>连接，不加<code>-c</code>参数时    对6381新增两个key      可能会成功，也可能会失败</p>
<p>3、防止路由失效加参数-c并新增两个key</p>
<blockquote>
<p>当使用 <code>redis-cli</code>连接redis集群时，需要添加 <code>-c</code>参数，否则可能会出现读写出错。</p>
</blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011547061.png" alt="image-20230401154741033" style="zoom:25%;">
<p>4、查看集群信息            <code>redis-cli --cluster check 192.168.111.147:6381</code></p>
<h6 id="容错切换迁移">容错切换迁移</h6>
<p>1、主6381和从机切换，先停止主机6381</p>
<p>​			6381主机停了，对应的真实从机上位</p>
<p>​			6381作为1号主机分配的从机以实际情况为准，具体是几号机器就是几号</p>
<p>2、再次查看集群信息</p>
<blockquote>
<p>6381宕机了，6385上位成为了新的master。</p>
<p>备注：6381为主下面挂从6385。</p>
</blockquote>
<p>3、先还原之前的3主3从</p>
<p>​		先启6381		   <code>docker start redis-node-1</code></p>
<p>​		再停6385          <code>docker stop redis-node-5</code></p>
<p>​		再启6385			<code>docker start redis-node-5</code></p>
<p>​		主从机器分配情况以实际情况为准</p>
<p>4、查看集群状态         <code>redis-cli --cluster check 自己IP:6381</code></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011551760.png" style="zoom:25%;">
<h5 id="主从扩容案例">主从扩容案例</h5>
<p>1、新建6387、6388两个节点+新建后启动+查看是否8节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis-node-7 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-7:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6387</span><br><span class="line"></span><br><span class="line">docker run -d --name redis-node-8 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-8:/data redis:6.0.8 --cluster-enabled <span class="built_in">yes</span> --appendonly <span class="built_in">yes</span> --port 6388</span><br><span class="line"></span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<p>2、进入6387容器实例内部   <code>docker exec -it redis-node-7  /bin/bash</code></p>
<p>3、将新增的6387节点(空槽号)作为master节点加入原集群</p>
<blockquote>
<p>将新增的6387作为master节点加入集群<code>redis-cli --cluster add-node 自己实际IP地址:6387 自己实际IP地址:6381</code></p>
</blockquote>
<p>4、检查集群情况第1次<code>redis-cli --cluster check 真实ip地址:6381</code></p>
<blockquote>
<p>可以发现，6371节点已经作为master加入了集群，但是该节点没有被分配槽位。</p>
</blockquote>
<p>5、重新分派槽号      <code>redis-cli --cluster reshard 192.168.xxx.xxx:6381</code></p>
<p>6、检查集群情况第2次   <code>redis-cli --cluster check 192.168.xxx.xxx:6381</code></p>
<blockquote>
<p>槽号分派说明:</p>
<p>为什么6387是3个新的区间，以前的还是连续？</p>
<p>重新分配成本太高，所以前3家各自匀出来一部分，从6381/6382/6383三个旧节点分别匀出1364个坑位给新节点6387</p>
</blockquote>
<p>7、为主节点6387分配从节点6388</p>
<blockquote>
<p>命令：<code>redis-cli --cluster add-node ip:新slave端口 ip:新master端口 --cluster-slave --cluster-master-id 新主机节点ID</code></p>
<p><code>redis-cli --cluster add-node 192.168.111.147:6388 192.168.111.147:6387 --cluster-slave --cluster-master-id </code></p>
<p>e4781f644d4a4e4d4b4d107157b9ba8144631451-------这个是6387的编号，按照自己实际情况</p>
</blockquote>
<p>9、检查集群情况第3次</p>
<blockquote>
<p><code>redis-cli --cluster check 192.168.xxx.xxx:6381</code></p>
</blockquote>
<h5 id="主从缩容案例">主从缩容案例</h5>
<p>1、目的：假如业务高峰期过去，需要将4主4从重新缩容到3主3从。即从集群中移除node8和node7.</p>
<blockquote>
<p>进入容器节点1</p>
<p><code>docker exec -it redis-node-1 /bin/bash</code></p>
</blockquote>
<p>2、检查集群情况1获得6388的节点ID   <code>redis-cli --cluster check 192.168.111.147:6382</code></p>
<p>3、将6388删除 从集群中将4号从节点6388删除    <code>redis-cli --cluster del-node 192.168.xxx.xxx:6388 6388节点编号</code></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011613757.png" alt="image-20230401161321720" style="zoom:25%;">
<p>4、将6387的槽号清空，重新分配，本例将清出来的槽号都给6381</p>
<blockquote>
<p>对集群重新分配哈希槽</p>
<p><code>redis-cli --cluster reshard 192.168.xxx.xxx:6381</code></p>
<p>redis经过槽位检查后，会提示需要分配的槽位数量：</p>
<p>How many slots do you want to move (from 1 to 16384)?</p>
<p>如果我们想直接把node7的4096个哈希槽全部分给某个节点，可以直接输入4096。<br>
输入<code>4096</code>后，会让输入要接收这些哈希槽的节点ID。假如我们想把这4096个槽都分给Node1，直接输入node1节点的编号即可。<br>
然后会提示，询问要从哪些节点中拨出一部分槽位凑足4096个分给Node1。这里我们输入node7的节点编号，回车后输入<code>done</code>。</p>
<p>node7上面没有了哈希槽，此时便可以将node7从集群中移除。（如果node7上面有哈希槽，直接从集群中移除会报错）</p>
</blockquote>
<p>5、检查集群情况第二次     <code>redis-cli --cluster check 192.168.111.147:6381</code></p>
<p>6、将6387删除         <code>redis-cli --cluster del-node 192.168.xxx.xxx:6387 node7节点ID</code></p>
<p>7、检查集群情况第三次    <code>redis-cli --cluster check 192.168.111.147:6381</code></p>
<h3 id="DockerFile解析">DockerFile解析</h3>
<h4 id="是什么-3">是什么</h4>
<blockquote>
<p>Dockerfile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。</p>
<p><strong>官网</strong></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p>
<p><strong>构建三步骤</strong></p>
<ol>
<li>编写Dockerfile文件</li>
<li>docker build 命令构建镜像</li>
<li>docker run 镜像 运行容器实例</li>
</ol>
</blockquote>
<h4 id="DockerFile构建过程解析">DockerFile构建过程解析</h4>
<h5 id="Dockerfile内容基础知识">Dockerfile内容基础知识</h5>
<blockquote>
<ul>
<li>每条保留字指令都必须为大写字母且后面要跟随至少一个参数</li>
<li>指令按照从上到下，顺序执行</li>
<li>#表示注释</li>
<li>每条指令都会创建一个新的镜像层并对镜像进行提交</li>
</ul>
</blockquote>
<h5 id="Docker执行Dockerfile的大致流程">Docker执行Dockerfile的大致流程</h5>
<ol>
<li>docker从基础镜像运行一个容器</li>
<li>执行一条指令并对容器作出修改</li>
<li>执行类似<code>docker commit</code>的操作提交一个新的镜像层</li>
<li>docker再基于刚提交的镜像运行一个新容器</li>
<li>执行dockerfile中的下一条指令直到所有指令都执行完成</li>
</ol>
<h4 id="小总结-2">小总结</h4>
<p>从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，</p>
<ul>
<li>Dockerfile是软件的原材料</li>
<li>Docker镜像是软件的交付品</li>
<li>Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例</li>
</ul>
<p>Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011619814.png" alt="image-20230401161915775" style="zoom:25%;">
<ul>
<li>
<p>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;</p>
</li>
<li>
<p>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务;</p>
</li>
<li>
<p>Docker容器，容器是直接提供服务的。</p>
</li>
</ul>
<h4 id="DockerFile常用保留字指令">DockerFile常用保留字指令</h4>
<p><img src="https://gitee.com/Ryang1118/typora/raw/master/images/202305191141389.png" alt></p>
<p><strong>参考tomcat8的dockerfile入门</strong>      <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/docker-library/tomcat">https://github.com/docker-library/tomcat</a></p>
<p><strong>FROM</strong>    基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是from</p>
<p><strong>MAINTAINER</strong>    镜像维护者的姓名和邮箱地址</p>
<p><strong>RUN</strong>    容器构建时需要运行的命令  RUN是在 docker build时运行</p>
<p>​		两种格式</p>
<p>​				shell格式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">等同于在终端操作的shell命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式：RUN &lt;命令行命令&gt;</span></span><br><span class="line">RUN yum -y install vim</span><br></pre></td></tr></table></figure>
<p>​				exec格式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式：RUN [<span class="string">&quot;可执行文件&quot;</span> , <span class="string">&quot;参数1&quot;</span>, <span class="string">&quot;参数2&quot;</span>]</span></span><br><span class="line">RUN [&quot;./test.php&quot;, &quot;dev&quot;, &quot;offline&quot;]  # 等价于 RUN ./test.php dev offline</span><br></pre></td></tr></table></figure>
<p><strong>EXPOSE</strong>              当前容器对外暴露出的端口</p>
<p><strong>WORKDIR</strong>           指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点</p>
<p><strong>USER</strong>                  指定该镜像以什么样的用户去执行，如果都不指定，默认是root</p>
<p><strong>ENV</strong>                    用来在构建镜像过程中设置环境变量</p>
<blockquote>
<p>这个环境变量可以在后续的任何RUN指令中使用，这就如同在命令前面指定了环境变量前缀一样；也可以在其它指令中直接使用这些环境变量。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式 ENV 环境变量名 环境变量值</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者 ENV 环境变量名=值</span></span><br><span class="line">ENV MY_PATH /usr/mytest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用环境变量</span></span><br><span class="line">WORKDIR $MY_PATH</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>ADD</strong>                   将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包</p>
<p><strong>COPY</strong>                 类似ADD，拷贝文件和目录到镜像中。</p>
<blockquote>
<p>将从构建上下文目录中 &lt;源路径&gt; 的文件/目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">COPY src dest</span><br><span class="line">COPY [&quot;src&quot;, &quot;dest&quot;]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;src源路径&gt;：源文件或者源目录</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;dest目标路径&gt;：容器内的指定路径，该路径不用事先建好。如果不存在会自动创建</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>VOLUME</strong>              容器数据卷，用于数据保存和持久化工作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VOLUME 挂载点</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载点可以是一个路径，也可以是数组（数组中的每一项必须用双引号）</span></span><br><span class="line">VOLUME /var/lib/mysql</span><br></pre></td></tr></table></figure>
<p><strong>CMD</strong></p>
<p>指定容器启动后的要干的事情</p>
<p>​		有两种格式：</p>
<p>​				shell格式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CMD &lt;命令&gt;</span></span><br><span class="line">CMD echo &quot;hello world&quot;</span><br></pre></td></tr></table></figure>
<p>​				 exec格式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CMD [<span class="string">&quot;可执行文件&quot;</span>, <span class="string">&quot;参数1&quot;</span>, <span class="string">&quot;参数2&quot;</span> ...]</span></span><br><span class="line">CMD [&quot;catalina.sh&quot;, &quot;run&quot;]</span><br></pre></td></tr></table></figure>
<p>​				参数列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CMD [<span class="string">&quot;参数1&quot;</span>, <span class="string">&quot;参数2&quot;</span> ....]，与ENTRYPOINT指令配合使用</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong></p>
<p>Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 docker run 之后的参数替换。</p>
<p>例如，对于tomcat镜像，执行以下命令会有不同的效果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因为tomcat的Dockerfile中指定了 CMD [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">所以直接docker run 时，容器启动后会自动执行 catalina.sh run</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定容器启动后执行 /bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时指定的/bin/bash会覆盖掉Dockerfile中指定的 CMD [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat /bin/bash</span><br></pre></td></tr></table></figure>
<p>它和前面RUN命令的区别</p>
<ul>
<li>CMD是在docker run 时运行。</li>
<li>RUN是在 docker build 时运行。</li>
</ul>
</blockquote>
<p><strong>ENTRYPOINT</strong>        用来指定一个容器启动时要运行的命令</p>
<blockquote>
<p>类似于 CMD 指令，但是ENTRYPOINT不会被docker run后面的命令覆盖， 而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p>
</blockquote>
<p>命令格式：                 <img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011627515.png" alt="image-20230401162753424" style="zoom:25%;"></p>
<blockquote>
<p>ENTRYPOINT可以和CMD一起用，一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参。</p>
<p>当指定了ENTRYPOINT后，CMD的含义就发生了变化，不再是直接运行其命令而是将CMD的内容作为参数传递给ENTRYPOINT指令，他两个组合会变成 <img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011628072.png" alt="image-20230401162805012" style="zoom:25%;"></p>
<p>优点：在执行docker run的时候可以指定 ENTRYPOINT 运行所需的参数。</p>
<p>注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p>
</blockquote>
<p><strong>总结</strong></p>
<blockquote>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011632532.png" alt="image-20230401163213500" style="zoom:25%;">
</blockquote>
<h4 id="案例演示-2">案例演示</h4>
<h5 id="自定义镜像mycentosjava8">自定义镜像mycentosjava8</h5>
<p><strong>要求</strong></p>
<p>1、Centos7镜像具备vim+ifconfig+jdk8</p>
<p>2、JDK的下载镜像地址：</p>
<p>​		官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.oracle.com/java/technologies/downloads/#java8">https://www.oracle.com/java/technologies/downloads/#java8</a></p>
<p>​		<a target="_blank" rel="noopener external nofollow noreferrer" href="https://mirrors.yangxingzhen.com/jdk/">https://mirrors.yangxingzhen.com/jdk/</a></p>
<p><strong>编写</strong></p>
<p>准备编写Dockerfile文件</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">MAINTAINER</span> zzyy&lt;zzyybs@<span class="number">126</span>.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装vim编辑器</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install vim</span></span><br><span class="line"><span class="comment">#安装ifconfig命令查看网络IP</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install net-tools</span></span><br><span class="line"><span class="comment">#安装java8及lib库</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install glibc.i686</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /usr/local/java</span></span><br><span class="line"><span class="comment">#ADD 是相对路径jar,把jdk-8u171-linux-x64.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> jdk-8u171-linux-x64.tar.gz /usr/local/java/</span></span><br><span class="line"><span class="comment">#配置java环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/java/jdk1.<span class="number">8.0</span>_171</span><br><span class="line"><span class="keyword">ENV</span> JRE_HOME $JAVA_HOME/jre</span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;success--------------ok&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>
<p><strong>构建</strong></p>
<p>docker build -t 新镜像名字:TAG .    <code>docker build -t centosjava8:1.5 .</code></p>
<blockquote>
<p>注意，上面TAG后面有个空格，有个点</p>
</blockquote>
<p><strong>运行</strong></p>
<p>docker run -it 新镜像名字:TAG       <code>docker run -it centosjava8:1.5 /bin/bash</code></p>
<h5 id="虚悬镜像">虚悬镜像</h5>
<p><strong>是什么</strong></p>
<p>仓库名、标签都是&lt;none&gt;的镜像，俗称dangling image</p>
<p>Dockerfile写一个</p>
<p><code>vim Dockerfile</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ubuntu</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;action is success&#x27;</span></span></span><br></pre></td></tr></table></figure>
<p><code>docker build .</code></p>
<p><strong>查看</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image ls -f dangling=true</span><br></pre></td></tr></table></figure>
<p><strong>删除</strong></p>
<p>虚悬镜像已经失去存在价值，可以删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune</span><br></pre></td></tr></table></figure>
<h5 id="自定义镜像myubuntu">自定义镜像myubuntu</h5>
<p><strong>编写</strong></p>
<p>准备编写DockerFile文件</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">MAINTAINER</span> zzyy&lt;zzyybs@<span class="number">126</span>.com&gt;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install net-tools</span></span><br><span class="line"><span class="comment">#RUN apt-get install -y iproute2</span></span><br><span class="line"><span class="comment">#RUN apt-get install -y inetutils-ping</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;install inconfig cmd into ubuntu success--------------ok&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>
<p><strong>构建</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t 新镜像名字:TAG .</span><br></pre></td></tr></table></figure>
<p><strong>运行</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it 新镜像名字:TAG</span><br></pre></td></tr></table></figure>
<h5 id="小总结-3">小总结</h5>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011518976.png" alt="img" style="zoom: 33%;">
<h3 id="Docker微服务实战">Docker微服务实战</h3>
<h4 id="通过IDEA新建一个普通微服务模块">通过IDEA新建一个普通微服务模块</h4>
<p><strong>建Module</strong></p>
<p>docker_boot</p>
<p><strong>改POM</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.docker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docker_boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper.version</span>&gt;</span>4.1.5<span class="tag">&lt;/<span class="name">mapper.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">mybatis.spring.boot.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringBoot通用依赖模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>写YML</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port=6001</span><br></pre></td></tr></table></figure>
<p><strong>主启动</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.docker;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DockerBootApplication</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        SpringApplication.run(DockerBootApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>业务类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.docker.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@auther</span> zzyy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-10-25 17:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/order/docker&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">helloDocker</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello docker&quot;</span>+<span class="string">&quot;\t&quot;</span>+port+<span class="string">&quot;\t&quot;</span>+ UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value =&quot;/order/index&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;服务端口号: &quot;</span>+<span class="string">&quot;\t&quot;</span>+port+<span class="string">&quot;\t&quot;</span>+UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="通过dockerfile发布微服务部署到docker容器">通过dockerfile发布微服务部署到docker容器</h4>
<p><strong>IDEA工具里面搞定微服务jar包</strong>        <code> docker_boot-0.0.1-SNAPSHOT.jar</code></p>
<p><strong>编写Dockerfile</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础镜像使用java</span></span><br><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"><span class="comment"># 作者</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> zzyy</span><br><span class="line"><span class="comment"># VOLUME 指定临时文件目录为/tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /tmp</span></span><br><span class="line"><span class="comment"># 将jar包添加到容器中并更名为zzyy_docker.jar</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar</span></span><br><span class="line"><span class="comment"># 运行jar包</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> bash -c <span class="string">&#x27;touch /zzyy_docker.jar&#x27;</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/zzyy_docker.jar&quot;</span>]</span></span><br><span class="line"><span class="comment">#暴露6001端口作为微服务</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">6001</span></span><br></pre></td></tr></table></figure>
<p>将微服务jar包和Dockerfile文件上传到同一个目录下/mydocker</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011639755.png" alt="image-20230401163957654" style="zoom:25%;">
<p><strong>构建镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t zzyy_docker:1.6 .</span><br></pre></td></tr></table></figure>
<p><strong>运行容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 6001:6001 zzyy_docker:1.6</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011641705.png" style="zoom:25%;">
<p><strong>访问测试</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011518725.png" alt="img" style="zoom: 50%;">
<h3 id="Docker网络">Docker网络</h3>
<h4 id="是什么-4">是什么</h4>
<p><strong>docker不启动，默认网络情况</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011645105.png" alt="image-20230401164537059" style="zoom:25%;">
<p><strong>docker启动后，网络情况</strong></p>
<ul>
<li>
<p>docker0</p>
<blockquote>
<p>Docker 服务默认会创建一个<code>docker0</code>网桥（其上有一个<code>docker0</code>内部接口），该桥接网络的名称为 <code>docker0</code>，它在内核层连通了其他的物理或虚拟网卡，这就将所有容器和本地主机都放到同一个物理网络。</p>
<p>Docker默认指定了<code>docker0</code>接口的IP地址和子网掩码，让主机和容器之间可以通过网桥互相通信。</p>
<p>查看<code>bridge</code>网络的详细信息，并通过<code>grep</code>获取名称：   可以看到其名称为<code>docker0</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker network inspect bridge | grep name</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011646602.png" alt="image-20230401164623547" style="zoom:25%;">
<p><strong>查看docker网络模式命令，默认创建3大网络模式。</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011646774.png" alt="image-20230401164656723" style="zoom:25%;">
<h4 id="常用基本命令">常用基本命令</h4>
<p><strong>All命令</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011649184.png" alt="image-20230401164909146" style="zoom:25%;">
<p><strong>查看网络</strong>              <code>docker network ls</code></p>
<p><strong>查看网络源数据</strong>     <code>docker network inspect XXX网络名字</code></p>
<p><strong>删除网络</strong>               <code>docker network rm XXX网络名字</code></p>
<p><strong>案例</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011649967.png" style="zoom:25%;">
<h4 id="Docker网络的作用">Docker网络的作用</h4>
<ul>
<li>
<p>容器间的互联和通信以及端口映射</p>
</li>
<li>
<p>容器IP变动时候可以通过服务名直接网络通信而不受到影响</p>
</li>
</ul>
<h4 id="网络模式">网络模式</h4>
<p><strong>总体介绍</strong></p>
<table>
<thead>
<tr>
<th>网络模式</th>
<th>简介</th>
<th>使用方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>bridge</td>
<td>为每一个容器分配、设置IP等，并将容器连接到一个<code>docker0</code>虚拟网桥，默认为该模式</td>
<td><code>--network bridge</code></td>
</tr>
<tr>
<td>host</td>
<td>容器将不会虚拟出自己的网卡、配置自己的IP等，而是使用宿主机的IP和端口</td>
<td><code>--network host</code></td>
</tr>
<tr>
<td>none</td>
<td>容器有独立的 Network namespace，但并没有对齐进行任何网络设置，如分配 <code>veth pari</code> 和 网桥连接、IP等</td>
<td><code>--network none</code></td>
</tr>
<tr>
<td>container</td>
<td>新创建的容器不会创建自己的网卡和配置自己的IP，而是和一个指定的容器共享IP、端口范围等</td>
<td><code>--network container:NAME或者容器ID</code></td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li>
<p>bridge模式：使用–network bridge指定，默认使用docker0</p>
</li>
<li>
<p>host模式：使用–network host指定</p>
</li>
<li>
<p>none模式：使用–network none指定</p>
</li>
<li>
<p>container模式：使用–network container:NAME或者容器ID指定</p>
</li>
</ul>
</blockquote>
<p>查看某个容器的网络模式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过inspect获取容器信息，最后20行即为容器的网络模式信息</span></span><br><span class="line">docker inspect 容器ID | tail -n 20</span><br></pre></td></tr></table></figure>
<p><strong>容器实例内默认网络IP生产规则</strong></p>
<p>​	<strong>1、先启动两个ubuntu容器实例</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011651269.png" alt="image-20230401165138224" style="zoom:25%;">
<p>​	<strong>2、docker inspect 容器ID or 容器名字</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011651136.png" alt="image-20230401165149093" style="zoom:25%;">
<p>​	<strong>3、关闭u2实例，新建u3，查看ip变化</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011652890.png" alt="image-20230401165201841" style="zoom:25%;">
<p><strong>结论</strong></p>
<blockquote>
<p>docker容器内部的ip是有可能会发生改变的</p>
</blockquote>
<h5 id="bridge模式">bridge模式</h5>
<h6 id="介绍">介绍</h6>
<blockquote>
<p>1、Docker使用Linux桥接，在宿主机虚拟一个<code>Docker</code>容器网桥（<code>docker0</code>），Docker启动一个容器时会根据<code>Docker</code>网桥的网段分配给容器一个IP地址，称为<code>Container-IP</code>，同时Docker网桥是每个容器的默认网关。因为在同一个宿主机内的容器接入同一个网桥，这样容器之间就能够通过容器的<code>Container-IP</code>直接通信。</p>
<p>2、<code>docker run</code>的时候，没有指定<code>--network</code>的话，默认使用的网桥模式就是<code>bridge</code>，使用的就是<code>docker0</code>。在宿主机<code>ifconfig</code>就苦役看到<code>docker0</code>和自己<code>create</code>的<code>network</code>。</p>
<p>3、网桥<code>docker0</code>创建一对对等虚拟设备接口，一个叫<code>veth</code>，另一个叫<code>eth0</code>，成对匹配：</p>
<p>3.1、整个宿主机的网桥模式都是<code>docker0</code>，类似一个交换机有一堆接口，每个接口叫 <code>veth</code>，在本地主机和容器内分别创建一个虚拟接口，并让他们彼此联通（这样一对接口叫做 <code>veth pair</code>）。</p>
<p>3.2、每个容器实例内部也有一块网卡，容器内的网卡接口叫做<code>eth0</code>。</p>
<p>3.3、<code>docker0</code>上面的每个<code>veth</code>匹配某个容器实例内部的<code>eth0</code>，两两配对，一一匹配。</p>
<p>通过上述，将宿主机上的所有容器都连接到这个内部网络上，两个容器在同一个网络下,会从这个网关下各自拿到分配的ip，此时两个容器的网络是互通的。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011656881.png" alt="image-20230401165619779" style="zoom:25%;">
</blockquote>
<p>查看 bridge 网络的详细信息，并通过 grep 获取名称项</p>
<p><code>docker network inspect bridge | grep name</code></p>
<h5 id="host模式">host模式</h5>
<h6 id="介绍-2">介绍</h6>
<blockquote>
<p>直接使用宿主机的 IP 地址与外界进行通信，不再需要额外进行 NAT 转换。</p>
<p>容器将不会获得一个独立的 Network Namespace，而是和宿主机共用一个 Network space。</p>
<p>容器将不会虚拟出自己的网卡，而是直接使用宿主机的 IP 和端口。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011657895.png" alt="image-20230401165717854" style="zoom:25%;">
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d -p 8081:8080 --name tomcat81 billygoo/tomcat8-jdk8</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d -p 8082:8080 --name tomcat82 billygoo/tomcat8-jdk8</span></span><br></pre></td></tr></table></figure>
<p>如果在 docker run 命令中同时使用了 --network host 和 -p端口映射，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -p 8082:8080 --network host tomcat</span></span><br></pre></td></tr></table></figure>
<p>那么会出现一个警告：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;WARNING: Published ports are discarded when using host network mode</span><br></pre></td></tr></table></figure>
<p>因为此时已经使用了<code>host</code>模式，本身就是直接使用的宿主机的IP和端口，此时的<code>-p</code>端口映射就没有了意义，也不会生效，端口号还是会以主机端口号为主。</p>
<p>正确做法是：不再进行<code>-p</code>端口映射，或者改用<code>bridge</code>模式</p>
</blockquote>
<h5 id="none模式">none模式</h5>
<h6 id="介绍-3">介绍</h6>
<blockquote>
<p>禁用网络功能;</p>
<p>在<code>none</code>模式下，并不为docker容器进行任何网络配置。进入容器内，使用 <code>ip addr</code>查看网卡信息，只能看到 <code>lo</code>（本地回环网络<code>127.0.0.1</code>网卡）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8084:8080 --network none --name tomcat84 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="container模式">container模式</h5>
<h6 id="介绍-4">介绍</h6>
<blockquote>
<p>新建的容器和已经存在的一个容器共享网络IP配置，而不是和宿主机共享。</p>
<p>新创建的容器不会创建自己的网卡、IP，而是和一个指定的容器共享IP、端口范围。两个容器除了网络共享，其他的如文件系统、进程列表依然是隔离的。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011658625.webp" alt="img" style="zoom:25%;">
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011705812.png" style="zoom:25%;">
</blockquote>
<h4 id="自定义网络">自定义网络</h4>
<blockquote>
<p>容器间的互联和通信以及端口映射。</p>
<p>容器 IP 变动时候可以通过服务名直接网络通信而不受影响。（类似Eureka，通过服务名直接互相通信，而不是写死IP地址）。</p>
<p>docker中还有一个 <code>--link</code> 进行容器网络互联，但是已经被标记为过时的，可能会在将来的版本中移除这个功能。推荐使用自定义网络替换link</p>
</blockquote>
<h5 id="自定义桥接网络（自定义网络默认使用的是桥接网络-bridge）">自定义桥接网络（自定义网络默认使用的是桥接网络 <code>bridge</code>）</h5>
<blockquote>
<p><strong>新建自定义网络</strong>  <code>docker network create tomcat_network</code></p>
<p><strong>查看网络列表</strong>   <code>docker network ls</code></p>
<p><strong>创建容器时</strong>，<strong>指定加入我们自定义的网络中</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d -p 8081:8080 --network tomcat_network --name tomcat1 tomcat:8.5-jdk8-corretto</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker run -d -p 8082:8080 --network tomcat_network --name tomcat2 tomcat:8.5-jdk8-corretto</span></span><br></pre></td></tr></table></figure>
<p>此时进入<code>tomcat1</code>中，使用<code>ping</code>命令测试连接<code>tomcat2</code>容器名，发现可以正常连通</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 安装ifconfig命令</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">yum install -y net-tools</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 安装ip addr命令</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">yum install -y iproute</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 安装ping命令</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">yum install -y iputils</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="comment"># 直接ping容器名，不需要ping IP地址</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">ping tomcat2</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>==自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）==</p>
</blockquote>
</blockquote>
<h5 id="link连接">link连接</h5>
<p><strong>演示</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动一台mysql容器</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name 为容器指定一个别名</span></span><br><span class="line">docker run --name mysql-matomo -p 3308:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:8.0.28</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动另一个容器，通过--<span class="built_in">link</span>连接到mysql容器</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--<span class="built_in">link</span> 容器名称:本容器连接对方时的别名</span></span><br><span class="line">docker run -d -p 8888:80 --link mysql-matomo:db --name matomo matomo:4.9.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时，在matomo容器中，便可以通过 db 这个hostname连接到mysql-matomo容器，而无须再通过ip</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连接地址：db:3306</span></span><br></pre></td></tr></table></figure>
<h4 id="Docker平台架构图解">Docker平台架构图解</h4>
<h5 id="整体说明"><strong>整体说明</strong></h5>
<p>从其架构和运行流程来看，Docker 是一个 C/S 模式的架构，后端是一个松耦合架构，众多模块各司其职。</p>
<blockquote>
<h6 id="Docker-运行的基本流程为：">Docker 运行的基本流程为：</h6>
<p>1 用户是使用 Docker Client 与 Docker Daemon 建立通信，并发送请求给后者。</p>
<p>2 Docker Daemon 作为 Docker 架构中的主体部分，首先提供 Docker Server 的功能使其可以接受 Docker Client 的请求。</p>
<p>3 Docker Engine 执行 Docker 内部的一系列工作，每一项工作都是以一个 Job 的形式的存在。</p>
<p>4 Job 的运行过程中，当需要容器镜像时，则从 Docker Registry 中下载镜像，并通过镜像管理驱动 Graph driver将下载镜像以Graph的形式存储。</p>
<p>5 当需要为 Docker 创建网络环境时，通过网络管理驱动 Network driver 创建并配置 Docker 容器网络环境。</p>
<p>6 当需要限制 Docker 容器运行资源或执行用户指令等操作时，则通过 Execdriver 来完成。</p>
<p>7 Libcontainer是一项独立的容器管理包，Network driver以及Exec driver都是通过Libcontainer来实现具体对容器进行的操作。</p>
</blockquote>
<h5 id="整体架构"><strong>整体架构</strong></h5>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011713071.png" alt="image-20230401171342022" style="zoom:25%;">
<h3 id="Docker-compose容器编排">Docker-compose容器编排</h3>
<h4 id="介绍-5">介绍</h4>
<blockquote>
<p>Docker-Compose是Docker官方的开源项目， 负责实现对Docker容器集群的快速编排。</p>
<p><code>Docker-Compose</code>可以管理多个Docker容器组成一个应用。需要定义一个yaml格式的配置文件 <code>docker-compose.yml</code>，配置好多个容器之间的调用关系，然后只需要一个命令就能同时启动/关闭这些容器。</p>
<p>Docker建议我们每个容器中只运行一个服务，因为Docker容器本身占用资源极少，所以最好是将每个服务单独的分割开来。但是如果我们需要同时部署多个服务，每个服务单独构建镜像构建容器就会比较麻烦。所以 Docker 官方推出了 <code>docker-compose</code> 多服务部署的工具。</p>
<p>Compose允许用户通过一个单独的 <code>docker-compose.yml</code> 模板文件来定义一组相关联的应用容器为一个项目（<code>project</code>）。可以很容易的用一个配置文件定义一个多容器的应用，然后使用一条指令安装这个应用的所有依赖，完成构建。</p>
</blockquote>
<p>官网   <a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/compose/compose-file/compose-file-v3/">https://docs.docker.com/compose/compose-file/compose-file-v3/</a></p>
<p>官网下载   <a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
<p>安装步骤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例如从github下载 2.5.0版本的docker-compose</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载下来的文件放到 /usr/local/bin目录下，命名为 docker-compose</span></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加权限</span></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证</span></span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>
<h4 id="Compose核心概念">Compose核心概念</h4>
<p>一文件     <code>docker-compose.yml</code></p>
<p>两要素</p>
<ul>
<li>
<p>服务（service）         一个个应用容器实例，比如订单微服务、库存微服务、mysql容器、nginx容器或者redis容器</p>
</li>
<li>
<p>工程（project）         由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。</p>
</li>
</ul>
<h4 id="Compose使用的三个步骤">Compose使用的三个步骤</h4>
<ul>
<li>编写Dockerfile定义各个微服务应用并构建出对应的镜像文件</li>
<li>使用 docker-compose.yml 定义一个完整业务单元，安排好整体应用中的各个容器服务。</li>
<li>最后，执行docker-compose up命令 来启动并运行整个应用程序，完成一键部署上线</li>
</ul>
<h4 id="Compose常用命令">Compose常用命令</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -h                           # 查看帮助</span><br><span class="line"></span><br><span class="line">docker-compose up                           # 启动所有docker-compose服务</span><br><span class="line"></span><br><span class="line">docker-compose up -d                        # 启动所有docker-compose服务并后台运行</span><br><span class="line"></span><br><span class="line">docker-compose down                         # 停止并删除容器、网络、卷、镜像。</span><br><span class="line"></span><br><span class="line">docker-compose exec  yml里面的服务id                 # 进入容器实例内部  docker-compose exec docker-compose.yml文件中写的服务id /bin/bash</span><br><span class="line"></span><br><span class="line">docker-compose ps                      # 展示当前docker-compose编排过的运行的所有容器</span><br><span class="line"></span><br><span class="line">docker-compose top                     # 展示当前docker-compose编排过的容器进程</span><br><span class="line"></span><br><span class="line">docker-compose logs  yml里面的服务id     # 查看容器输出日志</span><br><span class="line"></span><br><span class="line">docker-compose config     # 检查配置</span><br><span class="line"></span><br><span class="line">docker-compose config -q  # 检查配置，有问题才有输出</span><br><span class="line"></span><br><span class="line">docker-compose restart   # 重启服务</span><br><span class="line"></span><br><span class="line">docker-compose start     # 启动服务</span><br><span class="line"></span><br><span class="line">docker-compose stop      # 停止服务</span><br></pre></td></tr></table></figure>
<h4 id="Compose编排微服务">Compose编排微服务</h4>
<h5 id="改造升级微服务工程docker-boot">改造升级微服务工程docker_boot</h5>
<p><strong>前置</strong></p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011720937.png" style="zoom:25%;">
<p><strong>编写Dockerfile</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础镜像使用java</span></span><br><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 作者</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> zzyy</span><br><span class="line"></span><br><span class="line"><span class="comment"># VOLUME 指定临时文件目录为/tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /tmp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将jar包添加到容器中并更名为zzyy_docker.jar</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行jar包</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> bash -c <span class="string">&#x27;touch /zzyy_docker.jar&#x27;</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/zzyy_docker.jar&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露6001端口作为微服务</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">6001</span></span><br></pre></td></tr></table></figure>
<p>构建镜像          <code>docker build -t zzyy_docker:1.6 .</code></p>
<h5 id="不用Compose">不用Compose</h5>
<h6 id="步骤">步骤</h6>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011723525.png" alt="image-20230401172326483" style="zoom:33%;">
<h6 id="虽然成功但是有问题">虽然成功但是有问题?</h6>
<blockquote>
<ul>
<li>
<p>先后顺序要求固定，先mysql+redis才能微服务访问成功</p>
</li>
<li>
<p>多个run命令…</p>
</li>
<li>
<p>容器间的启停或宕机，有可能导致IP地址对应的容器实例变化，映射出错， 要么生产IP写死(可以但是不推荐)，要么通过服务调用</p>
</li>
</ul>
</blockquote>
<h5 id="使用Compose">使用Compose</h5>
<blockquote>
<p>服务编排，一套带走，安排</p>
</blockquote>
<p>编写docker-compose.yml文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose文件版本号</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置各个容器服务</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">microService:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">springboot_docker:1.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ms01</span>  <span class="comment"># 容器名称，如果不指定，会生成一个服务名加上前缀的容器名</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6001:6001&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/microService:/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">springboot_network</span></span><br><span class="line">    <span class="attr">depends_on:</span>  <span class="comment"># 配置该容器服务所依赖的容器服务</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.0.8</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/redis/redis.conf:/etc/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/redis/data:data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">springboot_network</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">/etc/redis/redis.conf</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_ALLOW_EMPTY_PASSWORD:</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">&#x27;db_springboot&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">&#x27;springboot&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">&#x27;springboot&#x27;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/mysql/db:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/mysql/conf/my.cnf:/etc/my.cnf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/mysql/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">springboot_network</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--default-authentication-plugin=mysql_native_password</span> <span class="comment"># 解决外部无法访问</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="comment"># 创建 springboot_network 网桥网络</span></span><br><span class="line">  <span class="attr">springboot_network:</span></span><br></pre></td></tr></table></figure>
<p>编写完成<code>docker-compose.yml</code>后，进行语法检查：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进行语法检查</span></span><br><span class="line">docker-compose config -q</span><br></pre></td></tr></table></figure>
<p><strong>第二次修改微服务工程</strong>docker_boot</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011724445.png" alt="image-20230401172449400" style="zoom:25%;">
<p><strong>执行</strong> <code>docker-compose up</code> 或者 执行 <code>docker-compose up -d</code></p>
<p><strong>进入mysql容器实例并新建库db2021+新建表t_user</strong></p>
<p><strong>测试通过</strong></p>
<p>关停    <code> docker-compose stop</code></p>
<h3 id="Docker轻量级可视化工具Portainer">Docker轻量级可视化工具Portainer</h3>
<h4 id="是什么-5">是什么</h4>
<blockquote>
<p>Portainer 是一款轻量级的应用，它提供了图形化界面，用于方便地管理Docker环境，包括单机环境和集群环境。</p>
</blockquote>
<h4 id="安装">安装</h4>
<p><strong>官网</strong></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.portainer.io/">https://www.portainer.io/</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux">https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux</a></p>
<p><strong>步骤</strong></p>
<p><strong>docker命令安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 旧版镜像地址为portainer/portainer，从2022年1月标记为过期</span></span><br><span class="line"><span class="comment"># 新版镜像地址为portainer/portainer-ce</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --restart=always 如果Docker引擎重启了，那么这个容器实例也会在Docker引擎重启后重启，类似开机自启</span></span><br><span class="line">docker run -d -p 8000:8000 -p 9000:9000 --name portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce:2.13.0-alpine</span><br></pre></td></tr></table></figure>
<p><strong>第一次登录需创建admin，访问地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://xxx.xxx.xxx.xxx:9000">xxx.xxx.xxx.xxx:9000</a></strong></p>
<p>首次进来时，需要创建 admin 的用户名（默认admin）、密码（必须满足校验规则，例如portainer.io123）。</p>
<p>选择 local管理本地docker，即可看到本地Docker的详细信息，包括其中的镜像（images）、容器（containers）、网络（networks）、容器卷（volumes）、compose编排（stacks）等等。</p>
<h3 id="Docker容器监控之-CAdvisor-InfluxDB-Granfana">Docker容器监控之 CAdvisor+InfluxDB+Granfana</h3>
<h4 id="CIG">CIG</h4>
<p>通过<code>docker stats</code> 命令可以很方便的查看当前宿主机上所有容器的CPU、内存、网络流量等数据，可以满足一些小型应用。</p>
<p>但是 <code>docker stats</code> 统计结果只能是当前宿主机的全部容器，数据资料是实时的，没有地方存储、没有健康指标过线预警等功能。</p>
<p>CAdvisor（监控收集） + InfluxDB（存储数据） + Granfana（展示图表），合称 <code>CIG</code>。</p>
<img src="https://gitee.com/Ryang1118/typora/raw/master/images/202304011729933.png" alt="img" style="zoom:25%;">
<h5 id="CAdvisor">CAdvisor</h5>
<p>CAdvisor是一个容器资源监控工具，包括容器的内存、CPU、网络IO、磁盘IO等监控，同时提供了一个Web页面用于查看容器的实时运行状态。</p>
<p>CAdvisor默认存储2分钟的数据，而且只是针对单物理机。不过CAdvisor提供了很多数据集成接口，支持 InfluxDB、Redis、Kafka、Elasticsearch等集成，可以加上对应配置将监控数据发往这些数据库存储起来。</p>
<p>CAdvisor主要功能：</p>
<ul>
<li>
<p>展示Host和容器两个层次的监控数据</p>
</li>
<li>
<p>展示历史变化数据</p>
</li>
</ul>
<h5 id="InfluxDB">InfluxDB</h5>
<p>InfluxDB是用Go语言编写的一个开源分布式时序、事件和指标数据库，无需外部依赖。</p>
<p>CAdvisor默认只在本机保存2分钟的数据，为了持久化存储数据和统一收集展示监控数据，需要将数据存储到InfluxDB中。InfluxDB是一个时序数据库，专门用于存储时序相关数据，很适合存储 CAdvisor 的数据。而且 CAdvisor本身已经提供了InfluxDB的集成方法，在启动容器时指定配置即可。</p>
<p>InfluxDB主要功能：</p>
<ul>
<li>
<p>基于时间序列，支持与时间有关的相关函数（如最大、最小、求和等）</p>
</li>
<li>
<p>可度量性，可以实时对大量数据进行计算</p>
</li>
<li>
<p>基于事件，支持任意的事件数据</p>
</li>
</ul>
<h5 id="Granfana">Granfana</h5>
<p>Grafana是一个开源的数据监控分析可视化平台，支持多种数据源配置（支持的数据源包括InfluxDB、MySQL、Elasticsearch、OpenTSDB、Graphite等）和丰富的插件及模板功能，支持图表权限控制和报警。</p>
<p>Granfana主要功能：</p>
<ul>
<li>
<p>灵活丰富的图形化选项</p>
</li>
<li>
<p>可以混合多种风格</p>
</li>
<li>
<p>支持白天和夜间模式</p>
</li>
<li>
<p>多个数据源</p>
</li>
</ul>
<h4 id="compose容器编排">compose容器编排</h4>
<p><strong>docker-compose.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">grafana_data:</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">influxdb:</span></span><br><span class="line">	<span class="comment"># tutum/influxdb 相比influxdb多了web可视化视图。但是该镜像已被标记为已过时</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">tutum/influxdb:0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PRE_CREATE_DB=cadvisor</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8083:8083&quot;</span>         <span class="comment"># 数据库web可视化页面端口</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8086:8086&quot;</span>         <span class="comment"># 数据库端口</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/influxdb:/data</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cadvisor:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">google/cadvisor:v0.32.0</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">influxdb:influxsrv</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-storage_driver=influxdb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-storage_driver_db=cadvisor</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-storage_driver_host=influxsrv:8086</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/:/rootfs:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run:/var/run:rw</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/sys:/sys:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/lib/docker/:/var/lib/docker:ro</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:8.5.2</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">&#x27;104&#x27;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">influxdb:influxsrv</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">grafana_data:/var/lib/grafana</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">HTTP_USER=admin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">HTTP_PASS=admin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">INFLUXDB_HOST=influxsrv</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">INFLUXDB_PORT=8086</span></span><br></pre></td></tr></table></figure>
<p><strong>检查语法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose config -q </span><br></pre></td></tr></table></figure>
<p><strong>创建并启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>查看三个服务容器是否启动</p>
<p>测试</p>
<ul>
<li>
<p>浏览cAdvisor收集服务，<a target="_blank" rel="noopener external nofollow noreferrer" href="http://ip:8080/">http://ip:8080/</a>      第一次访问慢，请稍等   cadvisor也有基础的图形展现功能，这里主要用它来作数据采集</p>
</li>
<li>
<p>浏览influxdb存储服务，<a target="_blank" rel="noopener external nofollow noreferrer" href="http://ip:8083/">http://ip:8083/</a></p>
</li>
<li>
<p>浏览grafana展现服务，<a target="_blank" rel="noopener external nofollow noreferrer" href="http://ip:3000">http://ip:3000</a>          ip+3000端口的方式访问,默认帐户密码（admin/admin）</p>
</li>
</ul>
<h4 id="Grafana配置">Grafana配置</h4>
<h5 id="添加数据源">添加数据源</h5>
<p>在<code>Configuration</code>（小齿轮）选项卡中，选择<code>Data Sources</code>，添加一个InfluxDB数据源：</p>
<ul>
<li>
<p>name：自定义一个数据源名称，例如<code>InfluxDB</code></p>
</li>
<li>
<p>Query Language：查询语言，默认<code>InfluxQL</code>即可</p>
</li>
<li>
<p>URL：根据compose中的容器服务名连接，<code>http://influxdb:8086</code></p>
</li>
<li>
<p>database：我们在InfluxDB中创建的数据库实例，<code>cadvisor</code></p>
</li>
<li>
<p>User：InfluxDB的默认用户，<code>root</code></p>
</li>
<li>
<p>Password：<code>root</code></p>
</li>
</ul>
<p>保存并测试，可以连通即可</p>
<h5 id="添加工作台">添加工作台</h5>
<ul>
<li>
<p>在<code>Create</code>（加号）选项卡中，选择创建 <code>Dash Board</code>工作台。右上角配置中可以配置创建出来的工作台的标题、文件夹等信息。</p>
</li>
<li>
<p>在创建出来的工作台中，选择<code>Add panel</code>中的<code>Add a new panel</code>添加一个新的面板。</p>
</li>
</ul>
<ol>
<li>
<ol>
<li>在右上角<code>Time series</code>（时序图）位置可以切换展示的图表样式（柱状图、仪表盘、表格、饼图等等）</li>
</ol>
</li>
<li>右侧边栏为该图表配置相关信息：标题、描述</li>
<li>图表下方可以配置该图表展示的数据的查询语句，例如：</li>
</ol>
<ul>
<li>
<ul>
<li>
<ul>
<li>FROM：<code>cpu_usage_total</code>（Grafana会自动获取InfluxDB数据库中的元数据，可以直接选择对应表名）</li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>WHERE：添加一个条件，<code>container_name=cig-cadvisor-1</code></li>
</ul>
</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>ALIAS：配置一个别名，<code>CPU使用情况汇总</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://rycan.top">Ryang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://rycan.top/post/f5f9fa9b.html">http://rycan.top/post/f5f9fa9b.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://rycan.top" target="_blank">杨睿的学习手记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="/img/43.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><!--.post-reward--><!--  .reward-button--><!--    i.fas.fa-qrcode--><!--    = ' ' + _p('donate')--><!--  .reward-main--><!--    ul.reward-all--><!--      each item in theme.reward.QR_code--><!--        - var clickTo = item.link ? item.link : item.img--><!--        li.reward-item--><!--          a(href=url_for(clickTo) target='_blank')--><!--            img.post-qr-code-img(src=url_for(item.img) alt=item.text)--><!--          .post-qr-code-desc=item.text--><link rel="stylesheet" href="/" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">打赏</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/554bb3d.html" title="Java-语法"><img class="cover" src="/img/47.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java-语法</div></div></a></div><div class="next-post pull-right"><a href="/post/d48132d3.html" title="ElasticSearch"><img class="cover" src="/img/45.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ElasticSearch</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Livere</span><span class="switch-btn"></span><span class="second-comment">Valine</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODY2MC8zNTEyMg=="></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">Docker基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E7%90%86%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">Docker理念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-%E5%92%8C%E4%BC%A0%E7%BB%9F%E8%99%9A%E6%8B%9F%E5%8C%96%E6%96%B9%E5%BC%8F%E7%9A%84%E4%B8%8D%E5%90%8C%E4%B9%8B%E5%A4%84%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">Docker 和传统虚拟化方式的不同之处：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%AB%99"><span class="toc-number">1.3.</span> <span class="toc-text">网站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">1.4.</span> <span class="toc-text">Docker的基本组成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F-image"><span class="toc-number">1.4.1.</span> <span class="toc-text">镜像(image)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8-container"><span class="toc-number">1.4.2.</span> <span class="toc-text">容器(container)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%93%E5%BA%93-repository"><span class="toc-number">1.4.3.</span> <span class="toc-text">仓库(repository)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">1.5.</span> <span class="toc-text">总结：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#run%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.</span> <span class="toc-text">run过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">Docker底层原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88Docker%E4%BC%9A%E6%AF%94VM%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BF%AB"><span class="toc-number">1.7.1.</span> <span class="toc-text">为什么Docker会比VM虚拟机快</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.</span> <span class="toc-text">Docker命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.1.</span> <span class="toc-text">帮助启动类命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA-%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-number">1.8.3.</span> <span class="toc-text">新建+启动容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%AE%88%E6%8A%A4%E5%BC%8F%E5%AE%B9%E5%99%A8-%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.8.4.</span> <span class="toc-text">启动守护式容器(后台服务器)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9Adocker-ps-a-%E8%BF%9B%E8%A1%8C%E6%9F%A5%E7%9C%8B-%E4%BC%9A%E5%8F%91%E7%8E%B0%E5%AE%B9%E5%99%A8%E5%B7%B2%E7%BB%8F%E9%80%80%E5%87%BA"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">问题：docker ps -a 进行查看, 会发现容器已经退出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#redis-%E5%89%8D%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E6%BC%94%E7%A4%BAcase"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">redis 前后台启动演示case</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.8.5.</span> <span class="toc-text">总结:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F"><span class="toc-number">1.9.</span> <span class="toc-text">Docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UnionFS%EF%BC%88%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="toc-number">1.9.1.</span> <span class="toc-text">UnionFS（联合文件系统）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.9.2.</span> <span class="toc-text">Docker镜像加载原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-Docker-%E9%95%9C%E5%83%8F%E8%A6%81%E9%87%87%E7%94%A8%E8%BF%99%E7%A7%8D%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84%E5%91%A2"><span class="toc-number">1.9.3.</span> <span class="toc-text">为什么 Docker 镜像要采用这种分层结构呢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8Fcommit%E6%93%8D%E4%BD%9C%E6%A1%88%E4%BE%8B"><span class="toc-number">1.9.4.</span> <span class="toc-text">Docker镜像commit操作案例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">1.9.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">1.10.</span> <span class="toc-text">本地镜像发布到阿里云</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E7%9A%84%E7%94%9F%E6%88%90%E6%96%B9%E6%B3%95"><span class="toc-number">1.10.1.</span> <span class="toc-text">镜像的生成方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">1.10.2.</span> <span class="toc-text">将本地镜像推送到阿里云</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">1.10.3.</span> <span class="toc-text">将镜像推送到阿里云</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%8A%E7%9A%84%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="toc-number">1.10.4.</span> <span class="toc-text">将阿里云上的镜像下载到本地</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93"><span class="toc-number">1.11.</span> <span class="toc-text">本地镜像发布到私有库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93"><span class="toc-number">1.11.1.</span> <span class="toc-text">将本地镜像推送到私有库</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8FDocker-Registry"><span class="toc-number">1.11.1.1.</span> <span class="toc-text">下载镜像Docker Registry</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%A7%81%E6%9C%89%E5%BA%93Registry%EF%BC%8C%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%9C%AC%E5%9C%B0%E6%9C%89%E4%B8%AA%E7%A7%81%E6%9C%89Docker-hub"><span class="toc-number">1.11.1.2.</span> <span class="toc-text">运行私有库Registry，相当于本地有个私有Docker hub</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#commit%E6%88%91%E4%BB%AC%E8%87%AA%E5%B7%B1%E7%9A%84%E6%96%B0%E9%95%9C%E5%83%8F"><span class="toc-number">1.11.1.3.</span> <span class="toc-text">commit我们自己的新镜像</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#curl%E9%AA%8C%E8%AF%81%E7%A7%81%E6%9C%8D%E5%BA%93%E4%B8%8A%E6%9C%89%E4%BB%80%E4%B9%88%E9%95%9C%E5%83%8F"><span class="toc-number">1.11.2.</span> <span class="toc-text">curl验证私服库上有什么镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%86%E6%96%B0%E9%95%9C%E5%83%8Fzzyyubuntu-1-2%E4%BF%AE%E6%94%B9%E7%AC%A6%E5%90%88%E7%A7%81%E6%9C%8D%E8%A7%84%E8%8C%83%E7%9A%84Tag"><span class="toc-number">1.11.2.1.</span> <span class="toc-text">将新镜像zzyyubuntu:1.2修改符合私服规范的Tag</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%BF%E4%B9%8B%E6%94%AF%E6%8C%81http"><span class="toc-number">1.11.2.2.</span> <span class="toc-text">修改配置文件使之支持http</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#push%E6%8E%A8%E9%80%81%E5%88%B0%E7%A7%81%E6%9C%8D%E5%BA%93"><span class="toc-number">1.11.2.3.</span> <span class="toc-text">push推送到私服库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#curl%E9%AA%8C%E8%AF%81%E7%A7%81%E6%9C%8D%E5%BA%93%E4%B8%8A%E6%9C%89%E4%BB%80%E4%B9%88%E9%95%9C%E5%83%8F-2"><span class="toc-number">1.11.2.4.</span> <span class="toc-text">curl验证私服库上有什么镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pull%E5%88%B0%E6%9C%AC%E5%9C%B0%E5%B9%B6%E8%BF%90%E8%A1%8C"><span class="toc-number">1.11.2.5.</span> <span class="toc-text">pull到本地并运行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.12.</span> <span class="toc-text">Docker容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8D%B7%E8%AE%B0%E5%BE%97%E5%8A%A0%E5%85%A5"><span class="toc-number">1.12.1.</span> <span class="toc-text">容器卷记得加入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.12.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">1.12.3.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%A1%88%E4%BE%8B"><span class="toc-number">1.12.4.</span> <span class="toc-text">数据卷案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AE%BF%E4%B8%BBvs%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E6%98%A0%E5%B0%84%E6%B7%BB%E5%8A%A0%E5%AE%B9%E5%99%A8%E5%8D%B7"><span class="toc-number">1.12.4.1.</span> <span class="toc-text">1 宿主vs容器之间映射添加容器卷</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%AF%BB%E5%86%99%E8%A7%84%E5%88%99%E6%98%A0%E5%B0%84%E6%B7%BB%E5%8A%A0%E8%AF%B4%E6%98%8E"><span class="toc-number">1.12.4.2.</span> <span class="toc-text">2 读写规则映射添加说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%8D%B7%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E5%85%B1%E4%BA%AB"><span class="toc-number">1.12.4.3.</span> <span class="toc-text">3 卷的继承和共享</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%B8%B8%E8%A7%84%E5%AE%89%E8%A3%85"><span class="toc-number">1.13.</span> <span class="toc-text">Docker常规安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.13.1.</span> <span class="toc-text">总体步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E8%BF%9B%E9%98%B6"><span class="toc-number">2.</span> <span class="toc-text">Docker 进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">2.1.</span> <span class="toc-text">MySQL主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.1.</span> <span class="toc-text">主从复制原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.1.2.</span> <span class="toc-text">主从搭建步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E9%9B%86%E7%BE%A4"><span class="toc-number">2.2.</span> <span class="toc-text">redis集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E7%A7%8D%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">2.2.2.</span> <span class="toc-text">3种解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%93%88%E5%B8%8C%E5%8F%96%E4%BD%99%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">1、哈希取余分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">2、一致性哈希算法分区</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#3%E5%A4%A7%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.2.2.1.</span> <span class="toc-text">3大步骤</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">2.2.2.2.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">2.2.2.2.3.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.2.2.4.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%93%88%E5%B8%8C%E6%A7%BD%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">3 哈希槽分区</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-2"><span class="toc-number">2.2.2.3.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BA%E7%8E%B0-img-src-https-gitee-com-Ryang1118-typora-raw-master-images-202304011533650-png-alt-image-20230401153252082-style-zoom-25"><span class="toc-number">2.2.2.3.2.</span> <span class="toc-text">为什么出现                   </span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88"><span class="toc-number">2.2.2.3.3.</span> <span class="toc-text">能干什么</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A4%9A%E5%B0%91%E4%B8%AAhash%E6%A7%BD"><span class="toc-number">2.2.2.3.4.</span> <span class="toc-text">多少个hash槽</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E6%A7%BD%E8%AE%A1%E7%AE%97"><span class="toc-number">2.2.2.3.5.</span> <span class="toc-text">哈希槽计算</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-number">2.2.3.</span> <span class="toc-text">案例演示</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E4%B8%BB3%E4%BB%8Eredis%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">3主3从redis集群配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%AE%B9%E9%94%99%E5%88%87%E6%8D%A2%E8%BF%81%E7%A7%BB%E6%A1%88%E4%BE%8B"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">主从容错切换迁移案例</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99%E5%AD%98%E5%82%A8"><span class="toc-number">2.2.3.2.1.</span> <span class="toc-text">数据读写存储</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%B9%E9%94%99%E5%88%87%E6%8D%A2%E8%BF%81%E7%A7%BB"><span class="toc-number">2.2.3.2.2.</span> <span class="toc-text">容错切换迁移</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E6%89%A9%E5%AE%B9%E6%A1%88%E4%BE%8B"><span class="toc-number">2.2.3.3.</span> <span class="toc-text">主从扩容案例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E7%BC%A9%E5%AE%B9%E6%A1%88%E4%BE%8B"><span class="toc-number">2.2.3.4.</span> <span class="toc-text">主从缩容案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerFile%E8%A7%A3%E6%9E%90"><span class="toc-number">2.3.</span> <span class="toc-text">DockerFile解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-3"><span class="toc-number">2.3.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="toc-number">2.3.2.</span> <span class="toc-text">DockerFile构建过程解析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Dockerfile%E5%86%85%E5%AE%B9%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">Dockerfile内容基础知识</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Docker%E6%89%A7%E8%A1%8CDockerfile%E7%9A%84%E5%A4%A7%E8%87%B4%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">Docker执行Dockerfile的大致流程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-2"><span class="toc-number">2.3.3.</span> <span class="toc-text">小总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DockerFile%E5%B8%B8%E7%94%A8%E4%BF%9D%E7%95%99%E5%AD%97%E6%8C%87%E4%BB%A4"><span class="toc-number">2.3.4.</span> <span class="toc-text">DockerFile常用保留字指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA-2"><span class="toc-number">2.3.5.</span> <span class="toc-text">案例演示</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8Fmycentosjava8"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">自定义镜像mycentosjava8</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F"><span class="toc-number">2.3.5.2.</span> <span class="toc-text">虚悬镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8Fmyubuntu"><span class="toc-number">2.3.5.3.</span> <span class="toc-text">自定义镜像myubuntu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-3"><span class="toc-number">2.3.5.4.</span> <span class="toc-text">小总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98"><span class="toc-number">2.4.</span> <span class="toc-text">Docker微服务实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87IDEA%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="toc-number">2.4.1.</span> <span class="toc-text">通过IDEA新建一个普通微服务模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87dockerfile%E5%8F%91%E5%B8%83%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%88%B0docker%E5%AE%B9%E5%99%A8"><span class="toc-number">2.4.2.</span> <span class="toc-text">通过dockerfile发布微服务部署到docker容器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">2.5.</span> <span class="toc-text">Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-4"><span class="toc-number">2.5.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">2.5.2.</span> <span class="toc-text">常用基本命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker%E7%BD%91%E7%BB%9C%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">2.5.3.</span> <span class="toc-text">Docker网络的作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.5.4.</span> <span class="toc-text">网络模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bridge%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.5.4.1.</span> <span class="toc-text">bridge模式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.5.4.1.1.</span> <span class="toc-text">介绍</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#host%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.5.4.2.</span> <span class="toc-text">host模式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">2.5.4.2.1.</span> <span class="toc-text">介绍</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#none%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.5.4.3.</span> <span class="toc-text">none模式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">2.5.4.3.1.</span> <span class="toc-text">介绍</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#container%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.5.4.4.</span> <span class="toc-text">container模式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-4"><span class="toc-number">2.5.4.4.1.</span> <span class="toc-text">介绍</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">2.5.5.</span> <span class="toc-text">自定义网络</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C%EF%BC%88%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%E9%BB%98%E8%AE%A4%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C-bridge%EF%BC%89"><span class="toc-number">2.5.5.1.</span> <span class="toc-text">自定义桥接网络（自定义网络默认使用的是桥接网络 bridge）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#link%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.5.5.2.</span> <span class="toc-text">link连接</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker%E5%B9%B3%E5%8F%B0%E6%9E%B6%E6%9E%84%E5%9B%BE%E8%A7%A3"><span class="toc-number">2.5.6.</span> <span class="toc-text">Docker平台架构图解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E8%AF%B4%E6%98%8E"><span class="toc-number">2.5.6.1.</span> <span class="toc-text">整体说明</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Docker-%E8%BF%90%E8%A1%8C%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B%E4%B8%BA%EF%BC%9A"><span class="toc-number">2.5.6.1.1.</span> <span class="toc-text">Docker 运行的基本流程为：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">2.5.6.2.</span> <span class="toc-text">整体架构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-compose%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="toc-number">2.6.</span> <span class="toc-text">Docker-compose容器编排</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-5"><span class="toc-number">2.6.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compose%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">2.6.2.</span> <span class="toc-text">Compose核心概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compose%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%89%E4%B8%AA%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.6.3.</span> <span class="toc-text">Compose使用的三个步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compose%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.4.</span> <span class="toc-text">Compose常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compose%E7%BC%96%E6%8E%92%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.6.5.</span> <span class="toc-text">Compose编排微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%94%B9%E9%80%A0%E5%8D%87%E7%BA%A7%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%B7%A5%E7%A8%8Bdocker-boot"><span class="toc-number">2.6.5.1.</span> <span class="toc-text">改造升级微服务工程docker_boot</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E7%94%A8Compose"><span class="toc-number">2.6.5.2.</span> <span class="toc-text">不用Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.6.5.2.1.</span> <span class="toc-text">步骤</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%99%BD%E7%84%B6%E6%88%90%E5%8A%9F%E4%BD%86%E6%98%AF%E6%9C%89%E9%97%AE%E9%A2%98"><span class="toc-number">2.6.5.2.2.</span> <span class="toc-text">虽然成功但是有问题?</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Compose"><span class="toc-number">2.6.5.3.</span> <span class="toc-text">使用Compose</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7Portainer"><span class="toc-number">2.7.</span> <span class="toc-text">Docker轻量级可视化工具Portainer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-5"><span class="toc-number">2.7.1.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.7.2.</span> <span class="toc-text">安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E4%B9%8B-CAdvisor-InfluxDB-Granfana"><span class="toc-number">2.8.</span> <span class="toc-text">Docker容器监控之 CAdvisor+InfluxDB+Granfana</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CIG"><span class="toc-number">2.8.1.</span> <span class="toc-text">CIG</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CAdvisor"><span class="toc-number">2.8.1.1.</span> <span class="toc-text">CAdvisor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#InfluxDB"><span class="toc-number">2.8.1.2.</span> <span class="toc-text">InfluxDB</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Granfana"><span class="toc-number">2.8.1.3.</span> <span class="toc-text">Granfana</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compose%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="toc-number">2.8.2.</span> <span class="toc-text">compose容器编排</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Grafana%E9%85%8D%E7%BD%AE"><span class="toc-number">2.8.3.</span> <span class="toc-text">Grafana配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">2.8.3.1.</span> <span class="toc-text">添加数据源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0"><span class="toc-number">2.8.3.2.</span> <span class="toc-text">添加工作台</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By Ryang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><!--button#darkmode(type="button" title=_p('rightside.night_mode_title'))--><!--  i.fas.fa-adjust--><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"></svg><use id="modeicon" xlink:href="#icon-moon"></use></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();" rel="external nofollow noreferrer"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();" rel="external nofollow noreferrer"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();" rel="external nofollow noreferrer"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()" rel="external nofollow noreferrer"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()" rel="external nofollow noreferrer"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()" rel="external nofollow noreferrer"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()" rel="external nofollow noreferrer"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();" rel="external nofollow noreferrer"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();" rel="external nofollow noreferrer"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();" rel="external nofollow noreferrer"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();" rel="external nofollow noreferrer"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.19/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !true) {
  if (true) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'Adx946D8MgrhiaHCsXZfLp1L-gzGzoHsz',
      appKey: 'rvkGzSypPhV7c8TIk5TAM8iy',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: {"2020":"dc709fac0d361370bcf0d36d32adb97df7c95824.png","tv_白眼":"c1d59f439e379ee50eef488bcb5e5378e5044ea4.png","tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_难过":"87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_生气":"26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_斜眼笑":"911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_疑问":"0793d949b18d7be716078349c202c15ff166f314.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_鼓掌":"1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png","tv_抠鼻":"c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_调皮":"b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_笑哭":"1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_晕":"5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_点赞":"f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_睡着":"8b196675b53af58264f383c50ad0945048290b33.png","tv_色":"61822c7e9aae5da76475e7892534545336b23a6f.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_无奈":"ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_流汗":"cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_抓狂":"fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_黑人问号":"45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_打脸":"56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_闭嘴":"c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_鄙视":"6e72339f346a692a495b123174b49e4e8e781303.png","tv_腼腆":"89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_馋":"fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_生病":"8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_流鼻血":"c32d39db2737f89b904ca32700d140a9241b0767.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_流泪":"7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_皱眉":"72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_鬼脸":"0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_调侃":"4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_目瞪口呆":"0b8cb81a68de5d5365212c99375e7ace3e7891b7.png","2233娘_大笑":"16b8794be990cefa6caeba4d901b934a227ee3b8.png","2233娘_疑问":"0b41f509351958dbb63d472fec0132d1bd03bd14.png","2233娘_吃惊":"d1628c43d35b1530c0504a643ff80b6189fa0a43.png","2233娘_汗":"247cd9df8cdf84b18368c21e3b2dd374e84c0927.png","2233娘_大哭":"476a2a60f6e337b8c0697a592e0aa82781f6b33b.png","2233娘_困惑":"714eeb4eae0d0933b4ff08b7df788b1982f6b940.png","2233娘_耶":"d7178e258a0efc969b65ccc2b1322fb235f5dff4.png","2233娘_怒":"f31953119c51b9748016440ac0b632f779929b37.png","2233娘_卖萌":"ea893aa25355de95ab4f03c2dad3f0c58d0c159e.png","2233娘_委屈":"d9d0bf9d358af8d5761093ec66d4e3f60d963a63.png","2233娘_郁闷":"485203fe7100f2c8fc40b2800a18fe20b35f2f1a.png","2233娘_第一":"3754ee6e5985bd0bd7dfb668981f2a8733398ebd.png","2233娘_喝水":"695bf5429472049b52c1e0de586f8a2511195a23.png","2233娘_吐魂":"e999af499edf38a91ca68b1a9d2f97042c1d6734.png","2233娘_无言":"fdb5870f32cfaf7949e0f88a13f6feba4a48b719.png","热词系列_增加":"142409b595982b8210b2958f3d340f3b47942645.png","热词系列_泪目":"bba3703ab90b7d16fe9dbcb85ed949db687f8331.png","热词系列_保护":"55f8f6445ca7c3170cdfc5b16036abf639ce9b57.png","热词系列_害怕":"d77e2de26da143249f0c0ad7a608c27152c985bf.png","热词系列_爱了爱了":"2a165b555ba20391316366c664ed7891883dc5aa.png","热词系列_问号":"c1d1e76c12180adc8558f47006fe0e7ded4154bb.png","热词系列_吹爆":"b528220f9c37256ed6a37f05bf118e44b08b81e5.png","热词系列_三连":"21f15fe11b7a84d2f2121c16dec50a4e4556f865.png","热词系列_可以":"e08543c71202b36c590094417fcfbb80c3506cd8.png","热词系列_打卡":"a9cf77c78e1b9b40aa3ed4862402fba008ee2f51.png","热词系列_妙啊":"0e98299d7decf5eaffad854977946075c3e91cb8.png","热词系列_这次一定":"a01ca28923daa7cc896c42f27deb4914e20dd572.png","热词系列_AWSL":"c37f88cf799f9badf9d84b7671dc3dd98c0fc0c2.png","热词系列_递话筒":"98e6950e39fbb4dd1c576042063ca632074070ba.png","热词系列_你细品":"535e00658e7e47966f154d3a167fa2365ebc4321.png","热词系列_咕咕":"d8065c2e7ce48c929317a94553499a46fecc262a.png","热词系列_标准结局":"3de98174b510cf7dc5fd1bd08c5d881065e79137.png","热词系列_危":"5cc6c3357c4df544dd8de9d5c5c0cec97c7c9a56.png","热词系列_张三":"255a938f39cea625032b6650036b31aa26c50a3c.png","热词系列_害":"cbe798a194612958537c5282fcca7c3bcd2aa15c.png","热词系列_我裂开了":"29bd57ec4e8952880fea6c9e47aee924e91f10c4.png","热词系列_有内味了":"7ca61680a905b5b6e2e335c630e725b648b03b4d.png","热词系列_猛男必看":"c97064450528a0e45c7e7c365a15fbb13fd61d8c.png","热词系列_奥力给":"c9b8683827ec6c00fea5327c9bec14f581cef2aa.png","热词系列_我哭了":"9e0b3877d649aaf6538fbdd3f937e240a9d808e4.png","热词系列_高产":"9db817cba4a7f4a42398f3b2ec7c0a8e0c247c42.png","热词系列_我酸了":"a8cbf3f6b8cd9377eeb15b9172f3cd683b2e4650.png","热词系列_真香":"e68497c775feaac1c3b1a6cd63a50cfb11b767c4.png","热词系列_我全都要":"d424d1ad8d14c1c9b8367842bc68c658b9229bc1.png","热词系列_神仙UP":"a49e0d0db1e7d35a0f7411be13208951ab448f03.png","热词系列_你币有了":"84820c2b147a8ca02f3c4006b63f76c6313cbfa0.png","热词系列_不愧是你":"9ff2e356797c57ee3b1675ade0883d2d2247be9b.png","热词系列_锤":"35668cc12ae25b9545420e4a85bf21a0bfc03e5d.png","热词系列_秀":"50782fbf5d9b7f48f9467b5c53932981e321eedc.png","热词系列_爷关更":"faad40c56447f1f8abcb4045c17ce159d113d1fd.png","热词系列_有生之年":"f41fdafe2d0fbb8e8bc1598d2cf37e355560103a.png","热词系列_镇站之宝":"24e7a6a6e6383c987215fb905e3ee070aca259b5.png","热词系列_我太男了":"a523f3e4c63e4db1232365765d0ec452f83be97e.png","热词系列_完结撒花":"ea9db62ff5bca8e069cd70c4233353a802835422.png","热词系列_大师球":"f30089248dd137c568edabcb07cf67e0f6e98cf3.png","热词系列_知识盲区":"ccc94600b321a28116081e49ecedaa4ee8728312.png","热词系列_“狼火”":"33ccd3617bfa89e9d1498b13b7542b63f163e5de.png","加油武汉":"eb966aaa5b690d3f9308a9f936f5b5a72a7f956b.png","口罩":"3ad2f66b151496d2a5fb0a8ea75f32265d778dd3.png","鸡腿":"c7860392815d345fa69c4f00ef18d67dccfbd574.png","微笑":"685612eadc33f6bc233776c6241813385844f182.png","笑":"81edf17314cea3b48674312b4364df44d5c01f17.png","呲牙":"b5a5898491944a4268360f2e7a84623149672eb6.png","OK":"4683fd9ffc925fa6423110979d7dcac5eda297f4.png","星星眼":"63c9d1a31c0da745b61cdb35e0ecb28635675db2.png","哦呼":"362bded07ea5434886271d23fa25f5d85d8af06c.png","嫌弃":"de4c0783aaa60ec03de0a2b90858927bfad7154b.png","喜欢":"8a10a4d73a89f665feff3d46ca56e83dc68f9eb8.png","酸了":"92b1c8cbceea3ae0e8e32253ea414783e8ba7806.png","大哭":"2caafee2e5db4db72104650d87810cc2c123fc86.png","害羞":"9d2ec4e1fbd6cb1b4d12d2bbbdd124ccb83ddfda.png","无语":"44667b7d9349957e903b1b62cb91fb9b13720f04.png","疑惑":"b7840db4b1f9f4726b7cb23c0972720c1698d661.png","调皮":"8290b7308325e3179d2154327c85640af1528617.png","喜极而泣":"485a7e0c01c2d70707daae53bee4a9e2e31ef1ed.png","奸笑":"bb84906573472f0a84cebad1e9000eb6164a6f5a.png","偷笑":"6c49d226e76c42cd8002abc47b3112bc5a92f66a.png","大笑":"ca94ad1c7e6dac895eb5b33b7836b634c614d1c0.png","阴险":"ba8d5f8e7d136d59aab52c40fd3b8a43419eb03c.png","捂脸":"6921bb43f0c634870b92f4a8ad41dada94a5296d.png","囧":"12e41d357a9807cc80ef1e1ed258127fcc791424.png","呆":"33ad6000d9f9f168a0976bc60937786f239e5d8c.png","抠鼻":"cb89184c97e3f6d50acfd7961c313ce50360d70f.png","惊喜":"0afecaf3a3499479af946f29749e1a6c285b6f65.png","惊讶":"f8e9a59cad52ae1a19622805696a35f0a0d853f3.png","笑哭":"c3043ba94babf824dea03ce500d0e73763bf4f40.png","妙啊":"b4cb77159d58614a9b787b91b1cd22a81f383535.png","doge":"bba7c12aa51fed0199c241465560dfc2714c593e.png","滑稽":"d15121545a99ac46774f1f4465b895fe2d1411c3.png","吃瓜":"4191ce3c44c2b3df8fd97c33f85d3ab15f4f3c84.png","打call":"431432c43da3ee5aab5b0e4f8931953e649e9975.png","点赞":"1a67265993913f4c35d15a6028a30724e83e7d35.png","鼓掌":"895d1fc616b4b6c830cf96012880818c0e1de00d.png","尴尬":"cb321684ed5ce6eacdc2699092ab8fe7679e4fda.png","冷":"cb0ebbd0668640f07ebfc0e03f7a18a8cd00b4ed.png","灵魂出窍":"43d3db7d97343c01b47e22cfabeca84b4251f35a.png","委屈":"d2f26cbdd6c96960320af03f5514c5b524990840.png","傲娇":"010540d0f61220a0db4922e4a679a1d8eca94f4e.png","疼":"905fd9a99ec316e353b9bd4ecd49a5f0a301eabf.png","吓":"9c10c5ebc7bef27ec641b8a1877674e0c65fea5d.png","生病":"0f25ce04ae1d7baf98650986454c634f6612cb76.png","吐":"06946bfe71ac48a6078a0b662181bb5cad09decc.png","嘘声":"e64af664d20716e090f10411496998095f62f844.png","捂眼":"c5c6d6982e1e53e478daae554b239f2b227b172b.png","思考":"cfa9b7e89e4bfe04bbcd34ccb1b0df37f4fa905c.png","再见":"fc510306bae26c9aec7e287cdf201ded27b065b9.png","翻白眼":"eba54707c7168925b18f6f8b1f48d532fe08c2b1.png","哈欠":"888d877729cbec444ddbd1cf4c9af155a7a06086.png","奋斗":"bb2060c15dba7d3fd731c35079d1617f1afe3376.png","墨镜":"3a03aebfc06339d86a68c2d893303b46f4b85771.png","撇嘴":"531863568e5668c5ac181d395508a0eeb1f0cda4.png","难过":"a651db36701610aa70a781fa98c07c9789b11543.png","抓狂":"4c87afff88c22439c45b79e9d2035d21d5622eba.png","生气":"3195714219c4b582a4fb02033dd1519913d0246d.png","干杯":"8da12d5f55a2c7e9778dcc05b40571979fe208e6.png","爱心":"ed04066ea7124106d17ffcaf75600700e5442f5c.png","锦鲤":"643d6c19c8164ffd89e3e9cdf093cf5d773d979c.png","胜利":"b49fa9f4b1e7c3477918153b82c60b114d87347c.png","加油":"c7aaeacb21e107292d3bb053e5abde4a4459ed30.png","保佑":"fafe8d3de0dc139ebe995491d2dac458a865fb30.png","抱拳":"89516218158dbea18ab78e8873060bf95d33bbbe.png","响指":"1b5c53cf14336903e1d2ae3527ca380a1256a077.png","支持":"3c210366a5585706c09d4c686a9d942b39feeb50.png","拥抱":"41780a4254750cdaaccb20735730a36044e98ef3.png","怪我咯":"07cc6077f7f7d75b8d2c722dd9d9828a9fb9e46d.png","跪了":"f2b3aee7e521de7799d4e3aa379b01be032698ac.png","黑洞":"e90ec4c799010f25391179118ccd9f66b3b279ba.png","老鼠":"8e6fb491eb1bb0d5862e7ec8ccf9a3da12b6c155.png","福到了":"5de5373d354c373cf1617b6b836f3a8d53c5a655.png"},
      path: window.location.pathname,
      // master: '8a517fba7c520dddace09b926c0775c3',   //博主邮箱md5加密32位小写
      // tagMeta: ["博主", "小伙伴", "访客"],     //标识字段名
      // friends: [],  //小伙伴邮箱Md5
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdnjs.cloudflare.com/ajax/libs/valine/1.5.1/Valine.min.js').then(initValine)
}

if ('Livere' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/sun_moon.js" async></script><script async src="/js/charts.js"></script><script async src="//at.alicdn.com/t/c/font_4146777_2b7ofuf0dew.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js" type="application/javascript"></script><script src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><script src="/js/newYear.js"></script><script async data-pjax src="/js/newYear.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script defer src="/js/lunar.js"></script><script defer src="/js/day.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><div id="fps"></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><div class="aplayer no-destroy" data-id="3136179094" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fishes.js"></script><script defer src="https://cdn.jsdelivr.net/combine/npm/jquery@latest/dist/jquery.min.js,gh/weilining/jsdelivr/jquery/circlemagic/circlemagic.min.js,gh/weilining/jsdelivr@latest/jquery/circlemagic/butterflycirclemagic.js"></script><script src="https://cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><div><canvas id="snow" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:99999;pointer-events:none"></canvas></div><script>const notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));</script><script async type="text/javascript" src="https://cdn.jsdelivr.net/gh/Candinya/Kratos-Rebirth@latest/source/js/snow.min.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><script defer src="https://rmt.dogedoge.com/fetch/~/source/jsdelivr/npm/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="https://cdn.jsdelivr.net/gh/sirxemic/jquery.ripples/dist/jquery.ripples.js"></script><script defer data-pjax src="/js/ripples.js"></script><script src="/js/yinghua.js"></script><script src="/js/fengye.js"></script><script src="/js/emoji.js"></script><script defer src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script defer data-pjax src="/js/wow_init.js"></script><script async src="/js/title.js"></script><script src="/js/visitor.js"></script><script src="/js/random.js"></script><script src="https://npm.elemecdn.com/vue@2.6.11"></script><script async src="/js/fps.js"></script><script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script><script src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script src="/js/random.js"></script><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="/js/txmap.js"></script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script src="/js/weather.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/canvas-nest.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(https://img2.baidu.com/it/u=3745692040,3005247474&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/缓存/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">缓存</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img1.baidu.com/it/u=1341754829,1132645464&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=400&amp;h=400);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/中间件/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">中间件</a><span class="categoryBar-list-count">8</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img0.baidu.com/it/u=2484535052,376615361&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=503&amp;h=500);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/版本控制工具/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">版本控制工具</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img0.baidu.com/it/u=3312661278,78172823&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=554);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/框架/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">框架</a><span class="categoryBar-list-count">12</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img2.baidu.com/it/u=1036154364,590128025&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=502);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/FaceToFace/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">FaceToFace</a><span class="categoryBar-list-count">13</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img2.baidu.com/it/u=3063786176,3698143304&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/Java/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">Java</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img1.baidu.com/it/u=2409457391,176527849&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/MySQL/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">MySQL</a><span class="categoryBar-list-count">3</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img0.baidu.com/it/u=3401319367,1066543955&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/redis/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">redis</a><span class="categoryBar-list-count">10</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img1.baidu.com/it/u=1451814033,3212292494&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/lambda/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">lambda</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img1.baidu.com/it/u=658968858,3133674973&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/算法/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">算法</a><span class="categoryBar-list-count">5</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img2.baidu.com/it/u=3712249756,1004016377&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=400&amp;h=400);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/SpringCloud/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">SpringCloud</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img0.baidu.com/it/u=1096296806,2670130004&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/杂记/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">杂记</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr"></span></li><li class="categoryBar-list-item" style="background:url(https://img0.baidu.com/it/u=247517196,3882144171&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=667);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/Future/&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer">Future</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr"></span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/7608.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt=""><img width="48" height="48" src="img/75.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-06-24</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/7608.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">算法的手记</a><div class="blog-slider__text">算法相关学习笔记</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/7608.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/2da05edf.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt=""><img width="48" height="48" src="img/48.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-07-03</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/2da05edf.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">JUC 学习合集</a><div class="blog-slider__text">JUC合集</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/2da05edf.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/4f46b5ba.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt=""><img width="48" height="48" src="img/55.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-07-03</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/4f46b5ba.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">Netty 学习(尚硅谷)</a><div class="blog-slider__text">Netty 初级</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/4f46b5ba.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '2');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/charts/'|| '/charts/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://gitcalendar.fomal.cc/api?YangruiY",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'YangruiY')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>