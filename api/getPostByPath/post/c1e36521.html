{"type":"getPostByPath","data":{"title":"联合索引","date":"2023-10-19T04:11:27.000Z","description":"MySQL索引","categories":[{"name":"MySQL","_id":"clnwo8rq400228d0p4jvsd2lk"}],"tags":[{"name":"MySQL","_id":"clnwo8rq8002x8d0pf6i9hj8n"}],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n<h2 id=\"联合索引\">联合索引</h2>\n<h4 id=\"底层：\">底层：</h4>\n<p>​\t联合索引的底层是一棵 B+树，但是存储的是多个键值对；由于建立一个 B+ 树只能使用一个索引的值来进行确定，所以数据库是依赖联合索引的最左边的字段进行构建的。其次，会在前一个字段的基础上对之后的字段进行排序。所以单纯的使用 b= 4 的这个字段是无法使用索引的。</p>\n<h4 id=\"结构：\">结构：</h4>\n<p><img src=\"https://gitee.com/Ryang1118/typora2/raw/master/img/202310191213371.png\" alt><br>\n由此可见 a 的值是有顺序的，1-&gt;1-&gt; 2-&gt; 2-&gt; 3-&gt; 3 ；b的值总体没有顺序1-&gt;2-&gt;1-&gt;4-&gt;1-&gt;2，但是 局部有序（就是在a 相等的情况下b的值是有顺序的）</p>\n<h4 id=\"作用：\">作用：</h4>\n<ol>\n<li>\n<p>支持最左前缀匹配：最左匹配原则指出，在联合索引中，查询条件从左到右依次匹配索引的最左边的列。这意味着如果查询条件只涉及联合索引的最左边的列，索引可以被充分利用，加速查询速度。通过最左前缀匹配，可以有效地筛选出满足查询条件的数据，减少了不必要的索引扫描和数据读取，提高了查询性能。</p>\n</li>\n<li>\n<p>减少开销，高效:建一个联合索引(a,b,c)，实际相当于建了((a) (a,b) (a,b,c))三个索引。mysql 中每多一个索引，都会增加写操作的开销和磁盘空间的开销。对于大量数据的表，使用联合索引会大大的减少开销！并且 ，索引列越多，通过索引筛选出的数据越少</p>\n</li>\n<li>\n<p>覆盖索引  要是select  中的列是 a,b,c 那么就会直接通过遍历索引取得数据，而无需回表，这减少了很多的随机io操作。</p>\n</li>\n</ol>\n<h2 id=\"最左匹配原则\">最左匹配原则</h2>\n<h4 id=\"在哪用到：\">在哪用到：</h4>\n<p><code> 联合索引</code>中可以 按照最左匹配原则的方式进行索引匹配</p>\n<h4 id=\"是什么：\">是什么：</h4>\n<p>查询的时候<code>查询条件</code>精准匹配索引<code>左边</code>的一列或者几列，那么此索引就是可以被用到；<code>索引查完</code>或者遇到<code>范围查询(&gt; 、 &lt;、between、like)</code>的时候就会停止匹配。值得注意的是，只要所有的查询条件都用到了，但是顺序<strong>不一样</strong>也是<strong>可以被用到</strong>的，因为 查询引擎中的优化器会<strong>自动优化</strong>为匹配联合索引的顺序，从而能够命中索引。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">示例：  </span><br><span class=\"line\">-- 索引为 name,age</span><br><span class=\"line\">select * from user where name= XXX  and  age = XXX;  //可以用到索引</span><br><span class=\"line\">select * from user where age= XXX  and  name = XXX;  //可以用到索引</span><br><span class=\"line\">select * from user where name= XXX ; // 可以用到索引</span><br><span class=\"line\">select * from user where age = XXX ; // 用不到索引</span><br><span class=\"line\">select * from user where age&gt; XXX  and  name = XXX;  //可以使用到联合索引（name, age）的部分结构，可以利用索引中的 name 部分进行查,而不需要进行全表扫描。但是，由于 age 列在查询条件中使用了范围操作符（&gt;）</span><br><span class=\"line\">select * from user where name = XXX  and  age&gt; XXX; //可以用到局部的索引  age 会用到联合索引，但是遇到&gt;就终止了，name 就不会使用到。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">完整示例：</span><br><span class=\"line\">-- 索引为 id,name,age</span><br><span class=\"line\">-- 全值匹配查询</span><br><span class=\"line\">select * from user where id = XXX   and  name= XXX  and  age = XXX;  //可以用到索引（id,name,age） (顺序无所谓)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 匹配最左列</span><br><span class=\"line\">select * from user where id = XXX                   and  age = XXX;  //只用到联合索引中的 id</span><br><span class=\"line\">select * from user                    name= XXX                ;  // 全表扫描</span><br><span class=\"line\">select * from user                    name= XXX  and  age = XXX;  // 全表扫描</span><br><span class=\"line\">-- 因为没有从id开始匹配，且name单独来说是无序的，所以它确实不遵循最左匹配原则，然而从type字段可知，它虽然使用了联合索引，但是它是对整个索引树进行了扫描，正好匹配到该索引</span><br><span class=\"line\">-- 与最左匹配原则无关</span><br><span class=\"line\">-- 一般只要是某联合索引的一部分，但又不遵循最左匹配原则时，都可能会采用 index 类型的方式扫描，但它的效率远不如最左匹配原则的查询效率高</span><br><span class=\"line\">-- index类型类型的扫描方式是从索引第一个字段一个一个的查找，直到找到符合的某个索引，与all不同的是，index是对所有索引树进行扫描，而all是对整个磁盘的数据进行全表扫描。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 匹配列前缀 </span><br><span class=\"line\">select * from user where id like &#x27;A%&#x27;; \t\t//前缀都是排好序的，使用的都是联合索引</span><br><span class=\"line\">select * from user where id like &#x27;%A%&#x27;;\t\t//全表查询</span><br><span class=\"line\">select * from user where id like &#x27;%A&#x27;;\t\t//全表查询</span><br><span class=\"line\">-- 如果id是字符型，那么前缀匹配用的是索引，中缀和后缀用的是全表扫描。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 匹配范围值</span><br><span class=\"line\">select * from user where id&gt; 1 and id &lt; 4; //id 本身有序，只用到联合索引中的 id并且是范围的</span><br><span class=\"line\">explain select * from student_2 where id&gt; 1            and                        score &lt; 40; -- id</span><br><span class=\"line\">select * from user where                                             age &gt; 40;  //全表查询 age 无序</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 准确匹配第一列并范围匹配其他某一列</span><br><span class=\"line\">select * from user where id = 1               and age &lt; 4;//由于搜索中有id=1，所以在id范围内age是无序的，所以只使用了联合索引中的id索引。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-- 总结</span><br><span class=\"line\">-- 若符合最左覆盖原则，则走ref这种索引；</span><br><span class=\"line\">-- 若不符合最左匹配原则，但是符合覆盖索引（index），就可以扫描整个索引树，从而找到覆盖索引对应的列，避免回表；</span><br><span class=\"line\">-- 若不符合最左匹配原则，也不符合覆盖索引（如本例的select *），则需要扫描整个索引树，并且回表查询行记录，此时，查询优化器认为这样两次查找索引树，还不如全表扫描来得快（因为联合索引此时不符合最左匹配原则，要不普通索引查询慢得多），因此，此时会走全表扫描。</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>细说：<code>select  a,b,c  from user where a=1 and c= 0</code></p>\n<p>本质上来说这个其实是  索引截断，对于不同的版本处理方式也不一样。<strong>但是都是只会走 联合索引 中的 索引<code>a</code></strong></p>\n<ul>\n<li>\n<p>MySQL 5.5 的话，前面 id  会走索引，在联合索引找到<code>主键值</code>后，开始<code>回表</code>，到主键索引读取数据行，<code>Server 层</code>从<code>存储引擎层</code>获取到数据行后，然后在 Server 层再比对 <code>c</code> 字段的值。</p>\n</li>\n<li>\n<p>MySQL 5.6 之后，有一个<strong>索引下推</strong>功能，可以在<code>存储引擎层</code>进行索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，再返还给 <code>Server</code> 层，从而<strong>减少回表次数</strong>。</p>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>索引下推的<strong>大概原理</strong>是：</p>\n<p>截断的字段不会在 Server 层进行条件判断，而是会被下推到「存储引擎层」进行条件判断（因为 c 字段的值是在 (a, b, c) 联合索引里的），然后过滤出符合条件的数据后再返回给 Server 层。由于在引擎层就过滤掉大量的数据，无需再回表读取数据来进行判断，减少回表次数，从而提升了性能。</p>\n</blockquote>\n<h4 id=\"设计原则：\">设计原则：</h4>\n<p>要求在创建最左匹配索引的时候索引字段的顺序要考虑去重之后的个数</p>\n<blockquote>\n<p><code>解释</code>：假设有一个包含以下列的表：姓名（Name）、性别（Gender）、年龄（Age）、国籍（Nationality）。</p>\n<p>现在我们需要创建一个最左匹配索引，以支持以下查询条件：</p>\n<ol>\n<li>查询所有性别为女性（Gender = ‘Female’）的记录。</li>\n<li>查询所有年龄为30岁（Age = 30）的记录。</li>\n<li>查询所有国籍为中国（Nationality = ‘China’）的记录。</li>\n</ol>\n<p>根据最左匹配原则，我们应该考虑去重之后的个数，并将个数较多的字段放在前面。在这个例子中，假设性别的取值较少，年龄的取值较多，国籍的取值较多。因此，为了最大程度地利用最左匹配原则，我们应该将年龄字段作为索引的最左边列，然后是国籍字段，最后是性别字段。</p>\n<p>创建的最左匹配索引的顺序应该是：（<code>Age</code>,<code> Nationality</code>, <code>Gender</code>）</p>\n<p>这样，当查询条件为（Age = 30）时，索引可以直接匹配到年龄列，而不需要扫描其他列。当查询条件为（Age = 30 AND Nationality = ‘China’）时，索引可以继续匹配到国籍列。最后，当查询条件为（Age = 30 AND Nationality = ‘China’ AND Gender = ‘Female’）时，索引可以匹配到所有列。</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 自测用例</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">exists</span> student_1;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> student_1(</span><br><span class=\"line\">    id <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> AUTO_INCREMENT,</span><br><span class=\"line\">    age  <span class=\"type\">int</span>(<span class=\"number\">4</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    name <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    score <span class=\"type\">int</span>(<span class=\"number\">13</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    all_score <span class=\"type\">int</span>(<span class=\"number\">13</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    address <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">    KEY `id_age_score_index` (id,age,score)</span><br><span class=\"line\">)Engine<span class=\"operator\">=</span>Innodb;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">exists</span> student_2;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> student_2(</span><br><span class=\"line\">    id <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> AUTO_INCREMENT,</span><br><span class=\"line\">    age  <span class=\"type\">int</span>(<span class=\"number\">4</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    name <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    score <span class=\"type\">int</span>(<span class=\"number\">13</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    all_score <span class=\"type\">int</span>(<span class=\"number\">13</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    address <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">    KEY `id_name_score_index` (id,name,score)</span><br><span class=\"line\">)Engine<span class=\"operator\">=</span>Innodb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">exists</span> student_3;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> student_3(</span><br><span class=\"line\">    id <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> AUTO_INCREMENT,</span><br><span class=\"line\">    age  <span class=\"type\">int</span>(<span class=\"number\">4</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    name <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    score <span class=\"type\">int</span>(<span class=\"number\">13</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    all_score <span class=\"type\">int</span>(<span class=\"number\">13</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    address <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">    KEY `id_age_name_index` (id,age,name)</span><br><span class=\"line\">)Engine<span class=\"operator\">=</span>Innodb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_1 <span class=\"keyword\">values</span>(<span class=\"number\">1</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"number\">23123</span>,<span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_1 <span class=\"keyword\">values</span>(<span class=\"number\">2</span>, <span class=\"number\">12</span>,<span class=\"string\">&#x27;rry&#x27;</span>,<span class=\"number\">11</span>,<span class=\"number\">765</span>,<span class=\"string\">&#x27;as&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_1 <span class=\"keyword\">values</span>(<span class=\"number\">3</span>, <span class=\"number\">13</span>,<span class=\"string\">&#x27;rrry&#x27;</span>,<span class=\"number\">102</span>,<span class=\"number\">78653</span>,<span class=\"string\">&#x27;erer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_1 <span class=\"keyword\">values</span>(<span class=\"number\">4</span>, <span class=\"number\">14</span>,<span class=\"string\">&#x27;rrrry&#x27;</span>,<span class=\"number\">13</span>,<span class=\"number\">12314</span>,<span class=\"string\">&#x27;sjidajis&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_1 <span class=\"keyword\">values</span>(<span class=\"number\">13</span>, <span class=\"number\">13</span>,<span class=\"string\">&#x27;ry13&#x27;</span>,<span class=\"number\">133</span>,<span class=\"number\">23123</span>,<span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_1 <span class=\"keyword\">values</span>(<span class=\"number\">155</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry155&#x27;</span>,<span class=\"number\">155</span>,<span class=\"number\">23123</span>,<span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">update</span> student_1 <span class=\"keyword\">set</span> age<span class=\"operator\">=</span><span class=\"number\">13</span>  <span class=\"keyword\">where</span> id <span class=\"operator\">=</span><span class=\"number\">4</span>;</span><br><span class=\"line\"><span class=\"keyword\">update</span> student_1 <span class=\"keyword\">set</span> age<span class=\"operator\">=</span><span class=\"number\">10</span>  <span class=\"keyword\">where</span> id <span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">update</span> student_1 <span class=\"keyword\">set</span> age<span class=\"operator\">=</span><span class=\"number\">155</span>  <span class=\"keyword\">where</span> id <span class=\"operator\">=</span><span class=\"number\">155</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_2 <span class=\"keyword\">values</span>(<span class=\"number\">1</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"number\">23123</span>,<span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_2 <span class=\"keyword\">values</span>(<span class=\"number\">2</span>, <span class=\"number\">12</span>,<span class=\"string\">&#x27;rry&#x27;</span>,<span class=\"number\">11</span>,<span class=\"number\">765</span>,<span class=\"string\">&#x27;as&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_2 <span class=\"keyword\">values</span>(<span class=\"number\">3</span>, <span class=\"number\">13</span>,<span class=\"string\">&#x27;rrry&#x27;</span>,<span class=\"number\">102</span>,<span class=\"number\">78653</span>,<span class=\"string\">&#x27;erer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_2 <span class=\"keyword\">values</span>(<span class=\"number\">4</span>, <span class=\"number\">14</span>,<span class=\"string\">&#x27;rrrry&#x27;</span>,<span class=\"number\">13</span>,<span class=\"number\">12314</span>,<span class=\"string\">&#x27;sjidajis&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_3 <span class=\"keyword\">values</span>(<span class=\"number\">1</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"number\">23123</span>,<span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_3 <span class=\"keyword\">values</span>(<span class=\"number\">2</span>, <span class=\"number\">12</span>,<span class=\"string\">&#x27;rry&#x27;</span>,<span class=\"number\">11</span>,<span class=\"number\">765</span>,<span class=\"string\">&#x27;as&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_3 <span class=\"keyword\">values</span>(<span class=\"number\">3</span>, <span class=\"number\">13</span>,<span class=\"string\">&#x27;rrry&#x27;</span>,<span class=\"number\">102</span>,<span class=\"number\">78653</span>,<span class=\"string\">&#x27;erer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> student_3 <span class=\"keyword\">values</span>(<span class=\"number\">4</span>, <span class=\"number\">14</span>,<span class=\"string\">&#x27;rrrry&#x27;</span>,<span class=\"number\">13</span>,<span class=\"number\">12314</span>,<span class=\"string\">&#x27;sjidajis&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">-- 最左匹配原则的索引 (顺序的无所谓)   = 和 in 可以乱序</span></span><br><span class=\"line\"><span class=\"comment\">-- 包含索引的全部字段都是可以的</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"operator\">=</span> <span class=\"number\">11</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span><span class=\"number\">100</span>; <span class=\"comment\">-- id,age,score</span></span><br><span class=\"line\"><span class=\"comment\">-- 包含索引的部分字段要前后有序，n个字段创建的索引的话那么每个前面的字段都看做前置条件</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"operator\">=</span> <span class=\"number\">11</span> ;     <span class=\"comment\">-- id,age</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> score <span class=\"operator\">=</span><span class=\"number\">100</span> <span class=\"keyword\">and</span> id <span class=\"operator\">=</span> <span class=\"number\">11</span>;     <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> age  <span class=\"operator\">=</span> <span class=\"number\">11</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span><span class=\"number\">100</span>;   <span class=\"comment\">-- 全表索引</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> score <span class=\"operator\">=</span><span class=\"number\">100</span>;   <span class=\"comment\">-- 全表扫描(只要没有 id 就都是全表扫描，没有索引)</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"operator\">&lt;</span> <span class=\"number\">13</span>;   <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"operator\">&lt;</span> <span class=\"number\">12</span>;   <span class=\"comment\">-- id,age</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"operator\">&lt;</span> <span class=\"number\">12</span> <span class=\"keyword\">and</span> score <span class=\"operator\">&gt;</span><span class=\"number\">90</span>;   <span class=\"comment\">-- id,age</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"operator\">=</span> <span class=\"number\">11</span> <span class=\"keyword\">and</span> score <span class=\"operator\">&gt;</span><span class=\"number\">100</span>;  <span class=\"comment\">-- id,age,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">1</span>                <span class=\"keyword\">and</span> score <span class=\"operator\">=</span><span class=\"number\">100</span>;  <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span>  age  <span class=\"operator\">=</span> <span class=\"number\">11</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span><span class=\"number\">100</span>;  <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;</span>  <span class=\"number\">3</span>          <span class=\"keyword\">and</span> score <span class=\"operator\">&gt;</span><span class=\"number\">100</span>      <span class=\"keyword\">and</span> score <span class=\"operator\">&lt;</span><span class=\"number\">200</span>;  <span class=\"comment\">-- id</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span><span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>;     <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span>             name  <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span><span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>;     <span class=\"comment\">-- (无id)全表扫描</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>                  <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>;     <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span> <span class=\"keyword\">and</span> score <span class=\"operator\">&gt;</span> <span class=\"number\">100</span> ;    <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name <span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;er&#x27;</span><span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>;      <span class=\"comment\">-- id,name</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span><span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>;     <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">&lt;</span> <span class=\"number\">10</span>          <span class=\"keyword\">and</span> score <span class=\"operator\">&gt;</span><span class=\"number\">0</span>  <span class=\"keyword\">and</span> score <span class=\"operator\">&lt;</span><span class=\"number\">200</span>; <span class=\"comment\">-- id</span></span><br><span class=\"line\"></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"keyword\">in</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>) <span class=\"keyword\">and</span>  name  <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id,name,score   in 在这里相当于是等值查询</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"keyword\">in</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>) <span class=\"keyword\">and</span>  name <span class=\"keyword\">in</span>(<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"string\">&#x27;we&#x27;</span>);        <span class=\"comment\">-- 全表扫描</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"keyword\">in</span>(<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"string\">&#x27;we&#x27;</span>);        <span class=\"comment\">-- id name</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span><span class=\"number\">1</span>  <span class=\"keyword\">and</span>  name  <span class=\"keyword\">in</span>(<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"string\">&#x27;we&#x27;</span>) <span class=\"keyword\">and</span> score <span class=\"keyword\">between</span> <span class=\"number\">100</span> <span class=\"keyword\">and</span> <span class=\"number\">200</span>;        <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span><span class=\"number\">1</span>  <span class=\"keyword\">and</span>  name  <span class=\"keyword\">in</span>(<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"string\">&#x27;we&#x27;</span>) <span class=\"keyword\">and</span> score <span class=\"keyword\">in</span>(<span class=\"number\">100</span>,<span class=\"number\">200</span>);        <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span><span class=\"number\">1</span>  <span class=\"keyword\">and</span>  name  <span class=\"keyword\">in</span>(<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"string\">&#x27;we&#x27;</span>) <span class=\"keyword\">and</span> score <span class=\"keyword\">between</span> <span class=\"number\">100</span> <span class=\"keyword\">and</span> <span class=\"number\">200</span>;        <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"keyword\">in</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>) <span class=\"keyword\">and</span>  name  <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"string\">&#x27;we&#x27;</span>) <span class=\"keyword\">and</span> score <span class=\"keyword\">in</span> (<span class=\"number\">100</span>,<span class=\"number\">122</span>); <span class=\"comment\">-- 全表扫描</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span><span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_3 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span> age <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span>;     <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_3 <span class=\"keyword\">where</span>            age <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span>;    <span class=\"comment\">-- (无id)全表扫描</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_3 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>                  <span class=\"keyword\">and</span> name <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span>;     <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_3 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age <span class=\"operator\">=</span> <span class=\"number\">12</span>    <span class=\"keyword\">and</span> name <span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;er&#x27;</span> ;    <span class=\"comment\">-- id,age,name</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_3 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age <span class=\"operator\">&gt;</span> <span class=\"number\">12</span>    <span class=\"keyword\">and</span> name <span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;er&#x27;</span>;      <span class=\"comment\">-- id,age</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_3 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age <span class=\"operator\">=</span> <span class=\"number\">12</span>    <span class=\"keyword\">and</span> name <span class=\"operator\">=</span> <span class=\"string\">&#x27;er&#x27;</span>;     <span class=\"comment\">-- id</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 遇到 %</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%er&#x27;</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%er%&#x27;</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"keyword\">like</span> <span class=\"string\">&#x27;er%&#x27;</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;=</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> id <span class=\"operator\">&lt;</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  name  <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%er&#x27;</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_2 <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span>  name  <span class=\"keyword\">like</span> <span class=\"string\">&#x27;er%&#x27;</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id,name,score</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 遇到 between</span></span><br><span class=\"line\"><span class=\"comment\">--      但是单纯的使用 between 的话就只会有类似于 &gt;=（大于或等于）XX  的所有记录，因为没有指定结束值,那么单纯的使用between 的时候就会出现最左匹配原则出现问提的情况</span></span><br><span class=\"line\"><span class=\"comment\">--      但是只有 between 的语句  必须要有 and  这样才不会出错  explain select * from student_1 where id between 1;   会报错</span></span><br><span class=\"line\"><span class=\"comment\">--      WHERE id BETWEEN 1 AND age BETWEEN 20 AND 40 AND score BETWEEN 90 AND 110   表示 id 在 1 和 age 在 20 到 40 之间，并且 score 在 90 到 110 之间的学生记录</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span> score<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> age <span class=\"keyword\">in</span>(<span class=\"number\">10</span>,<span class=\"number\">11</span>);   <span class=\"comment\">-- 全表扫描</span></span><br><span class=\"line\"><span class=\"comment\">--  WHERE id BETWEEN 1   AND  age  BETWEEN 10    AND 11   表示   id 在 0- (10,13)取到的值之间进行检索，注意 （10,13）只取最小的值</span></span><br><span class=\"line\">explain <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> student_1 <span class=\"keyword\">WHERE</span> id <span class=\"keyword\">BETWEEN</span> <span class=\"number\">1</span>  <span class=\"keyword\">and</span>   age  <span class=\"keyword\">BETWEEN</span> <span class=\"number\">10</span>    <span class=\"keyword\">AND</span> <span class=\"number\">13</span>  <span class=\"keyword\">AND</span>  score   <span class=\"keyword\">BETWEEN</span> <span class=\"number\">90</span> <span class=\"keyword\">AND</span> <span class=\"number\">110</span>;  <span class=\"comment\">-- id</span></span><br><span class=\"line\">explain <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> student_1 <span class=\"keyword\">WHERE</span> id <span class=\"keyword\">BETWEEN</span> <span class=\"number\">1</span>   <span class=\"keyword\">AND</span>  age  <span class=\"keyword\">BETWEEN</span> <span class=\"number\">0</span>     <span class=\"keyword\">AND</span>      score   <span class=\"keyword\">BETWEEN</span> <span class=\"number\">90</span> <span class=\"keyword\">and</span> <span class=\"number\">110</span>;  <span class=\"comment\">-- id</span></span><br><span class=\"line\"><span class=\"comment\">-- 单纯的 between 是很复杂的 ，sql 无法识别，会匹配到下一个 and  并将之后的值作为结束值进行匹配得到一个范围</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span> score <span class=\"keyword\">in</span>(<span class=\"number\">90</span>,<span class=\"number\">100</span>,<span class=\"number\">110</span>) <span class=\"keyword\">and</span> age <span class=\"keyword\">in</span>(<span class=\"number\">10</span>,<span class=\"number\">11</span>);  <span class=\"comment\">-- id,age</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span> score <span class=\"keyword\">in</span>(<span class=\"number\">90</span>,<span class=\"number\">100</span>,<span class=\"number\">110</span>) <span class=\"keyword\">and</span> age <span class=\"keyword\">in</span>(<span class=\"number\">10</span>,<span class=\"number\">11</span>)<span class=\"keyword\">and</span>  score <span class=\"keyword\">in</span>(<span class=\"number\">90</span>,<span class=\"number\">100</span>,<span class=\"number\">110</span>);  <span class=\"comment\">-- id,age,score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span> age <span class=\"keyword\">in</span>(<span class=\"number\">10</span>,<span class=\"number\">11</span>) <span class=\"keyword\">and</span> score <span class=\"keyword\">in</span>(<span class=\"number\">90</span>,<span class=\"number\">100</span>,<span class=\"number\">110</span>); <span class=\"comment\">-- id</span></span><br><span class=\"line\"><span class=\"comment\">--      使用 between ...and ... 使用的还是范围查询</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">10</span>  <span class=\"keyword\">and</span> age <span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> score  <span class=\"operator\">=</span><span class=\"number\">100</span>;   <span class=\"comment\">-- id age score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"keyword\">between</span> <span class=\"number\">10</span> <span class=\"keyword\">and</span>  <span class=\"number\">20</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id age score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"keyword\">between</span> <span class=\"number\">10</span> <span class=\"keyword\">and</span>  <span class=\"number\">20</span> <span class=\"keyword\">and</span> score <span class=\"keyword\">between</span> <span class=\"number\">100</span> <span class=\"keyword\">and</span> <span class=\"number\">300</span>; <span class=\"comment\">-- id age score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"keyword\">between</span> <span class=\"number\">10</span> <span class=\"keyword\">and</span>  <span class=\"number\">20</span> <span class=\"keyword\">and</span> score <span class=\"keyword\">between</span> <span class=\"number\">100</span> <span class=\"keyword\">and</span> <span class=\"number\">300</span>; <span class=\"comment\">-- id age score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span>  age<span class=\"operator\">=</span><span class=\"number\">11</span> <span class=\"keyword\">and</span> score <span class=\"keyword\">between</span>  <span class=\"number\">100</span> <span class=\"keyword\">and</span> <span class=\"number\">120</span>; <span class=\"comment\">-- id age score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">between</span> <span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"keyword\">in</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">10</span>,<span class=\"number\">11</span>) <span class=\"keyword\">and</span> score <span class=\"keyword\">between</span> <span class=\"number\">100</span> <span class=\"keyword\">and</span> <span class=\"number\">300</span>; <span class=\"comment\">-- id age score</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">in</span>(<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>) <span class=\"keyword\">and</span>  age  <span class=\"keyword\">between</span>  <span class=\"number\">10</span> <span class=\"keyword\">and</span>  <span class=\"number\">12</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id age name</span></span><br><span class=\"line\"></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"operator\">&gt;</span><span class=\"number\">0</span> <span class=\"keyword\">and</span> id <span class=\"operator\">&lt;</span> <span class=\"number\">1</span> <span class=\"keyword\">and</span>  age  <span class=\"keyword\">between</span> <span class=\"number\">10</span> <span class=\"keyword\">and</span>  <span class=\"number\">20</span> <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>; <span class=\"comment\">-- id</span></span><br><span class=\"line\"><span class=\"comment\">-- 多个(&gt;=2)in  就会出现联合索引失效 会进行全表查询</span></span><br><span class=\"line\"><span class=\"comment\">-- 当查询中使用多个 IN 条件时，如果这些条件涉及的列不是联合索引的前缀列，或者条件之间的关系不是简单的等值匹配，那么索引可能无法有效利用。</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">in</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>) <span class=\"keyword\">and</span>  age  <span class=\"keyword\">in</span>(<span class=\"number\">11</span>,<span class=\"number\">12</span>,<span class=\"number\">13</span>) <span class=\"keyword\">and</span> score <span class=\"operator\">=</span> <span class=\"number\">100</span>;             <span class=\"comment\">-- 全表扫描</span></span><br><span class=\"line\">explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> student_1 <span class=\"keyword\">where</span> id <span class=\"keyword\">in</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>) <span class=\"keyword\">and</span>  age  <span class=\"keyword\">in</span>(<span class=\"number\">11</span>,<span class=\"number\">12</span>,<span class=\"number\">13</span>) <span class=\"keyword\">and</span> score <span class=\"keyword\">in</span>(<span class=\"number\">100</span>,<span class=\"number\">102</span>,<span class=\"number\">103</span>); <span class=\"comment\">-- 全表扫描</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"执行计划\">执行计划</h2>\n<p>一般的使用就是使用打开慢查询，定位效率比较差的SQL，定位到SQL之后还要使用 explain  查看执行计划，比如是全表扫描还是索引扫描等，explain主要是查看优化器如何 执行查询的。</p>\n<h3 id=\"EXPLAIN\">EXPLAIN</h3>\n<blockquote>\n<p><strong>EXPALIN只能解释SELECT操作，其他操作要重写为SELECT后查看执行计划</strong></p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class=\"line\">| <span class=\"built_in\">id</span> | select_type | table | <span class=\"built_in\">type</span>  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class=\"line\">+----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure>\n<h4 id=\"id\"><strong>id</strong></h4>\n<blockquote>\n<p>包含一组数字，表示查询中执行  select 子句 或者 操作表的顺序</p>\n</blockquote>\n<p>是子查询的话id会递增，值越大优先级越高，越先被执行；</p>\n<p>要是id相同的话，那么可以认为是一组从上往下顺序执行；所在组中，id 之越大优先级越高，越先执行</p>\n<h4 id=\"select-type\"><strong>select_type</strong></h4>\n<blockquote>\n<p>查询中每个select子句的类型</p>\n</blockquote>\n<ol>\n<li><code>SIMPLE</code>：简单查询，不包含子查询或者UNION。例如：<code>SELECT * FROM users WHERE age &gt; 18;</code></li>\n<li><code>PRIMARY</code>：主查询，如果查询中包含任何复杂的子部分，最外层查询会被标记为PRIMARY。例如：<code>SELECT * FROM (SELECT * FROM users WHERE age &gt; 18) AS subquery;</code></li>\n<li><code>SUBQUERY</code>：子查询，如果在SELECT或WHERE列表中包含了子查询，该子查询会被标记为SUBQUERY。例如：<code>SELECT name, (SELECT age FROM user_details WHERE user_id = users.id) AS age FROM users;</code></li>\n<li><code>DERIVED</code>：派生查询，如果在FROM列表中包含的子查询会被标记为DERIVED。例如：<code>SELECT * FROM (SELECT name, age FROM users WHERE age &gt; 18) AS derived_table;</code></li>\n<li><code>UNION</code>：UNION查询，如果第二个SELECT出现在UNION之后，该SELECT会被标记为UNION。如果UNION包含在FROM子句的子查询中，外层SELECT将被标记为DERIVED。例如：<code>SELECT name FROM users UNION SELECT name FROM customers;</code></li>\n<li><code>UNION RESULT</code>：从UNION表获取结果的SELECT，用于表示从UNION操作的结果中获取数据的SELECT。例如：<code>SELECT * FROM (SELECT name FROM users UNION SELECT name FROM customers) AS union_result;</code></li>\n</ol>\n<p><code>SUBQUERY</code>和<code>UNION</code>还可以被标记为<code>DEPENDENT</code>和<code>UNCACHEABLE</code>。<code>DEPENDENT</code>意味着select依赖于外层查询中发现的数据。<br>\n<code>UNCACHEABLE</code>意味着select中的某些特性阻止结果被缓存于一个<code>item_cache</code>中。</p>\n<h4 id=\"type\"><strong><code>type</code></strong></h4>\n<blockquote>\n<p>表示MySQL在表中<code>找到所需行的方式</code>，又称“访问类型”，常见类型如下:</p>\n</blockquote>\n<blockquote>\n<p>ALL, index, range, ref, eq_ref, const, system, NULL   ===&gt;  从左到右，性能从最差到最好</p>\n</blockquote>\n<ol>\n<li>ALL: 全表扫描找到匹配的行</li>\n<li>index: 遍历所有索引树找到匹配的行</li>\n<li><strong>range:索引范围扫描，对索引的扫描开始于某一点，返回匹配值域的行，索引范围扫描说的就是带有 <code>between</code> 或者 <code>where 子句中带有的&gt;,&lt;的</code>查询，当mysql 使用索引去查找一系列值的时候，比如使用<code>IN(),OR</code>列表，也会显示 rang (范围扫描)</strong></li>\n<li>ref：使用<code>非唯一索引扫描或者唯一索引的前缀扫描</code>，返回<code>匹配某个单独值</code>的记录行</li>\n<li>eq_ref:  类似ref，区别就在使用的索引是<code>唯一索引</code>，对于每个索引键值，表中只有一条记录匹配，简单来说，就是多表连接中使用<code>primary key</code>或者<code> unique key</code>作为关联条件</li>\n<li><strong><code>const</code>、system: 当MySQL对查询某部分进行<code>优化</code>，并转换为一个<code>常量</code>时，使用这些类型访问。如将主键置于where列表中，MySQL就能将该查询转换为一个常量  (system 是const 类型的一个特例)</strong></li>\n<li>NULL: MySQL在优化过程中<code>分解语句</code>，执行时甚至不用访问表或索引，例如从一个索引列里选取最小值可以通过单独索引查找完成</li>\n</ol>\n<h4 id=\"possible-keys\"><strong>possible_keys</strong></h4>\n<blockquote>\n<p>指出 mysql 可以使用 哪个索引在表中找到记录，查询设计的字段要是存在索引就列出这个索引，但是不一定被查询使用</p>\n</blockquote>\n<h4 id=\"key\"><strong>key</strong></h4>\n<blockquote>\n<p>显示MySQL在查询中实际使用的索引，要是没有使用索引的话显示为NULL</p>\n</blockquote>\n<h4 id=\"key-len\"><strong><code>key_len</code></strong></h4>\n<blockquote>\n<p><strong>显示MySQL实际决定使用的索引的长度。如果索引是NULL，则长度为NULL。如果不是NULL，则为使用的索引的长度。所以通过此字段就可推断出使用了那个索引。</strong></p>\n</blockquote>\n<p><strong>计算规则</strong></p>\n<blockquote>\n<ol>\n<li>\n<p>定长字段，int占用4个字节，date占用3个字节，char(n)占用n个字符。</p>\n</li>\n<li>\n<p>变长字段varchar(n)，则占用n个字符+两个字节。</p>\n</li>\n<li>\n<p>不同的字符集，一个字符占用的字节数是不同的。</p>\n<ol>\n<li>Latin1编码的，一个字符占用一个字节</li>\n<li>gdk编码的，一个字符占用两个字节</li>\n<li>utf-8编码的，一个字符占用三个字节</li>\n</ol>\n</li>\n<li>\n<p>对于所有的索引字段，如果设置为NULL，则还需要1个字节</p>\n</li>\n</ol>\n</blockquote>\n<h4 id=\"ref\"><strong>ref</strong></h4>\n<blockquote>\n<p>表示  表的连接匹配条件，哪些类或常量被用于查找索引列上的值</p>\n</blockquote>\n<h4 id=\"rows\"><strong>rows</strong></h4>\n<blockquote>\n<p>表示 MySQL 根据表统计信息以及索引选用的情况，估算的找到所需的记录索要读取的行数</p>\n</blockquote>\n<h4 id=\"filtered\">filtered</h4>\n<blockquote>\n<p>表示在索引扫描过程中，大约有  XX% 的行满足查询条件</p>\n</blockquote>\n<h4 id=\"Extra\"><strong>Extra</strong></h4>\n<blockquote>\n<p>包含不适合在其他列中显示但十分重要的额外信息</p>\n</blockquote>\n<ol>\n<li><strong>Using index</strong>：表示查询使用了覆盖索引（Covering Index），即查询结果可以直接从索引中获取，无需再访问数据行。例如：<code>SELECT name, age FROM users WHERE age &gt; 18;</code></li>\n<li><strong>Using where</strong>：表示MySQL服务器在存储引擎检索行后再进行过滤。这个值出现的情况是，查询条件涉及到索引的列，但并非所有带 WHERE 子句的查询都会显示 “Using where”。例如：<code>SELECT name FROM users WHERE age &gt; 18;</code></li>\n<li><strong>Using temporary</strong>：表示MySQL需要使用临时表来存储结果集，常见于排序和分组查询。这个值表示使用了内部临时表，可能由于使用 DISTINCT、ORDER BY 或 GROUP BY 等操作导致。例如：<code>SELECT DISTINCT name FROM users;</code></li>\n<li><strong>Using filesort</strong>：表示MySQL无法利用索引完成排序操作，需要进行文件排序。例如：<code>SELECT name FROM users ORDER BY age;</code></li>\n<li><strong>Using join buffer</strong>：表示在获取连接条件时没有使用索引，需要连接缓冲区来存储中间结果。这可能需要添加索引来改进查询性能。例如：<code>SELECT * FROM users JOIN orders ON users.id = orders.user_id;</code></li>\n<li><strong>Impossible where</strong>：表示 WHERE 语句导致没有符合条件的行。例如：<code>SELECT * FROM users WHERE age &gt; 100;</code></li>\n<li><strong>Select tables optimized away</strong>：表示通过使用索引，优化器可能仅从聚合函数结果中返回一行。例如：<code>SELECT COUNT(*) FROM users;</code></li>\n<li><strong>Index merges</strong>：当MySQL决定在一个表上使用多个索引时，会出现这个值，详细说明使用的索引以及合并的类型。例如：<code>SELECT * FROM users WHERE age &gt; 18 AND name = 'John';</code></li>\n</ol>\n<h2 id=\"MySQL-主键一定连续吗\">MySQL 主键一定连续吗</h2>\n<h4 id=\"存储位置\">存储位置</h4>\n<p><strong>1、MySQL 5.X 版本</strong></p>\n<ul>\n<li>\n<p>mysql  的主键 存储的位置：  <code>.frm</code> 的本地文件中，在 <code>MySQL</code> 安装目录下的 <code>data</code> 文件夹下可以找到这个 <code>.frm</code> 文件，这个文件中会定义一个  <code>AUTO_INCREMENT=X</code> 的变量；表示下一次插入数据时，如果需要自动生成自增值，会生成 id = X。</p>\n</li>\n<li>\n<p>自增值并不会保存在这个表结构，也就是 <code>.frm</code> 文件中，不同的引擎对于自增值的保存策略不同：</p>\n</li>\n</ul>\n<p>​\t\t\t1）MyISAM 引擎的自增值保存在<strong>数据文件</strong>中</p>\n<p>​\t\t\t2）InnoDB 引擎的自增值，其实是保存在了<strong>内存里</strong>，并没有持久化。第一次打开表的时候，都会去找自增值的最大值 <code>max(id)</code>，然后将 <code>max(id)+1</code> 作为这个表当前的自增值。</p>\n<blockquote>\n<p>MySQL 5.X  版本 在  重启后  可能会修改一个表的 AUTO_INCREMENT 的值。</p>\n</blockquote>\n<p><strong>2、MySQL 8.0 版本</strong></p>\n<p><strong>自增值的变更记录被放在了 redo log 中，提供了自增值持久化的能力</strong> ，也就是实现了“如果发生重启，表的自增值可以根据 redo log 恢复为 MySQL 重启前的值“</p>\n<blockquote>\n<p>MySQL 8.X  版本 在  重启后 不会修改一个表的 AUTO_INCREMENT 的值。</p>\n</blockquote>\n<h4 id=\"主键初始化：\">主键初始化：</h4>\n<p>在 MySQL 里面，如果字段 id 被定义为 AUTO_INCREMENT，在插入一行数据的时候，自增值的行为如下：</p>\n<ul>\n<li>如果插入数据时 id 字段指定为 <code>0</code>、<code>null</code> 或<code>未指定值</code>，那么就把这个表当前的 <code>AUTO_INCREMENT </code>值 写到自增字段；</li>\n<li>如果插入数据时 id 字段指定了<code>具体的值</code>，就直接使用语句里指定的值。</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 创建数据库</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> database <span class=\"number\">20231017</span>_DBS;</span><br><span class=\"line\">use <span class=\"number\">20231017</span>_DBS;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> <span class=\"keyword\">user</span>(</span><br><span class=\"line\">    id <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> AUTO_INCREMENT,</span><br><span class=\"line\">    age  <span class=\"type\">int</span>(<span class=\"number\">4</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    name <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    score <span class=\"type\">int</span>(<span class=\"number\">3</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    address <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">    KEY `id_age_score_index` (id,age,score),</span><br><span class=\"line\">    KEY `id_name_score_index` (id,name,score),</span><br><span class=\"line\">    KEY `id_age_name_index` (id,age,name)</span><br><span class=\"line\">)Engine<span class=\"operator\">=</span>Innodb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> user_1(</span><br><span class=\"line\">    id <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> AUTO_INCREMENT,</span><br><span class=\"line\">    age  <span class=\"type\">int</span>(<span class=\"number\">4</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    name <span class=\"type\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    score <span class=\"type\">int</span>(<span class=\"number\">3</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    address <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">    KEY `id_age_score_index` (id,age,score),</span><br><span class=\"line\">    KEY `id_name_score_index` (id,name,score),</span><br><span class=\"line\">    KEY `id_age_name_index` (id,age,name),</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY</span> KEY (id)</span><br><span class=\"line\">)Engine<span class=\"operator\">=</span>Innodb;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"自增场景不连续的情况\">自增场景不连续的情况</h4>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 先往表里插入一条` (null, 11,&#x27;ry&#x27;,100,&#x27;China&#x27;) `的记录，生成的主键是 `1`，`AUTO_INCREMENT`= 2</span></span><br><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">create</span>  <span class=\"keyword\">table</span> <span class=\"keyword\">user</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> <span class=\"keyword\">values</span>(<span class=\"keyword\">null</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br><span class=\"line\"><span class=\"comment\">-- 删除 id =1 的行  表的结构依旧是 AUTO_INCREMENT=2</span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">where</span> id <span class=\"operator\">=</span><span class=\"number\">35</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> <span class=\"keyword\">values</span>(<span class=\"number\">37</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">user</span> <span class=\"keyword\">values</span>(<span class=\"number\">34</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">create</span>  <span class=\"keyword\">table</span> <span class=\"keyword\">user</span>;  <span class=\"operator\">/</span><span class=\"operator\">/</span>AUTO_INCREMENT<span class=\"operator\">=</span><span class=\"number\">36</span></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 结果</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----+-----+------+-------+---------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> id  <span class=\"operator\">|</span> age <span class=\"operator\">|</span> name <span class=\"operator\">|</span> score <span class=\"operator\">|</span> address <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----+-----+------+-------+---------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>  <span class=\"number\">34</span> <span class=\"operator\">|</span>  <span class=\"number\">11</span> <span class=\"operator\">|</span> ry   <span class=\"operator\">|</span>   <span class=\"number\">100</span> <span class=\"operator\">|</span> China   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>  <span class=\"number\">36</span> <span class=\"operator\">|</span>  <span class=\"number\">11</span> <span class=\"operator\">|</span> ry   <span class=\"operator\">|</span>   <span class=\"number\">100</span> <span class=\"operator\">|</span> China   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   <span class=\"number\">7</span> <span class=\"operator\">|</span>  <span class=\"number\">11</span> <span class=\"operator\">|</span> ry   <span class=\"operator\">|</span>   <span class=\"number\">100</span> <span class=\"operator\">|</span> China   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>  <span class=\"number\">37</span> <span class=\"operator\">|</span>  <span class=\"number\">11</span> <span class=\"operator\">|</span> ry   <span class=\"operator\">|</span>   <span class=\"number\">100</span> <span class=\"operator\">|</span> China   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">123</span> <span class=\"operator\">|</span>  <span class=\"number\">11</span> <span class=\"operator\">|</span> ry   <span class=\"operator\">|</span>   <span class=\"number\">100</span> <span class=\"operator\">|</span> China   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>   <span class=\"number\">3</span> <span class=\"operator\">|</span>  <span class=\"number\">11</span> <span class=\"operator\">|</span> ry   <span class=\"operator\">|</span>   <span class=\"number\">100</span> <span class=\"operator\">|</span> China   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>  <span class=\"number\">78</span> <span class=\"operator\">|</span>  <span class=\"number\">11</span> <span class=\"operator\">|</span> ry   <span class=\"operator\">|</span>   <span class=\"number\">100</span> <span class=\"operator\">|</span> China   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span>  <span class=\"number\">67</span> <span class=\"operator\">|</span>  <span class=\"number\">11</span> <span class=\"operator\">|</span> ry   <span class=\"operator\">|</span>   <span class=\"number\">100</span> <span class=\"operator\">|</span> China   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----+-----+------+-------+---------+</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>MySQL 主键并不一定是连续的。在MySQL中，主键是用于唯一标识表中每一行数据的列。</p>\n<p>主键可以是自增的，也可以是手动指定的。</p>\n<p>如果主键是自增的，那么每次插入新的行时，MySQL会自动为该列生成一个递增的唯一值。</p>\n<p>即使主键是自增的，也不能保证主键的值是连续的。这是因为在实际使用中，可能会有一些情况导致主键值出现间隔或缺失，例如<code>删除了某些行、回滚操作、主键重置</code>等。</p>\n<p>因此，主键的连续性并不是MySQL中的要求或保证。主键的目的是唯一标识每一行数据，而不是要求连续递增的值。</p>\n</blockquote>\n<h5 id=\"主键插入不连续的情况1\">主键插入不连续的情况1</h5>\n<p><strong>根据要插入的值和当前自增值的大小关系，自增值的变更结果也会有所不同。</strong></p>\n<p>假设某次要插入的值是 <code>insert_num</code>，当前的自增值是 <code>autoIncrement_num</code>：</p>\n<ul>\n<li>如果 <code>insert_num &lt; autoIncrement_num</code>，那么这个表的自增值不变</li>\n<li>如果 <code>insert_num &gt;= autoIncrement_num</code>，就需要把当前自增值修改为新的自增值</li>\n</ul>\n<blockquote>\n<p>eg: 如果插入的 id 是 100，当前的自增值是 90，<code>insert_num &gt;= autoIncrement_num</code>，那么自增值就会被修改为新的自增值即 101；但是也不是100%这样的，有可能在分库分表的时候进行数据会进行路由分片，那么就会导致不连续,就是说在数据库中对数据进行分片存储的时候： 从 <code>auto_increment_offset(当前自增值)</code>开始，以 <code>auto_increment_increment </code>为<strong>步长</strong>，持续叠加，直到找到第一个大于 <code>要插入的</code> 的值,并将其作为新的自增值。</p>\n</blockquote>\n<h5 id=\"主键插入不连续的情况2\">主键插入不连续的情况2</h5>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">create</span>  <span class=\"keyword\">table</span> user_1;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> user_1;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_1 <span class=\"keyword\">values</span>(<span class=\"number\">1</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_1 <span class=\"keyword\">values</span>(<span class=\"number\">2</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p><strong>唯一键冲突</strong></p>\n<blockquote>\n<p>eg:</p>\n<ol>\n<li>\n<p>先往表里插入一条<code>(null,1,1)</code>的记录，生成的主键是 <code>1</code>，<code>AUTO_INCREMENT</code>= 2</p>\n</li>\n<li>\n<p>再执行一条插入 <code>(null,1,1)</code> 的命令，很显然会报错 <code>Duplicate entry</code>，因为我们设置了一个唯一索引字段 <code>a</code>：</p>\n</li>\n<li>\n<p>虽然插入失败了，但自增值仍然从 2 增加到了 3</p>\n</li>\n</ol>\n<p>原因：</p>\n<p>因为碰到唯一键 a 冲突，所以 id = 2 这一行并没有插入成功，但也没有将自增值再改回去。所以，在这之后，再插入新的数据行时，拿到的自增 id 就是 3。也就是说，出现了自增主键不连续的情况。</p>\n</blockquote>\n<blockquote>\n<p><img src=\"https://gitee.com/Ryang1118/typora2/raw/master/img/202310191214784.png\" alt><br>\n<img src=\"https://gitee.com/Ryang1118/typora2/raw/master/img/202310191214926.png\" alt></p>\n</blockquote>\n<h5 id=\"主键插入不连续的情况3\">主键插入不连续的情况3</h5>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">create</span>  <span class=\"keyword\">table</span> user_1;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> user_1;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_1 <span class=\"keyword\">values</span>(<span class=\"number\">1</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_1 <span class=\"keyword\">values</span>(<span class=\"number\">2</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_1 <span class=\"keyword\">values</span>(<span class=\"keyword\">null</span>, <span class=\"number\">11</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">begin</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_1 <span class=\"keyword\">value</span> (<span class=\"keyword\">null</span>, <span class=\"number\">12</span>,<span class=\"string\">&#x27;ry&#x27;</span>,<span class=\"number\">100</span>,<span class=\"string\">&#x27;China&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">rollback</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>回滚的时候</strong></p>\n<blockquote>\n<p>eg ：</p>\n<ol>\n<li>表里有一行 <code>(1,1,1)</code> 的记录，此时AUTO_INCREMENT = 3</li>\n<li>先插入一行数据 <code>(null, 2, 2)</code>，也就是 (3, 2, 2) 嘛，并且 AUTO_INCREMENT 变为 4</li>\n<li>begin ——insert ….——roolback</li>\n<li>在这种事务回滚的情况下，自增值并没有同样发生回滚！如下图所示，自增值仍然固执地从 4 增加到了 5</li>\n<li>这时候我们再去插入一条数据（null, 3, 3）的时候，主键 id 就会被自动赋为 <code>5</code> 了</li>\n</ol>\n<p>分析：为什么在出现唯一键冲突或者回滚的时候，MySQL 没有把表的自增值改回去呢</p>\n<p>主要原因是为了提高性能，因为为了解决这个主键冲突，有两种方法：</p>\n<ol>\n<li>每次申请 id 之前，<code>先判断</code>表里面是否已经存在这个 id，<code>如果存在，就跳过这个 id</code></li>\n<li>把自增 id 的锁范围扩大，必须等到一个事务执行完成并提交，下一个事务才能再申请自增 id</li>\n</ol>\n<p>很显然，上述两个方法的成本都比较高，会导致性能问题。所以<code>InnoDB </code>最终的设计就是在语句执行失败也不回退自增 id。也正是因为这样，所以才只保证了自增 id 是递增的，但不保证是连续的。</p>\n<p><img src=\"https://gitee.com/Ryang1118/typora2/raw/master/img/202310191214680.png\" alt><br>\n<img src=\"https://gitee.com/Ryang1118/typora2/raw/master/img/202310191214921.png\" alt></p>\n</blockquote>\n<h5 id=\"主键插入不连续的情况4\">主键插入不连续的情况4</h5>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> user_2;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> user_2;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> user_2(</span><br><span class=\"line\">    id <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> AUTO_INCREMENT,</span><br><span class=\"line\">    age  <span class=\"type\">int</span>(<span class=\"number\">4</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    score <span class=\"type\">int</span>(<span class=\"number\">3</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span> ,</span><br><span class=\"line\">    KEY `id_age_score_index` (id,age,score),</span><br><span class=\"line\">    <span class=\"keyword\">PRIMARY</span> KEY (id)</span><br><span class=\"line\">)Engine<span class=\"operator\">=</span>Innodb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_2 <span class=\"keyword\">values</span>(<span class=\"number\">1</span>, <span class=\"number\">1</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_2 <span class=\"keyword\">values</span>(<span class=\"number\">2</span>, <span class=\"number\">2</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_2 <span class=\"keyword\">values</span>(<span class=\"number\">3</span>, <span class=\"number\">3</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_2 <span class=\"keyword\">values</span>(<span class=\"number\">4</span>, <span class=\"number\">4</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_2 <span class=\"keyword\">values</span>(<span class=\"number\">5</span>, <span class=\"number\">5</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_2 <span class=\"keyword\">values</span>(<span class=\"number\">6</span>, <span class=\"number\">6</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_2 <span class=\"keyword\">values</span>(<span class=\"number\">7</span>, <span class=\"number\">7</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_2 <span class=\"keyword\">values</span>(<span class=\"number\">8</span>, <span class=\"number\">8</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> user_3;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> user_3 <span class=\"keyword\">like</span> user_2;  <span class=\"comment\">-- 只复制表结构</span></span><br><span class=\"line\"><span class=\"keyword\">select</span>  <span class=\"operator\">*</span> <span class=\"keyword\">from</span>  user_3;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> user_3;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> user_3(age,score) <span class=\"keyword\">select</span> age,score <span class=\"keyword\">from</span> user_2;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">create</span>  <span class=\"keyword\">table</span> user_3; <span class=\"comment\">-- 此时就是  AUTO_INCREMENT=16 </span></span><br></pre></td></tr></table></figure>\n<p><strong>批量插入数据</strong></p>\n<blockquote>\n<p>对于批量插入数据的语句，MySQL 有一个批量申请自增 id 的策略：</p>\n<ol>\n<li>语句执行过程中，第一次申请自增 id，会分配 1 个；</li>\n<li>1 个用完以后，这个语句第二次申请自增 id，会分配 2 个；</li>\n<li>2 个用完以后，还是这个语句，第三次申请自增 id，会分配 4 个；</li>\n<li>依此类推，同一个语句去申请自增 id，每次申请到的自增 id 个数都是上一次的两倍。</li>\n</ol>\n<p>这里说的批量插入数据，不是在普通的 insert 语句里面包含多个 value 值！！！，因为这类语句在申请自增 id 的时候，是可以精确计算出需要多少个 id 的，然后一次性申请，申请完成后锁就可以释放了。</p>\n<p>而对于 <code>insert … select</code>、<code>replace …… select</code> 和 <code>load data </code>这种类型的语句来说，MySQL 并不知道到底需要申请多少 id，所以就采用了这种批量申请的策略，毕竟一个一个申请的话实在太慢了。</p>\n<p>insert into <code>user_1</code>(a,b)  select a,b from <code> user_0</code>;</p>\n<p>insert……select 实际上往表中插入了 5 行数据 （1 1）（2 2）（3 3）（4 4）（5 5）。但是，这五行数据是分三次申请的自增 id，结合批量申请策略，每次申请到的自增 id 个数都是上一次的两倍，所以：</p>\n<ul>\n<li>第一次申请到了一个 id：id=1</li>\n<li>第二次被分配了两个 id：id=2 和 id=3</li>\n<li>第三次被分配到了 4 个 id：id=4、id = 5、id = 6、id=7</li>\n</ul>\n<p>由于这条语句实际只用上了 5 个 id，所以 id=6 和 id=7 就被浪费掉了。之后，再执行 <code>insert into test_pk2 values(null,6,6)</code>，实际上插入的数据就是（8,6,6)：</p>\n</blockquote>\n","_path":"post/c1e36521.html","_link":"http://rycan.top/post/c1e36521.html","_id":"clnwo8rqv007t8d0p6d4d6275"}}