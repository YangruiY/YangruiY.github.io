{"type":"getPostByPath","data":{"title":"CPU飙升","date":"2023-11-03T13:40:38.000Z","description":"CPU飙升的解决办法","categories":[{"name":"CPU飙升","_id":"cloioo9dk000cni0p9qyb02vy"}],"tags":[{"name":"CPU","_id":"cloioo9dk000dni0p4q8bcj78"}],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n<h2 id=\"先前的一些阐述：\">先前的一些阐述：</h2>\n<blockquote>\n<p>一般说的CPU的飙升是指：==总的CPU使用率==，会有一些监控平台，我们可以设置阈值，出现问题就会报警</p>\n<p>要是我们看到的个别应用的CPU达到300%甚至更高的时候，此时我们认为是由于CPU密集行计算导致的，可以认为是正常的现象</p>\n</blockquote>\n<h2 id=\"问题产生原因\">问题产生原因</h2>\n<ul>\n<li>CPU密集型的计算</li>\n<li>某个web 服务应用访问量增大就可能会导致cpu增高</li>\n<li>不合理的定时任务资源调度也会导致cpu飙高</li>\n<li>在调用数据库查询时，极短的时间内频繁调用模糊查询</li>\n<li>多线程任务时，线程发生死锁</li>\n<li>不合理的多线程高并发程序</li>\n</ul>\n<h2 id=\"问题复现\">问题复现</h2>\n<p>线上系统运行缓慢，CPU飙升，FullGC 的次数过多</p>\n<h2 id=\"问题排查\">问题排查</h2>\n<h3 id=\"查看CPU消耗，查看GC\">查看CPU消耗，查看GC</h3>\n<ol>\n<li>==top== ： 查看所有<code>进程</code>占用系统的cpu的比例，得到最可能出现问题进程的==PID==</li>\n<li>==top -Hp PID==  ： 查看该进程下所有<code>线程</code>所占用的CPU</li>\n<li>==printf %x\\n 线程id       =&gt;     a== ：将    线程ID    转为16 进制</li>\n<li>==jstack PID | grep  a(16进制)==： 得到对应的线程（0xa）状态</li>\n<li>==jstat -gcutil   进程号   统计间隔毫秒   统计次数（缺省代表一致统计）==：查看进程的GC变化情况，要是返回中的GC 很大并一直增大，就初步认定为Full GC</li>\n<li>==jmap   -heap  进程ID==：查看进程是不是有堆内存溢出的现象</li>\n<li>==jmap -dump:format=b,file=filename 进程ID==：导出内存 heap 输出到文件中</li>\n</ol>\n<h2 id=\"原因分析\">原因分析</h2>\n<h3 id=\"Full-GC\">Full GC</h3>\n<ul>\n<li>\n<p>生成大量的对象，导致内存溢出：查看具体内存对象占用情况   <code>步骤6</code></p>\n</li>\n<li>\n<p>内存占用不高，但是full gc 次数很多，可能是手动调用 System.gc()导致GC次数过多；解决： 添加 -XX:+DisableExplicitGC来禁用JVM对显示GC的响应</p>\n</li>\n</ul>\n<h3 id=\"CPU高消耗\">CPU高消耗</h3>\n<ul>\n<li>大量消耗CPU的操作，导致CPU过高，导致系统运行缓慢  <code>步骤4</code></li>\n</ul>\n<h3 id=\"死锁的产生\">死锁的产生</h3>\n<ul>\n<li>如果有死锁，会直接提示；关键字：deadlock      <code>步骤4</code>：打印出业务死锁的位置</li>\n</ul>\n<h3 id=\"阻塞操作\">阻塞操作</h3>\n<ul>\n<li>代码某个位置有阻塞性的操作，导致该功能调用整体比较耗时，但出现是比较随机的；平时消耗的CPU不多，而且占用的内存也不高。</li>\n</ul>\n<p>解决：首先找到该接口，通过压测工具不断加大访问力度，大量线程将阻塞于该阻塞</p>\n<h3 id=\"等待状态\">等待状态</h3>\n<ul>\n<li>某个线程由于某种原因而进入WAITING状态，此时该功能整体不可用，但是无法复现</li>\n</ul>\n","_path":"post/b181fd56.html","_link":"http://rycan.top/post/b181fd56.html","_id":"cloioo9dg0003ni0pbz9vahac"}}