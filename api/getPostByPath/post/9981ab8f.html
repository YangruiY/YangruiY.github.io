{"type":"getPostByPath","data":{"title":"Springboot 整合 redis","date":"2023-07-02T16:48:36.000Z","description":"Springboot 整合 redis","categories":[{"name":"redis","_id":"clo9tj5vm002tl10p7tfx7fqt"}],"tags":[{"name":"redis","_id":"clo9tj5vx005ml10phaep1i1s"},{"name":"Springboot","_id":"clo9tj5w40072l10p189idfcl"}],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h3 id=\"使用Spring-Data-Redis：\"><a href=\"#使用Spring-Data-Redis：\" class=\"headerlink\" title=\"使用Spring Data Redis：\"></a>使用Spring Data Redis：</h3><ul>\n<li>Spring Data Redis是Spring提供的一个模块，可以简化与Redis的集成。它提供了一组简单易用的API，可以通过注解或者编程方式与Redis进行交互。</li>\n</ul>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305242101617.png\" alt=\"image-20230524210152588\" style=\"zoom:33%;\"></p>\n<h4 id=\"产生问题-转圈圈\"><a href=\"#产生问题-转圈圈\" class=\"headerlink\" title=\"产生问题: 转圈圈\"></a>产生问题: 转圈圈</h4><ul>\n<li><p>原因：SpringBoot客户端没有<code>动态感知</code>RedisCluster的最新集群信息</p>\n</li>\n<li><p>现象：Redis Cluster集群部署采用了3主3从拓扑结构，数据读写访问master节点，slave节点负责备份。当master宕机主从切换成功，redis可以正常运行，但是<code>java程序出现异常</code></p>\n</li>\n<li><p>解决：</p>\n<ul>\n<li><p>排除lettuce采用Jedis（不推荐）</p>\n</li>\n<li><p>重写连接工厂实例（极度不推荐）</p>\n</li>\n<li><p><code>刷新节点集群拓扑动态感应</code>==（推荐）==</p>\n<ul>\n<li>调用 <code>RedisClusterClient.reloadPartitions</code></li>\n<li>后台基于时间间隔的周期刷新</li>\n<li>后台基于持续的 <strong>断开</strong> 和 <strong>移动</strong>、<strong>重定向</strong> 的自适应更新</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#支持集群拓扑动态感应刷新，自适应拓扑刷新是否使用所有可用的更新，默认false关闭</span></span><br><span class=\"line\"><span class=\"string\">spring.redis.lettuce.cluster.refresh.adaptive=true</span></span><br><span class=\"line\"><span class=\"comment\">#定时刷新</span></span><br><span class=\"line\"><span class=\"string\">spring.redis.lettuce.cluster.refresh.period=2000</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"使用Jedis或Lettuce：\"><a href=\"#使用Jedis或Lettuce：\" class=\"headerlink\" title=\"使用Jedis或Lettuce：\"></a>使用Jedis或Lettuce：</h3><ul>\n<li><p>Jedis和Lettuce是两个常用的Java Redis客户端库。你可以直接使用它们来连接Redis，并且Spring提供了对它们的集成支持。这种方式需要手动配置Redis连接和操作。</p>\n</li>\n<li><p>Jedis本身是<code>线程不安全</code>的，并且<code>频繁的创建和销毁连接</code>会有性能损耗，推荐使用Jedis<code>连接池</code>代替Jedis的<code>直连</code>方式。</p>\n</li>\n</ul>\n<h3 id=\"使用Spring-Boot的自动配置：\"><a href=\"#使用Spring-Boot的自动配置：\" class=\"headerlink\" title=\"使用Spring Boot的自动配置：\"></a>使用Spring Boot的自动配置：</h3><ul>\n<li>如果你使用Spring Boot，它提供了自动配置Redis的功能。只需在项目的配置文件中添加相关配置，Spring Boot将自动创建和配置与Redis的连接。</li>\n</ul>\n","_path":"post/9981ab8f.html","_link":"http://rycan.top/post/9981ab8f.html","_id":"clo9tj5vq003nl10p8xyz4ksy"}}