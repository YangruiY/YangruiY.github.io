{"type":"getPostByPath","data":{"title":"Dubbo","date":"2023-07-03T12:32:55.000Z","description":"Dubbo","categories":[{"name":"框架","_id":"cloioo9ds001ani0pc34ggtc0"}],"tags":[{"name":"Dubbo","_id":"cloioo9ds001bni0p85dlfmcs"}],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n<h1>Dubbo</h1>\n<p><a href=\"https://www.bilibili.com/video/BV1VE411q7dX?spm_id_from=333.337.search-card.all.click&amp;vd_source=6aafd031757cd8c1dbbb98344fb3d363\">学习视频地址(opens new window)</a></p>\n<ul>\n<li>分布式系统中相关的概念\n<ul>\n<li><a href=\"https://frxcat.fun/pages/48771f/#%E5%A4%A7%E5%9E%8B%E4%BA%92%E8%81%94%E7%BD%91%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E7%9B%AE%E6%A0%87\">大型互联网项目架构目标</a></li>\n<li><a href=\"https://frxcat.fun/pages/48771f/#%E9%9B%86%E7%BE%A4%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F\">集群和分布式</a></li>\n<li><a href=\"https://frxcat.fun/pages/48771f/#%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B\">架构演进</a></li>\n</ul>\n</li>\n<li><a href=\"https://frxcat.fun/pages/48771f/#dubbo-%E6%A6%82%E8%BF%B0\">Dubbo 概述</a></li>\n</ul>\n<h2 id=\"基本概念\">基本概念</h2>\n<h3 id=\"分布式系统中相关的概念\">分布式系统中相关的概念</h3>\n<h4 id=\"RPC\">RPC</h4>\n<p>RPC（Remote Procedure Call） 即远程过程调用。</p>\n<p>为什么要 RPC ？</p>\n<p>因为，两个不同的服务器上的服务提供的方法不在一个内存空间，所以，需要通过网络编程才能传递方法调用所需要的参数</p>\n<p>并且，方法调用的结果也需要通过网络编程来接收。</p>\n<p>但是，如果我们自己手动网络编程来实现这个调用过程的话工作量是非常大的，因为，我们需要考虑底层传输方式（TCP 还是 UDP）、序列化方式等等方面。</p>\n<h5 id=\"RPC-能帮助我们做什么呢？\">**RPC 能帮助我们做什么呢？ **</h5>\n<p>简单来说，通过 RPC 可以帮助我们调用远程计算机上某个服务的方法，这个过程就像调用本地方法一样简单。并且！我们不需要了解底层网络编程的具体细节。</p>\n<blockquote>\n<p>一言蔽之：RPC 的出现就是为了让你调用远程方法像调用本地方法一样简单。</p>\n</blockquote>\n<h3 id=\"RPC-的原理是什么？\">RPC 的原理是什么？</h3>\n<p>客户端（服务消费端） ：调用远程方法的一端。</p>\n<p>客户端 Stub（桩） ： 这其实就是一代理类。代理类主要做的事情很简单，就是把你调用方法、类、方法参数等信息传递到服务端。</p>\n<p>网络传输 ： 网络传输就是你要把你调用的方法的信息（比如说参数啊这些东西）传输到服务端，然后服务端执行完之后再把返回结果通过网络传输给你传输回来。</p>\n<p>​\t网络传输的实现方式有很多种比如最近基本的 Socket 或者性能以及封装更加优秀的 Netty（推荐）。</p>\n<p>服务端 Stub（桩） ：这个桩就不是代理类了。</p>\n<p>我觉得理解为桩实际不太好，大家注意一下就好。这里的服务端 Stub 实际指的就是接收到客户端执行方法的请求后，去指定对应的方法然后返回结果给客户端的类。</p>\n<p>服务端（服务提供端） ：提供远程方法的一端。</p>\n<p>具体原理图如下</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051407439.png\" alt=\"image-20230505140708369\" style=\"zoom:33%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051503536.png\" alt=\"image-20230505150301489\" style=\"zoom:43%;\">\n<ul>\n<li>客户端（client）以本地调用的方式调用远程服务；</li>\n<li>客户端 Stub（client stub） 接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体（序列化）：RpcRequest；</li>\n<li>客户端 Stub（client stub） 找到远程服务的地址，并将消息发送到服务提供端；</li>\n<li>服务端 Stub（桩）收到消息将消息反序列化为 Java 对象: RpcRequest；</li>\n<li>服务端 Stub（桩）根据 RpcRequest 中的类、方法、方法参数等信息调用本地的方法；</li>\n<li>服务端 Stub（桩）得到方法执行结果并将组装成能够进行网络传输的消息体：RpcResponse（序列化）发送至消费方；</li>\n<li>客户端 Stub（client stub）接收到消息并将消息反序列化为 Java 对象:RpcResponse ，这样也就得到了最终结果</li>\n</ul>\n<h4 id=\"大型互联网项目架构目标\">大型互联网项目架构目标</h4>\n<p><strong>用户体验</strong></p>\n<ul>\n<li>美观、功能、速度、稳定性</li>\n</ul>\n<p>衡量一个网站速度是否快：</p>\n<ul>\n<li>打开一个新页面一瞬间完成；页面内跳转，一刹那间完成。</li>\n<li>根据佛经《僧祇律》记载：一刹那者为一念，二十念为一瞬，二十瞬为一弹指，二十弹指为一罗预，二十罗预为一须臾，一日一夜有三十须臾。</li>\n<li>经过周密的计算，一瞬间为0.36 秒,一刹那有 0.018 秒</li>\n<li>传统项目与互联网项目</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103236.webp\" alt=\"image\" style=\"zoom:33%;\">\n<p>互联网项目特点：</p>\n<ul>\n<li>用户多</li>\n<li>流量大，并发高</li>\n<li>海量数据</li>\n<li>易受攻击</li>\n<li>功能繁琐</li>\n<li>变更快</li>\n</ul>\n<p><strong>衡量网站的性能指标：</strong></p>\n<ul>\n<li><strong>响应时间</strong>：指执行一个请求从开始到最后收到响应数据所花费的总体时间。</li>\n<li><strong>并发数</strong>：指系统同时能处理的请求数量。</li>\n<li><strong>并发连接数</strong>：指的是客户端向服务器发起请求，并建立了TCP连接。每秒钟服务器连接的总TCP数量</li>\n<li><strong>请求数</strong>：也称为QPS(Query Per Second) 指每秒多少请求.</li>\n<li><strong>并发用户数</strong>：单位时间内有多少用户</li>\n<li><strong>吞吐量</strong>：指单位时间内系统能处理的请求数量。</li>\n<li><strong>QPS</strong>：Query Per Second 每秒查询数。</li>\n<li><strong>TPS</strong>：Transactions Per Second 每秒事务数。</li>\n<li>一个事务是：指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。</li>\n<li>一个页面的一次访问，只会形成一个TPS；但一次页面请求，可能产生多次对服务器的请求，就会有多个QPS</li>\n</ul>\n<blockquote>\n<p>QPS &gt;= 并发连接数 &gt;= TPS</p>\n</blockquote>\n<p><strong>目标</strong>:</p>\n<ul>\n<li><strong>高性能</strong>：提供快速的访问体验。</li>\n<li><strong>高可用</strong>：网站服务一直可以正常访问。</li>\n<li><strong>可伸缩</strong>：通过硬件增加/减少，提高/降低处理能力。</li>\n<li><strong>高可扩展</strong>：系统间耦合低，方便的通过新增/移除方式，增加/减少新的功能/模块。</li>\n<li><strong>安全性</strong>：提供网站安全访问和数据加密，安全存储等策略。</li>\n<li><strong>敏捷性</strong>：随需应变，快速响应。</li>\n</ul>\n<h3 id=\"集群和分布式\">集群和分布式</h3>\n<ul>\n<li>集群：很多“人”一起 ，<code>干一样</code>的事。\n<ul>\n<li>一个业务模块，部署在多台服务器上。</li>\n</ul>\n</li>\n<li>分布式：很多“人”一起，干<code>不一样</code>的事。这些不一样的事，合起来是一件大事。\n<ul>\n<li>一个大的业务系统，拆分为小的业务模块，分别部署在不同的机器上。</li>\n</ul>\n</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103042.webp\" alt=\"image\" style=\"zoom:33%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103452.webp\" alt=\"image\" style=\"zoom:33%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103811.webp\" alt=\"image\" style=\"zoom:33%;\">\n<h3 id=\"架构\">架构</h3>\n<h4 id=\"演进\">演进</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103653.webp\" alt=\"image\" style=\"zoom:50%;\">\n<h4 id=\"单体架构\">单体架构</h4>\n<p>当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。此时，用于简化增删改查工作量的数据访问框架(ORM)是关键。</p>\n<p><img src=\"https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220808/image.4x8kymw89lw0.webp\" alt></p>\n<p>优点：</p>\n<ul>\n<li>简单：开发部署都很方便，小型项目首选</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>项目启动慢</li>\n<li>可靠性差</li>\n<li>可伸缩性差</li>\n<li>扩展性和可维护性差</li>\n<li>性能低</li>\n</ul>\n<h4 id=\"垂直架构\">垂直架构</h4>\n<p>当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC)是关键。</p>\n<p>通过切分业务来实现各个模块独立部署，降低了维护和部署的难度，团队各司其职更易管理，性能扩展也更方便，更有针对性。</p>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103690.webp\" alt></p>\n<ul>\n<li>垂直架构是指将单体架构中的多个模块拆分为多个独立的项目。形成多个独立的单体架构。</li>\n</ul>\n<p>单体架构存在的问题：</p>\n<ul>\n<li>项目启动慢</li>\n<li>可靠性差</li>\n<li>可伸缩性差</li>\n<li>扩展性和可维护性差</li>\n<li>性能低</li>\n</ul>\n<p>垂直架构存在的问题：</p>\n<ul>\n<li>重复功能太多</li>\n</ul>\n<h4 id=\"分布式架构\">分布式架构</h4>\n<p>当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的**分布式服务框架(RPC)**是关键。</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103909.webp\" alt=\"image\" style=\"zoom:53%;\">\n<ul>\n<li>分布式架构是指在垂直架构的基础上，将公共业务模块抽取出来，作为独立的服务，供其他调用者消费，以实现服务的共享和重用。</li>\n<li>RPC： Remote Procedure Call 远程过程调用。有非常多的协议和技术来都实现了RPC的过程。比如：HTTP REST风格，Java RMI规范、WebService SOAP协议、Hession等等。</li>\n</ul>\n<p>垂直架构存在的问题：</p>\n<ul>\n<li>重复功能太多</li>\n</ul>\n<p>分布式架构存在的问题：</p>\n<ul>\n<li>服务提供方一旦产生变更，所有消费方都需要变更。</li>\n</ul>\n<h4 id=\"SOA架构\">SOA架构</h4>\n<p>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于**提高机器利用率的资源调度和治理中心(SOA)[ Service Oriented Architecture]**是关键。</p>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103437.webp\" alt></p>\n<ul>\n<li>SOA：（Service-Oriented Architecture，面向服务的架构）是一个组件模型，它将应用程序的不同功能单元（称为服务）进行拆分，并通过这些服务之间定义良好的接口和契约联系起来。</li>\n<li>ESB：(Enterparise Servce Bus) 企业服务总线，服务中介。主要是提供了一个服务与服务之间的交互。ESB 包含的功能如：负载均衡，流量控制，加密处理，服务的监控，异常处理，监控告急等等。</li>\n<li>分布式架构存在的问题：\n<ul>\n<li>服务提供方一旦产生变更，所有消费方都需要变更</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"微服务架构\">微服务架构</h4>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103858.webp\" alt></p>\n<ul>\n<li>微服务架构是在 SOA 上做的升华，微服务架构强调的一个重点是“业务需要彻底的组件化和服务化”，原有的单个业务系统会拆分为多个可以独立开发、设计、运行的小应用。这些小应用之间通过服务完成交互和集成。</li>\n<li>微服务架构 = 80%的SOA服务架构思想 + 100%的组件化架构思想 + 80%的领域建模思想</li>\n<li>特点：</li>\n<li>服务实现组件化：开发者可以自由选择开发技术。也不需要协调其他团队</li>\n<li>服务之间交互一般使用REST API</li>\n<li>去中心化：每个微服务有自己私有的数据库持久化业务数据</li>\n<li>自动化部署：把应用拆分成为一个一个独立的单个服务，方便自动化部署、测试、运维</li>\n</ul>\n<h2 id=\"Dubbo-概述\">Dubbo 概述</h2>\n<ul>\n<li>Dubbo是阿里巴巴公司开源的一个高性能、轻量级的 Java<code> RPC 框架</code>。</li>\n<li>致力于提供高性能和透明化的 RPC 远程服务调用方案，以及 SOA 服务治理方案。</li>\n<li>官网：<a href=\"http://dubbo.apache.org/\">http://dubbo.apache.org/</a></li>\n</ul>\n<h3 id=\"Dubbo-架构\">Dubbo 架构</h3>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030103037.webp\" alt=\"image\" style=\"zoom: 67%;\">\n<p><strong>节点角色说明：</strong></p>\n<ul>\n<li><strong>Provider</strong>：暴露服务的  服务提供方</li>\n<li><strong>Container</strong>：服务运行容器</li>\n<li><strong>Consumer</strong>：调用远程服务的服务消费方</li>\n<li><strong>Registry</strong>：服务注册与发现的注册中心</li>\n<li><strong>Monitor</strong>：统计服务的调用次数和调用时间的监控中心</li>\n</ul>\n<h4 id=\"Dubbo-服务器注册与发现的流程\">Dubbo 服务器注册与发现的流程</h4>\n<ul>\n<li>服务容器 Container 负责启动，加载，运行服务提供者；</li>\n<li>服务提供者 Provider 在启动时，向注册中心注册自己提供的服务；</li>\n<li>服务消费者 Consumer 在启动时，向注册中心订阅自己所需的服务；</li>\n<li>注册中心 Registry 返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者；</li>\n<li>服务消费者 Consumer，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用；</li>\n<li>服务消费者 Consumer 和提供者 Provider，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心 Monitor。</li>\n</ul>\n<h4 id=\"Dubbo-的整体架构设计有哪些分层？\">Dubbo 的整体架构设计有哪些分层？</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051417867.png\" alt=\"image-20230505141730797\" style=\"zoom:50%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051417359.png\" alt=\"image-20230505141751301\" style=\"zoom:50%;\">\n<ul>\n<li>\n<p>接口服务层（Service)：该层与业务逻辑相关，根据 provider 和 consumer 的业务设计对应的接口和实现</p>\n</li>\n<li>\n<p>配置层（Config）：对外配置接口，以 ServiceConfig 和 ReferenceConfig 为中心</p>\n</li>\n<li>\n<p>服务代理层（Proxy）：服务接口透明代理，生成服务的客户端 Stub 和 服务端的 Skeleton，以 ServiceProxy 为中心，扩展接口为 ProxyFactory</p>\n</li>\n<li>\n<p>服务注册层（Registry）：封装服务地址的注册和发现，以服务 URL 为中心，扩展接口为 RegistryFactory、Registry、RegistryService</p>\n</li>\n<li>\n<p>路由层（Cluster）：封装多个提供者的路由和负载均衡，并桥接注册中心，以 Invoker 为中心，扩展接口为 Cluster、Directory、Router 和 LoadBlancce。</p>\n</li>\n<li>\n<p>监控层（Monitor）：RPC 调用次数和调用时间监控，以 Statistics 为中心，扩展接口为 MonitorFactory、Monitor 和 MonitorService</p>\n</li>\n<li>\n<p>远程调用层（Protocal）：封装 RPC 调用，以 Invocation 和 Result 为中心，扩展接口为 Protocal、Invoker 和 Exporter</p>\n</li>\n<li>\n<p>信息交换层（Exchange）：封装请求响应模式，同步转异步。以 Request 和 Response 为中心，扩展接口为 Exchanger、ExchangeChannel、ExchangeClient 和 ExchangeServer</p>\n</li>\n<li>\n<p>网络传输 层（Transport）：抽象 mina 和 netty 为统一接口，以 Message 为中心，扩展接口为 Channel、Transporter、Client、Server 和 Codec</p>\n</li>\n<li>\n<p>数据序列化层（Serialize）：可复用的一些工具，扩展接口为 Serialization、ObjectInput、ObjectOutput 和 ThreadPool</p>\n</li>\n</ul>\n<h3 id=\"核心功能\">核心功能</h3>\n<ul>\n<li>面向接口代理的高性能 RPC 调用</li>\n<li>智能容错和负载均衡</li>\n<li>服务自动注册和发现</li>\n<li>高度可扩展能力</li>\n<li>运行期流量调度</li>\n<li>可视化的服务治理与运维</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051410875.png\" alt=\"image-20230505141013815\" style=\"zoom:50%;\">\n<h4 id=\"作用：\">作用：</h4>\n<p>Dubbo 帮助我们解决了什么问题呢？</p>\n<ul>\n<li>透明化的远程方法调用：就像调用本地方法一样调用远程方法，只需简单配置，没有任何 API 侵入；</li>\n<li>软负载均衡及容错机制：可在内网替代 F5 等硬件负载均衡器，降低成本，减少单点故障；</li>\n<li>服务自动注册与发现：不再需要写死服务提供方地址，注册中心基于接口名查询服务提供者的 IP 地址，并且能够平滑添加或删除服务提供者。</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051411811.png\" alt=\"image-20230505141123755\" style=\"zoom:50%;\">\n<h4 id=\"Dubbo-中的-Invoker-概念了解么？\">Dubbo 中的 Invoker 概念了解么？</h4>\n<p>Invoker 是 Dubbo 领域模型中非常重要的一个概念，你如果阅读过 Dubbo 源码的话，你会无数次看到它。</p>\n<p>就比如下面要说的负载均衡这块的源码中就有大量 Invoker 的身影。</p>\n<p>简单来说，Invoker 就是 Dubbo 对远程调用的抽象。</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051419642.png\" alt=\"image-20230505141916610\" style=\"zoom:33%;\">\n<blockquote>\n<p>Dubbo 官方的话来说，Invoker 分为：</p>\n<ul>\n<li>服务提供 Invoker</li>\n<li>服务消费 Invoker</li>\n<li>假如我们需要调用一个远程方法，我们需要动态代理来屏蔽远程调用的细节吧！我们屏蔽掉的这些细节就依赖对应的 Invoker 实现， Invoker 实现了真正的远程服务调用。</li>\n</ul>\n</blockquote>\n<h4 id=\"Dubbo-Monitor-实现原理？\">Dubbo Monitor 实现原理？</h4>\n<p>Consumer 端在发起调用之前会先走 filter 链；provider 端在接收到请求时也是先走 filter 链，然后才进行真正的业务逻辑处理。默认情况下，在 consumer 和 provider 的 filter 链中都会有 Monitorfilter。</p>\n<ul>\n<li>MonitorFilter 向 DubboMonitor 发送数据；</li>\n<li>DubboMonitor 将数据进行聚合后（默认聚合 1min 中的统计数据）暂存到 ConcurrentMap&lt;Statistics, AtomicReference&gt; statisticsMap，然后使用一个含有 3 个线程（线程名字：DubboMonitorSendTimer）的线程池每隔 1min 钟，调用 SimpleMonitorService 遍历发送 statisticsMap 中的统计数据，每发送完毕一个，就重置当前的 Statistics 的 AtomicReference；</li>\n<li>SimpleMonitorService 将这些聚合数据塞入 BlockingQueue queue 中（队列大小为 100000）；</li>\n<li>SimpleMonitorService 使用一个后台线程（线程名为：DubboMonitorAsyncWriteLogThread）将 queue 中的数据写入文件（该线程以死循环的形式来写）；</li>\n<li>SimpleMonitorService 还会使用一个含有 1 个线程（线程名字：DubboMonitorTimer）的线程池每隔 5min 钟，将文件中的统计数据画成图表。</li>\n</ul>\n<h4 id=\"Dubbo-提供的线程模型\">Dubbo 提供的线程模型</h4>\n<ul>\n<li>\n<p>all：所有消息都派发到线程池，包括请求，响应，连接事件，断开事件，心跳等。</p>\n</li>\n<li>\n<p>direct：所有消息都不派发到线程池，全部在 IO 线程上直接执行。</p>\n</li>\n<li>\n<p>execution：只请求消息派发到线程池，不含响应，响应和其它连接断开事件，心跳等消息，直接在 IO 线程上执行。</p>\n</li>\n<li>\n<p>connection：在 IO 线程上，将连接断开事件放入队列，有序逐个执行，其它消息派发到线程池。</p>\n</li>\n</ul>\n<h4 id=\"服务提供方实现类到-Invoker-的转换\">服务提供方实现类到 Invoker 的转换</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051422515.png\" alt=\"image-20230505142206483\" style=\"zoom:33%;\">\n<p>服务提供方实现类到 Invoker 的转换，是通过 ProxyFactory 类的 getInvoker 方法使用 服务实现类 生成一个 AbstractProxyInvoker 实例，其中使用 wrapper 类消除反射，提高性能。</p>\n<h4 id=\"服务提供方-Invoker-到-Exporter-的转换\">服务提供方 Invoker 到 Exporter 的转换</h4>\n<p>服务提供方实现 Invoker 到 Exporter 的转换，主要是打开创建一个 Netty Server 侦听服务，并接收客户端发来的各种请求，通讯细节由 Dubbo 自己实现，然后注册服务到服务注册中心。</p>\n<h4 id=\"服务消费方远程服务到-Invoker-的转换\">服务消费方远程服务到 Invoker 的转换</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051422809.png\" alt=\"image-20230505142246781\" style=\"zoom:33%;\">\n<p>服务消费方远程服务到 Invoker 的转换，是通过 ReferenceConfig 类的 init 方法调用 Protocol 的 refer 方法生成 Invoker 实例，这是服务消费的关键。</p>\n<h4 id=\"服务消费方-Invoker-到客户端接口的转换\">服务消费方 Invoker 到客户端接口的转换</h4>\n<p>服务消费方远程服务到 Invoker 的转换，是通过 ReferenceConfig 类的 init 方法调用 Protocol 的 refer 方法生成 Invoker 实例，这是服务消费的关键。</p>\n<h4 id=\"Dubbo-和-Spring-Cloud-有什么关系？\">Dubbo 和 Spring Cloud 有什么关系？</h4>\n<p>Dubbo 是 SOA 时代的产物，它的关注点主要在于服务的调用，流量分发、流量监控和熔断。</p>\n<p>而 Spring Cloud 诞生于微服务架构时代，考虑的是微服务治理的方方面面，另外由于依托了 Spring、Spring Boot 的优势之上，两个框架在开始目标就不一致，Dubbo 定位服务治理、Spring Cloud 是打造一个生态。</p>\n<h4 id=\"Dubbo-和-Spring-Cloud-有哪些区别？\">Dubbo 和 Spring Cloud 有哪些区别？</h4>\n<ul>\n<li>\n<p>Dubbo 底层是使用 Netty 这样的 NIO 框架，是基于 TCP 协议传输的，配合以 Hession 序列化完成 RPC 通信。</p>\n</li>\n<li>\n<p>Spring Cloud 是基于 Http 协议 Rest 接口调用远程过程的通信，相对来说 Http 请求会有更大的报文，占的带宽也会更多。</p>\n</li>\n</ul>\n<p>但是 REST 相比 RPC 更为灵活，服务提供方和调用方的依赖只依靠一纸契约，不存在代码级别的强依赖，这在强调快速演化的微服务环境下，显得更为合适，至于注重通信速度还是方便灵活性，具体情况具体考虑。</p>\n<h3 id=\"注册中心\">注册中心</h3>\n<h4 id=\"Dubbo-有哪些注册中心？\">Dubbo 有哪些注册中心？</h4>\n<ul>\n<li>Multicast 注册中心：Multicast 注册中心不需要任何中心节点，只要广播地址，就能进行服务注册和发现，基于网络中组播传输实现。</li>\n<li>Zookeeper 注册中心：基于分布式协调系统 Zookeeper 实现，采用 Zookeeper 的 watch 机制实现数据变更。（推荐）</li>\n<li>Redis 注册中心：基于 Redis 实现，采用 key/map 存储，key 存储服务名和类型，map 中 key 存储服务 url，value 服务过期时间。基于 Redis 的发布 / 订阅模式通知数据变更。</li>\n<li>Simple 注册中心。</li>\n</ul>\n<h3 id=\"集群\">集群</h3>\n<h5 id=\"Dubbo-的注册中心集群挂掉，发布者和订阅者之间还能通信么？\">Dubbo 的注册中心集群挂掉，发布者和订阅者之间还能通信么？</h5>\n<p>可以通讯。启动 Dubbo 时，消费者会从 Zookeeper 拉取注册的生产者的地址接口等数据，缓存在本地。每次调用时，按照本地存储的地址进行调用。</p>\n<h5 id=\"Dubbo-集群提供了哪些负载均衡策略？\">Dubbo 集群提供了哪些负载均衡策略？</h5>\n<p>在集群负载均衡时，Dubbo 提供了多种均衡策略，默认为 random 随机调用。我们还可以自行扩展负载均衡策略（参考 Dubbo SPI 机制）。</p>\n<p>在 Dubbo 中，所有负载均衡实现类均继承自 AbstractLoadBalance，该类实现了 LoadBalance 接口，并封装了一些公共的逻辑。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AbstractLoadBalance</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">LoadBalance</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">calculateWarmupWeight</span><span class=\"params\">(<span class=\"type\">int</span> uptime, <span class=\"type\">int</span> warmup, <span class=\"type\">int</span> weight)</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; Invoker&lt;T&gt; <span class=\"title function_\">select</span><span class=\"params\">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> &lt;T&gt; Invoker&lt;T&gt; <span class=\"title function_\">doSelect</span><span class=\"params\">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"title function_\">getWeight</span><span class=\"params\">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h6 id=\"RandomLoadBalance\">RandomLoadBalance</h6>\n<ul>\n<li>根据权重随机选择（对加权随机算法的实现）。这是 Dubbo 默认采用的一种负载均衡策略。</li>\n<li>RandomLoadBalance 具体的实现原理非常简单，假如有两个提供相同服务的服务器 S1,S2，S1 的权重为 7，S2 的权重为 3。我们把这些权重值分布在坐标区间会得到：S1-&gt;[0, 7) ，S2-&gt;(7, 10]。我们生成 [0, 10) 之间的随机数，随机数落到对应的区间，我们就选择对应的服务器来处理请求。</li>\n</ul>\n<p>RandomLoadBalance 的源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RandomLoadBalance</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractLoadBalance</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;random&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> &lt;T&gt; Invoker&lt;T&gt; <span class=\"title function_\">doSelect</span><span class=\"params\">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">length</span> <span class=\"operator\">=</span> invokers.size();</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">sameWeight</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] weights = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[length]; </span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">totalWeight</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 下面这个for循环的主要作用就是计算所有该服务的提供者的权重之和 totalWeight（），</span></span><br><span class=\"line\">        <span class=\"comment\">// 除此之外，还会检测每个服务提供者的权重是否相同</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">weight</span> <span class=\"operator\">=</span> getWeight(invokers.get(i), invocation);</span><br><span class=\"line\">            totalWeight += weight;</span><br><span class=\"line\">            weights[i] = totalWeight;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sameWeight &amp;&amp; totalWeight != weight * (i + <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                sameWeight = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (totalWeight &gt; <span class=\"number\">0</span> &amp;&amp; !sameWeight) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 随机生成一个 [0, totalWeight) 区间内的数字</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">offset</span> <span class=\"operator\">=</span> ThreadLocalRandom.current().nextInt(totalWeight);</span><br><span class=\"line\">            <span class=\"comment\">// 判断会落在哪个服务提供者的区间</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (offset &lt; weights[i]) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> invokers.get(i);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> invokers.get(ThreadLocalRandom.current().nextInt(length));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"LeastActiveLoadBalance\">LeastActiveLoadBalance</h6>\n<ul>\n<li>LeastActiveLoadBalance 直译过来就是最小活跃数负载均衡。解释：初始状态下所有服务提供者的活跃数均为 0（每个服务提供者的中特定方法都对应一个活跃数），每收到一个请求后，对应的服务提供者的活跃数 +1，当这个请求处理完之后，活跃数 -1。</li>\n<li>因此，Dubbo 认为谁的活跃数越少，谁的处理速度就越快，性能也越好，这样的话，就优先把请求给活跃数少的服务提供者处理。</li>\n</ul>\n<p>但是如果有多个服务提供者的活跃数相等怎么办？</p>\n<p>很简单，那就再走一遍 RandomLoadBalance</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LeastActiveLoadBalance</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractLoadBalance</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;leastactive&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> &lt;T&gt; Invoker&lt;T&gt; <span class=\"title function_\">doSelect</span><span class=\"params\">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">length</span> <span class=\"operator\">=</span> invokers.size();</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">leastActive</span> <span class=\"operator\">=</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">leastCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] leastIndexes = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[length];</span><br><span class=\"line\">        <span class=\"type\">int</span>[] weights = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[length];</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">totalWeight</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">firstWeight</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">sameWeight</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 这个 for 循环的主要作用是遍历 invokers 列表，找出活跃数最小的 Invoker</span></span><br><span class=\"line\">        <span class=\"comment\">// 如果有多个 Invoker 具有相同的最小活跃数，还会记录下这些 Invoker 在 invokers 集合中的下标，并累加它们的权重，比较它们的权重值是否相等</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">            Invoker&lt;T&gt; invoker = invokers.get(i);</span><br><span class=\"line\">            <span class=\"comment\">// 获取 invoker 对应的活跃(active)数</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">active</span> <span class=\"operator\">=</span> RpcStatus.getStatus(invoker.getUrl(), invocation.getMethodName()).getActive();</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">afterWarmup</span> <span class=\"operator\">=</span> getWeight(invoker, invocation);</span><br><span class=\"line\">            weights[i] = afterWarmup;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (leastActive == -<span class=\"number\">1</span> || active &lt; leastActive) &#123;</span><br><span class=\"line\">                leastActive = active;</span><br><span class=\"line\">                leastCount = <span class=\"number\">1</span>;</span><br><span class=\"line\">                leastIndexes[<span class=\"number\">0</span>] = i;</span><br><span class=\"line\">                totalWeight = afterWarmup;</span><br><span class=\"line\">                firstWeight = afterWarmup;</span><br><span class=\"line\">                sameWeight = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (active == leastActive) &#123;</span><br><span class=\"line\">                leastIndexes[leastCount++] = i;</span><br><span class=\"line\">                totalWeight += afterWarmup;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (sameWeight &amp;&amp; afterWarmup != firstWeight) &#123;</span><br><span class=\"line\">                    sameWeight = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">       <span class=\"comment\">// 如果只有一个 Invoker 具有最小的活跃数，此时直接返回该 Invoker 即可</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (leastCount == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> invokers.get(leastIndexes[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 如果有多个 Invoker 具有相同的最小活跃数，但它们之间的权重不同</span></span><br><span class=\"line\">        <span class=\"comment\">// 这里的处理方式就和  RandomLoadBalance 一致了</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!sameWeight &amp;&amp; totalWeight &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">offsetWeight</span> <span class=\"operator\">=</span> ThreadLocalRandom.current().nextInt(totalWeight);</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; leastCount; i++) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">leastIndex</span> <span class=\"operator\">=</span> leastIndexes[i];</span><br><span class=\"line\">                offsetWeight -= weights[leastIndex];</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (offsetWeight &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> invokers.get(leastIndex);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> invokers.get(leastIndexes[ThreadLocalRandom.current().nextInt(leastCount)]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>活跃数是通过 RpcStatus 中的一个 ConcurrentMap 保存的，根据 URL 以及服务提供者被调用的方法的名称，我们便可以获取到对应的活跃数。也就是说服务提供者中的每一个方法的活跃数都是互相独立的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RpcStatus</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ConcurrentMap&lt;String, ConcurrentMap&lt;String, RpcStatus&gt;&gt; METHOD_STATISTICS =</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentHashMap</span>&lt;String, ConcurrentMap&lt;String, RpcStatus&gt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> RpcStatus <span class=\"title function_\">getStatus</span><span class=\"params\">(URL url, String methodName)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">uri</span> <span class=\"operator\">=</span> url.toIdentityString();</span><br><span class=\"line\">        ConcurrentMap&lt;String, RpcStatus&gt; map = METHOD_STATISTICS.computeIfAbsent(uri, k -&gt; <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentHashMap</span>&lt;&gt;());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> map.computeIfAbsent(methodName, k -&gt; <span class=\"keyword\">new</span> <span class=\"title class_\">RpcStatus</span>());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getActive</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> active.get();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"ConsistentHashLoadBalance\">ConsistentHashLoadBalance</h6>\n<ul>\n<li>ConsistentHashLoadBalance 即一致性 Hash 负载均衡策略。</li>\n<li>ConsistentHashLoadBalance 中没有权重的概念，具体是哪个服务提供者处理请求是由你的请求的参数决定的，也就是说相同参数的请求总是发到同一个服务提供者。</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051429658.png\" alt=\"image-20230505142957626\" style=\"zoom:33%;\">\n<p>Dubbo 为了避免数据倾斜问题（节点不够分散，大量请求落到同一节点），还引入了虚拟节点的概念。通过虚拟节点可以让节点更加分散，有效均衡各个节点的请求量。</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051430705.png\" alt=\"image-20230505143021673\" style=\"zoom:33%;\">\n<h6 id=\"RoundRobinLoadBalance\">RoundRobinLoadBalance</h6>\n<ul>\n<li>​\tRoundRobinLoadBalance 即加权轮询负载均衡。轮询就是把请求依次分配给每个服务提供者。加权轮询就是在轮询的基础上，让更多的请求落到权重更大的服务提供者上。比如假如有两个提供相同服务的服务器 S1,S2，S1 的权重为 7，S2 的权重为 3。</li>\n<li>如果有 10 次请求，那么 7 次会被 S1 处理，3 次被 S2 处理。但是，如果是 RandomLoadBalance 的话，很可能存在 10 次请求有 9 次都被 S1 处理的情况（概率性问题）。</li>\n</ul>\n<h3 id=\"配置\">配置</h3>\n<p>Dubbo 配置文件是如何加载到 Spring 中的？<br>\nSpring 容器在启动的时候，会读取到 Spring 默认的一些 schema 以及 Dubbo 自定义的 schema，每个 schema 都会对应一个自己的 NamespaceHandler，NamespaceHandler 里面通过 BeanDefinitionParser 来解析配置信息并转化为需要加载的 bean 对象！</p>\n<h5 id=\"核心的配置有哪些\">核心的配置有哪些</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051433185.png\" alt=\"image-20230505143300140\" style=\"zoom:33%;\">\n<h5 id=\"Dubbo-超时设置有哪些方式？\">Dubbo 超时设置有哪些方式？</h5>\n<ul>\n<li>服务提供者端设置超时时间，在 Dubbo 的用户文档中，推荐如果能在服务端多配置就尽量多配置，因为服务提供者比消费者更清楚自己提供的服务特性。</li>\n<li>服务消费者端设置超时时间，如果在消费者端设置了超时时间，以消费者端为主，即优先级更高。因为服务调用方设置超时时间控制性更灵活。如果消费方超时，服务端线程不会定制，会产生警告。</li>\n</ul>\n<h5 id=\"服务调用超时会怎么样？\">服务调用超时会怎么样？</h5>\n<p>dubbo 在调用服务不成功时，默认是会重试两次。</p>\n<h3 id=\"协议\">协议</h3>\n<h5 id=\"Dubbo-使用的是什么通信框架？\">Dubbo 使用的是什么通信框架？</h5>\n<p>默认使用 Netty 作为通讯框架。</p>\n<h5 id=\"Dubbo-支持哪些通信协议，它们的优缺点有哪些？\">Dubbo 支持哪些通信协议，它们的优缺点有哪些？</h5>\n<ul>\n<li>Dubbo： 单一长连接和 NIO 异步通讯，适合大并发小数据量的服务调用，以及消费者远大于提供者。传输协议 TCP，异步 Hessian 序列化。Dubbo 推荐使用 dubbo 协议。</li>\n<li>RMI： 采用 JDK 标准的 RMI 协议实现，传输参数和返回参数对象需要实现 Serializable 接口，使用 Java 标准序列化机制，使用阻塞式短连接，传输数据包大小混合，消费者和提供者个数差不多，可传文件，传输协议 TCP。 多个短连接 TCP 协议传输，同步传输，适用常规的远程服务调用和 RMI 互操作。在依赖低版本的 Common-Collections 包，Java 序列化存在安全漏洞。</li>\n<li>WebService：基于 WebService 的远程调用协议，集成 CXF 实现，提供和原生 WebService 的互操作。多个短连接，基于 HTTP 传输，同步传输，适用系统集成和跨语言调用。<br>\nHTTP： 基于 Http 表单提交的远程调用协议，使用 Spring 的 HttpInvoke 实现。多个短连接，传输协议 HTTP，传入参数大小混合，提供者个数多于消费者，需要给应用程序和浏览器 JS 调用。</li>\n<li>Hessian：集成 Hessian 服务，基于 HTTP 通讯，采用 Servlet 暴露服务，Dubbo 内嵌 Jetty 作为服务器时默认实现，提供与 Hession 服务互操作。多个短连接，同步 HTTP 传输，Hessian 序列化，传入参数较大，提供者大于消费者，提供者压力较大，可传文件。</li>\n<li>Memcache：基于 Memcache 实现的 RPC 协议。</li>\n<li>Redis：基于 Redis 实现的 RPC 协议。</li>\n</ul>\n<h5 id=\"Dubbo-支持哪些序列化方式呢？\">Dubbo 支持哪些序列化方式呢？</h5>\n<p>Dubbo 支持多种序列化方式：JDK 自带的序列化、hessian2、JSON、Kryo、FST、Protostuff，ProtoBuf 等等。</p>\n<p>Dubbo 默认使用的序列化方式是 hession2。</p>\n<h3 id=\"设计模式\">设计模式</h3>\n<h5 id=\"Dubbo-用到哪些设计模式？\">Dubbo 用到哪些设计模式？</h5>\n<p>Dubbo 框架在初始化和通信过程中使用了多种设计模式，可灵活控制类加载、权限控制等功能。</p>\n<h6 id=\"工厂模式\">工厂模式</h6>\n<p>Provider 在 export 服务时，会调用 ServiceConfig 的 export 方法。</p>\n<p>这也是一种工厂模式，只是实现类的获取采用了 JDK SPI 的机制。</p>\n<p>这么实现的优点是可扩展性强，想要扩展实现，只需要在 classpath 下增加个文件就可以了，代码零侵入。</p>\n<p>另外，像上面的 Adaptive 实现，可以做到调用时动态决定调用哪个实现，但是由于这种实现采用了动态代理，会造成代码调试比较麻烦，需要分析出实际调用的实现类。</p>\n<h6 id=\"装饰器模式\">装饰器模式</h6>\n<p>Dubbo 在启动和调用阶段都大量使用了装饰器模式。</p>\n<p>以 Provider 提供的调用链为例，具体的调用链代码是在 ProtocolFilterWrapper 的 buildInvokerChain 完成的，具体是将注解中含有 group=provider 的 Filter 实现，按照 order 排序，最后的调用顺序是：EchoFilter -&gt; ClassLoaderFilter -&gt; GenericFilter -&gt; ContextFilter -&gt;ExecuteLimitFilter -&gt; TraceFilter -&gt; TimeoutFilter -&gt; MonitorFilter -&gt;ExceptionFilter；更确切地说，这里是装饰器和责任链模式的混合使用。例如，EchoFilter 的作用是判断是否是回声测试请求，是的话直接返回内容，这是一种责任链的体现。</p>\n<p>而像 ClassLoaderFilter 则只是在主功能上添加了功能，更改当前线程的 ClassLoader，这是典型的装饰器模式。</p>\n<h6 id=\"观察者模式\">观察者模式</h6>\n<p>Dubbo 的 Provider 启动时，需要与注册中心交互，先注册自己的服务，再订阅自己的服务，订阅时，采用了观察者模式，开启一个 listener。</p>\n<p>注册中心会每 5 秒定时检查是否有服务更新，如果有更新，向该服务的提供者发送一个 notify 消息，provider 接受到 notify 消息后，运行 NotifyListener 的 notify 方法，执行监听器方法。</p>\n<h6 id=\"动态代理模式\">动态代理模式</h6>\n<p>Dubbo 扩展 JDK SPI 的类 ExtensionLoader 的 Adaptive 实现是典型的动态代理实现。Dubbo 需要灵活地控制实现类，即在调用阶段动态地根据参数决定调用哪个实现类，所以采用先生成代理类的方法，能够做到灵活的调用。生成代理类的代码是 ExtensionLoader 的 createAdaptiveExtensionClassCode 方法。代理类主要逻辑是，获取 URL 参数中指定参数的值作为获取实现类的 key。</p>\n<h3 id=\"运维管理\">运维管理</h3>\n<h6 id=\"服务上线怎么兼容旧版本？\">服务上线怎么兼容旧版本？</h6>\n<p>可以用版本号（version）过渡，多个不同版本的服务注册到注册中心，版本号不同的服务相互间不引用。这个和服务分组的概念有一点类似。</p>\n<h6 id=\"Dubbo-telnet-命令能做什么？\">Dubbo telnet 命令能做什么？</h6>\n<p>dubbo 服务发布之后，我们可以利用 telnet 命令进行调试、管理。Dubbo2.0.5 以上版本服务提供端口支持 telnet 命令。</p>\n<h6 id=\"Dubbo-支持服务降级吗？\">Dubbo 支持服务降级吗？</h6>\n<p>通过 dubbo:reference 中设置 mock=“return null”。mock 的值也可以修改为 true，然后再跟接口同一个路径下实现一个 Mock 类，命名规则是 “接口名称 + Mock” 后缀，然后在 Mock 类里实现自己的降级逻辑。</p>\n<h6 id=\"Dubbo-如何优雅停机？\">Dubbo 如何优雅停机？</h6>\n<p>Dubbo 是通过 JDK 的 ShutdownHook 来完成优雅 停机的，所以如果使用 kill -9 PID 等强制关闭指令，是不会执行优雅停机的，只有通过 kill PID 时，才会执行。</p>\n<h4 id=\"SPI\">SPI</h4>\n<h6 id=\"Dubbo-SPI-和-Java-SPI-区别？\">Dubbo SPI 和 Java SPI 区别？</h6>\n<ul>\n<li>\n<p>JDK SPI：JDK 标准的 SPI 会一次性加载所有的扩展实现，如果有的扩展很耗时，但也没用上，很浪费资源。所以只希望加载某个的实现，就不现实了。</p>\n</li>\n<li>\n<p>DUBBO SPI：对 Dubbo 进行扩展，不需要改动 Dubbo 的源码；延迟加载，可以一次只加载自己想要加载的扩展实现；增加了对扩展点 IOC 和 AOP 的支持，一个扩展点可以直接 setter 注入其它扩展点；Dubbo 的扩展机制能很好的支持第三方 IOC 容器，默认支持 Spring Bean。</p>\n</li>\n</ul>\n<h6 id=\"Dubbo-的-SPI-机制了解么？-如何扩展-Dubbo-中的默认实现？\">Dubbo 的 SPI 机制了解么？ 如何扩展 Dubbo 中的默认实现？</h6>\n<p>SPI（Service Provider Interface） 机制被大量用在开源项目中，它可以帮助我们动态寻找服务 / 功能（比如负载均衡策略）的实现。</p>\n<p>SPI 的具体原理是这样的：</p>\n<blockquote>\n<p>将接口的实现类放在配置文件中，我们在程序运行过程中读取配置文件，通过反射加载实现类。这样，可以在运行的时候，动态替换接口的实现类。和 IOC 的解耦思想是类似的。</p>\n</blockquote>\n<p>Java 本身就提供了 SPI 机制的实现。不过，Dubbo 没有直接用，而是对 Java 原生的 SPI 机制进行了增强，以便更好满足自己的需求。</p>\n<h6 id=\"如何扩展-Dubbo-中的默认实现呢？\">如何扩展 Dubbo 中的默认实现呢？</h6>\n<p>比如说我们想要实现自己的负载均衡策略，我们创建对应的实现类 XxxLoadBalance 实现 LoadBalance 接口或者 AbstractLoadBalance 类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.xxx;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.rpc.cluster.LoadBalance;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.rpc.Invoker;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.rpc.Invocation;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.rpc.RpcException; </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">XxxLoadBalance</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">LoadBalance</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; Invoker&lt;T&gt; <span class=\"title function_\">select</span><span class=\"params\">(List&lt;Invoker&lt;T&gt;&gt; invokers, Invocation invocation)</span> <span class=\"keyword\">throws</span> RpcException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>将这个是实现类的路径写入到 resources 目录下的 META-INF/dubbo/org.apache.dubbo.rpc.cluster.LoadBalance 文件中即可。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">src</span><br><span class=\"line\"> |-main</span><br><span class=\"line\">    |-java</span><br><span class=\"line\">        |-com</span><br><span class=\"line\">            |-xxx</span><br><span class=\"line\">                |-XxxLoadBalance.java (实现LoadBalance接口)</span><br><span class=\"line\">    |-resources</span><br><span class=\"line\">        |-META-INF</span><br><span class=\"line\">            |-dubbo</span><br><span class=\"line\">                |-org.apache.dubbo.rpc.cluster.LoadBalance (纯文本文件，内容为：xxx=com.xxx.XxxLoadBalance)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.apache.dubbo.rpc.cluster.LoadBalance</span><br><span class=\"line\">xxx=com.xxx.XxxLoadBalance</span><br></pre></td></tr></table></figure>\n<h3 id=\"其他\">其他</h3>\n<h6 id=\"Dubbo-支持分布式事务吗？\">Dubbo 支持分布式事务吗？</h6>\n<p>目前暂时不支持</p>\n<p>可与通过 tcc-transaction 框架实现，tcc-transaction 是开源的 TCC 补偿性分布式事务框架，TCC-Transaction 通过 Dubbo 隐式传参的功能，避免自己对业务代码的入侵。</p>\n<h6 id=\"Dubbo-可以对结果进行缓存吗？\">Dubbo 可以对结果进行缓存吗？</h6>\n<p>为了提高数据访问的速度，Dubbo 提供了声明式缓存，以减少用户加缓存的工作量 &lt;dubbo:reference cache=“true” /&gt;，其实比普通的配置文件就多了一个标签 cache=“true”。</p>\n<h6 id=\"Dubbo-支持哪些序列化方式？\">Dubbo 支持哪些序列化方式？</h6>\n<p>默认使用 Hessian 序列化，还有 Duddo、FastJson、Java 自带序列化。</p>\n<h6 id=\"Dubbo-在安全方面有哪些措施？\">Dubbo 在安全方面有哪些措施？</h6>\n<p>Dubbo 通过 Token 令牌防止用户绕过注册中心直连，然后在注册中心上管理授权。Dubbo 还提供服务黑白名单，来控制服务所允许的调用方。</p>\n<h6 id=\"服务调用是阻塞的吗？\">服务调用是阻塞的吗？</h6>\n<p>默认是阻塞的，可以异步调用，没有返回值的可以这么做。Dubbo 是基于 NIO 的非阻塞实现并行调用，客户端不需要启动多线程即可完成并行调用多个远程服务，相对多线程开销较小，异步调用会返回一个 Future 对象。</p>\n<h6 id=\"服务提供者能实现失效踢出是什么原理？\">服务提供者能实现失效踢出是什么原理？</h6>\n<p>服务失效踢出基于 zookeeper 的临时节点原理。</p>\n<h6 id=\"同一个服务多个注册的情况下可以直连某一个服务吗？\">同一个服务多个注册的情况下可以直连某一个服务吗？</h6>\n<p>可以点对点直连，修改配置即可，也可以通过 telnet 直接某个服务。</p>\n<h2 id=\"Dubbo-快速入门\">Dubbo 快速入门</h2>\n<ul>\n<li>Zookeeper安装\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85\">下载安装</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E9%85%8D%E7%BD%AE%E5%90%AF%E5%8A%A8\">配置启动</a></li>\n</ul>\n</li>\n<li>创建工程\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E9%85%8D%E7%BD%AEdubbo-web%E7%9A%84pom-xml\">配置dubbo-web的pom.xml</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E9%85%8D%E7%BD%AEdubbo-service%E7%9A%84pom-xml\">配置dubbo-service的pom.xml</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E9%85%8D%E7%BD%AElog4j-properties\">配置log4j.properties</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E5%88%9B%E5%BB%BAdubbo-web%E7%9A%84service%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%8F%8A%E5%AE%9E%E7%8E%B0%E7%B1%BB\">创建dubbo-web的Service的接口及实现类</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E9%85%8D%E7%BD%AEdubbo-web%E7%9A%84spring%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\">配置dubbo-web的spring核心配置文件</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E9%85%8D%E7%BD%AEdubbo-service%E7%9A%84web-xml\">配置dubbo-service的web.xml</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E5%88%9B%E5%BB%BAdubbo-web%E7%9A%84controller\">创建dubbo-web的Controller</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E9%85%8D%E7%BD%AEdubbo-service%E7%9A%84springmvc%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\">配置dubbo-service的springmvc配置文件</a></li>\n</ul>\n</li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E6%B5%8B%E8%AF%95\">测试</a></li>\n<li>Dubbo 引入\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85\">服务提供者</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E4%BF%AE%E6%94%B9userserviceimpl-java\">修改UserServiceImpl.java</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E4%BF%AE%E6%94%B9dubbo-server%E7%9A%84application-xml\">修改dubbo-server的application.xml</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E4%BF%AE%E6%94%B9dubbo-server%E7%9A%84web-xml\">修改dubbo-server的web.xml</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85\">服务消费者</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E4%BF%AE%E6%94%B9dubbo-web%E7%9A%84%E6%8E%A7%E5%88%B6%E5%99%A8\">修改dubbo-web的控制器</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E4%BF%AE%E6%94%B9dubbo-web%E9%A1%B9%E7%9B%AE%E7%9A%84springmvc-xml\">修改dubbo-web项目的springmvc.xml</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97dubbo-interface\">添加模块dubbo-interface</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Geting_start/#test\">Test</a></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Zookeeper安装\">Zookeeper安装</h3>\n<ul>\n<li>Dubbo官方推荐使用Zookeeper作为注册中心</li>\n</ul>\n<h4 id=\"下载安装\">下载安装</h4>\n<p>ZooKeeper服务器是用Java创建的，它运行在JVM之上。需要安装JDK 7或更高版本。</p>\n<ul>\n<li><a href=\"https://zookeeper.apache.org/releases.html\">https://zookeeper.apache.org/releases.html</a></li>\n<li>将下载的ZooKeeper放到/opt/ZooKeeper目录下</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /ryang/zookeeper</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用XFTP工具将压缩包传输到Linux系统</li>\n</ul>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030119050.webp\" alt></p>\n<ul>\n<li>将tar包解压到/opt/zookeeper目录下</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /ryang/zookeeper</span><br><span class=\"line\">tar -zxvf apache-zookeeper-3.5.9-bin.tar.gz -C /opt/zookeeper</span><br></pre></td></tr></table></figure>\n<h4 id=\"配置启动\">配置启动</h4>\n<h4 id=\"配置zoo-cfg\">配置zoo.cfg</h4>\n<p>进入到conf目录拷贝一个zoo_sample.cfg并完成配置</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /ryang/zookeeper/zookeeper-3.5.9/conf &amp;&amp; <span class=\"built_in\">ls</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>创建zk存储目录</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /ryang/zookeeper</span><br></pre></td></tr></table></figure>\n<ul>\n<li>修改zoo.cfg</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#修改zoo.cfg</span></span><br><span class=\"line\">vim /ryang/zookeeper/zookeeper-3.5.9/conf/zoo.cfg</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030119762.webp\" alt></p>\n<p>修改存储目录：dataDir=/opt/zookeeper/zkdata</p>\n<h4 id=\"启动ZooKeeper\">启动ZooKeeper</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /ryang/zookeeper/zookeeper-3.5.9/bin</span><br><span class=\"line\"><span class=\"comment\">#启动</span></span><br><span class=\"line\"> ./zkServer.sh  start</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master bin]<span class=\"comment\"># ./zkServer.sh start</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /opt/zookeeper/apache-zookeeper-3.5.6-bin/bin/../conf/zoo.cfg</span><br><span class=\"line\">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>STARTED表示zk启动成功</p>\n</blockquote>\n<h4 id=\"查看ZooKeeper状态\">查看ZooKeeper状态</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./zkServer.sh status</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master bin]<span class=\"comment\"># ./zkServer.sh status</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /opt/zookeeper/apache-zookeeper-3.5.6-bin/bin/../conf/zoo.cfg</span><br><span class=\"line\">Client port found: 2181. Client address: localhost.</span><br><span class=\"line\">Mode: standalone</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>zookeeper启动成功。standalone代表zk没有搭建集群，现在是单节点</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master bin]<span class=\"comment\"># ./zkServer.sh status</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /opt/zookeeper/apache-zookeeper-3.5.6-bin/bin/../conf/zoo.cfg</span><br><span class=\"line\">Client port found: 2181. Client address: localhost.</span><br><span class=\"line\">Error contacting service. It is probably not running.</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>(not running),zookeeper没有启动</p>\n</blockquote>\n<ul>\n<li>关闭ZooKeeper</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./zkServer.sh stop</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建工程\">创建工程</h3>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305030119590.webp\" alt=\"image\" style=\"zoom:33%;\">\n<h4 id=\"配置dubbo-web的pom-xml\">配置dubbo-web的pom.xml</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.frx01<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>5.1.9.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dubbo.version</span>&gt;</span>2.7.4.1<span class=\"tag\">&lt;/<span class=\"name\">dubbo.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">zookeeper.version</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">zookeeper.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">maven.compiler.source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.source</span>&gt;</span></span><br><span class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">maven.compiler.target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.target</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- servlet3.0规范的坐标 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--spring的坐标--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--springmvc的坐标--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--日志--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--Dubbo的起步依赖，版本2.7之后统一为rg.apache.dubb --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;zookeeper.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-recipes<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;zookeeper.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--依赖service模块--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.frx01<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-service<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--tomcat插件--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.tomcat.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>8000<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"配置dubbo-service的pom-xml\">配置dubbo-service的pom.xml</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.frx01<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-service<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>5.1.9.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dubbo.version</span>&gt;</span>2.7.4.1<span class=\"tag\">&lt;/<span class=\"name\">dubbo.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">zookeeper.version</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">zookeeper.version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- servlet3.0规范的坐标 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--spring的坐标--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--springmvc的坐标--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--日志--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--Dubbo的起步依赖，版本2.7之后统一为rg.apache.dubb --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;zookeeper.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-recipes<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;zookeeper.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"配置log4j-properties\">配置log4j.properties</h4>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span></span><br><span class=\"line\"><span class=\"comment\"># Global logging configuration</span></span><br><span class=\"line\"><span class=\"attr\">log4j.rootLogger</span>=<span class=\"string\">info, stdout,file</span></span><br><span class=\"line\"><span class=\"comment\"># My logging configuration...</span></span><br><span class=\"line\"><span class=\"comment\">#log4j.logger.com.tocersoft.school=DEBUG</span></span><br><span class=\"line\"><span class=\"comment\">#log4j.logger.net.sf.hibernate.cache=debug</span></span><br><span class=\"line\"><span class=\"comment\">## Console output...</span></span><br><span class=\"line\"><span class=\"attr\">log4j.appender.stdout</span>=<span class=\"string\">org.apache.log4j.ConsoleAppender</span></span><br><span class=\"line\"><span class=\"attr\">log4j.appender.stdout.layout</span>=<span class=\"string\">org.apache.log4j.PatternLayout</span></span><br><span class=\"line\"><span class=\"attr\">log4j.appender.stdout.layout.ConversionPattern</span>=<span class=\"string\">%5p %d %C: %m%n</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">log4j.appender.file</span>=<span class=\"string\">org.apache.log4j.FileAppender</span></span><br><span class=\"line\"><span class=\"attr\">log4j.appender.file.File</span>=<span class=\"string\">../logs/iask.log</span></span><br><span class=\"line\"><span class=\"attr\">log4j.appender.file.layout</span>=<span class=\"string\">org.apache.log4j.PatternLayout</span></span><br><span class=\"line\"><span class=\"attr\">log4j.appender.file.layout.ConversionPattern</span>=<span class=\"string\">%d&#123;yyyy-MM-dd HH:mm:ss&#125;  %l  %m%n</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"创建dubbo-web的Service的接口及实现类\">创建dubbo-web的Service的接口及实现类</h4>\n<ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>实现类</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello,dubbo~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 注意：@Service注解 是 Dubbo包提供的</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"配置dubbo-web的spring核心配置文件\">配置dubbo-web的spring核心配置文件</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t   <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t   <span class=\"attr\">xmlns:dubbo</span>=<span class=\"string\">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span> <span class=\"attr\">xmlns:context</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t   <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">        http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">&quot;com.frx01.service&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"配置dubbo-service的web-xml\">配置dubbo-service的web.xml</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">version</span>=<span class=\"string\">&quot;2.5&quot;</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- spring --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath*:spring/applicationContext*.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></span><br><span class=\"line\">\t\t </span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- Springmvc --&gt;</span>\t </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springmvc<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:spring/springmvc.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springmvc<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>*.do<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"创建dubbo-web的Controller\">创建dubbo-web的Controller</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"配置dubbo-service的springmvc配置文件\">配置dubbo-service的springmvc配置文件</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:dubbo</span>=<span class=\"string\">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">         http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">&quot;com.frx01.controller&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"测试\">测试</h4>\n<ul>\n<li>因为dubbo-service被dubbo-web所依赖，我们需要先<code>install</code>dubbo-service这个项目。</li>\n<li>启动dubbo-web</li>\n<li>结果</li>\n</ul>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031209843.png\" alt></p>\n<blockquote>\n<p>目前此项目，仍然是==单体项目== 并==不是分布式的==</p>\n<p>分布式说的是两个项目要是能够==单独的启动和运行==</p>\n<p>进行修改思路：</p>\n<ul>\n<li>web 模块的 jar 改为  war</li>\n<li>Service  模块引入  tomcat7的插件</li>\n<li>Service  模块引入  zookeeper的依赖</li>\n<li>Service  模块代码修改</li>\n</ul>\n</blockquote>\n<h4 id=\"Dubbo-引入\">Dubbo 引入</h4>\n<p><img src=\"https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220809/image.1m14kr1438qo.webp\" alt></p>\n<h4 id=\"服务提供者\">服务提供者</h4>\n<blockquote>\n<p>在dubbo-service的pom.xml文件中引入tomcat插件，并修改打包方式为war</p>\n</blockquote>\n<h4 id=\"修改UserServiceImpl-java\">修改UserServiceImpl.java</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.frx01.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.frx01.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.config.annotation.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span><span class=\"comment\">//将这这类提供的方法(服务)对外发布，将访问的地址,ip,端口,路径注册到注册中心中</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello,dubbo~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"修改dubbo-server的application-xml\">修改dubbo-server的application.xml</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t   <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t   <span class=\"attr\">xmlns:dubbo</span>=<span class=\"string\">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span> <span class=\"attr\">xmlns:context</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">\t   <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">        http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--&lt;context:component-scan base-package=&quot;com.frx01.service&quot;/&gt;    Spring 的包扫描--&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!--dubbo的配置--&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--1.项目的名称--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dubbo-service&quot;</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--2.配置一下注册中心的地址--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://192.168.91.200:2181&quot;</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--3.配置dubbo包扫描--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dubbo:annotation</span> <span class=\"attr\">package</span>=<span class=\"string\">&quot;com.frx01.service.impl&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"修改dubbo-server的web-xml\">修改dubbo-server的web.xml</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">version</span>=<span class=\"string\">&quot;2.5&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- spring --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath*:spring/applicationContext*.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 删去springmvc的配置 --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"服务消费者（dubbo-web）\">服务消费者（dubbo-web）</h4>\n<blockquote>\n<ul>\n<li>\n<p>注释掉<code>dubbo-web</code>的<code>pom.xml</code>的<code>dubbo-service</code>模块依赖</p>\n</li>\n<li>\n<p>删除web.xml的spring配置</p>\n</li>\n<li>\n<p>创建一份 和  <code>dubbo-service</code> 中一样的<code>Userservice</code>接口(简单做法)</p>\n<p>（正规做法） 实现接口   共用一份<code>Userservice</code></p>\n</li>\n</ul>\n</blockquote>\n<h4 id=\"修改dubbo-web的控制器\">修改dubbo-web的控制器</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.frx01.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.config.annotation.Reference;   </span><br><span class=\"line\"><span class=\"comment\">//注意： @Reference注解 是 Dubbo包提供的</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> frx</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@version</span> 1.0</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022/8/9  17:45</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.从zookeeper注册中心获取userService的访问url</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.远程的调用RPC</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.将结果封装为一个代理的对象，给变量赋值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Reference</span> <span class=\"comment\">//远程注入   上面的细节不用关心  只要调用注解就可以了</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"修改dubbo-web项目的springmvc-xml\">修改dubbo-web项目的springmvc.xml</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:dubbo</span>=<span class=\"string\">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">         http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">&quot;com.frx01.controller&quot;</span>/&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!--dubbo的配置--&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--1.项目的名称--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dubbo-web&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--2.配置一下注册中心的地址--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://172.16.108.135:2181&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--3.配置dubbo包扫描--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:annotation</span> <span class=\"attr\">package</span>=<span class=\"string\">&quot;com.frx01.controller&quot;</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>本地运行可能会有 端口冲突  可以进行修改</p>\n<p>任意一个模块中spring下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;<span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dubbo-web&quot;</span>&gt;</span></span><br><span class=\"line\">&gt;<span class=\"tag\">&lt;<span class=\"name\">dubbo:parameter</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;qos.port&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;33333&quot;</span>/&gt;</span></span><br><span class=\"line\">&gt;<span class=\"tag\">&lt;/<span class=\"name\">dubbo:application</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</blockquote>\n<h3 id=\"添加模块dubbo-interface\">添加模块dubbo-interface</h3>\n<ul>\n<li>将UserService接口抽取出来放入dubbo-interface模块</li>\n<li>在dubbo-service和dubbo-web模块中引入dubbo-interface模块</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.frx01<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-interface<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>将多个模块 公用的接口     抽象到 intrfacee 模块中   实现复用  与  共用</p>\n</blockquote>\n<h4 id=\"Test\">Test</h4>\n<ul>\n<li>将dubbo-interface模块进行<code>install</code></li>\n<li>启动dubbo-service</li>\n</ul>\n<h2 id=\"Dubbo-高级特性\">Dubbo 高级特性</h2>\n<ul>\n<li>dubbo-admin\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#dubbo-admin-%E5%AE%89%E8%A3%85\">dubbo-admin 安装</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E8%AE%BF%E9%97%AE%E6%B5%8B%E8%AF%95\">访问测试</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#dubbo-admin%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8\">dubbo-admin简单使用</a></li>\n</ul>\n</li>\n<li>dubbo 常用高级配置\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E5%BA%8F%E5%88%97%E5%8C%96\">序列化</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E6%B5%8B%E8%AF%95\">测试</a></li>\n</ul>\n</li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E5%9C%B0%E5%9D%80%E7%BC%93%E5%AD%98\">地址缓存</a></li>\n<li>超时与重试\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9userserviceimpl\">修改UserServiceImpl</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9usercontroller\">修改UserController</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E9%87%8D%E8%AF%95\">重试</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9userserviceimpl\">修改UserServiceImpl</a></li>\n</ul>\n</li>\n<li>多版本\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9userserviceimpl\">修改UserServiceImpl</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E6%96%B0%E5%A2%9Euserserviceimpl2\">新增UserServiceImpl2</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9usercontroller\">修改UserController</a></li>\n</ul>\n</li>\n<li>负载均衡\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9userserviceimpl\">修改UserServiceImpl</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E5%90%AF%E5%8A%A8%E7%AC%AC%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8\">启动第一台机器</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9userserviceimpl\">修改UserServiceImpl</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9applicationcontext-xml\">修改applicationContext.xml</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E5%90%AF%E5%8A%A8%E7%AC%AC%E4%BA%8C%E5%8F%B0%E6%9C%BA%E5%99%A8\">启动第二台机器</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9usercontroller\">修改UserController</a></li>\n</ul>\n</li>\n<li>集群容错\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E7%AC%AC%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8\">第一台机器</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E7%AC%AC%E4%BA%8C%E5%8F%B0%E6%9C%BA%E5%99%A8\">第二台机器</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E7%AC%AC%E4%B8%89%E5%8F%B0%E6%9C%BA%E5%99%A8\">第三台机器</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BD%BF%E7%94%A8dubbo-admin%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1\">使用dubbo-admin查看服务</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E8%AE%BE%E7%BD%AE%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99%E7%AD%96%E7%95%A5\">设置集群容错策略</a></li>\n</ul>\n</li>\n<li>服务降级\n<ul>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E5%90%AF%E5%8A%A8dubbo-service\">启动dubbo-service</a></li>\n<li><a href=\"https://frxcat.fun/middleware/Dubbo/Dubbo_Advanced_features/#%E4%BF%AE%E6%94%B9userserviceimpl\">修改UserServiceImpl</a></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"dubbo-admin\">dubbo-admin</h3>\n<ul>\n<li>dubbo-admin管理平台，是图形化的服务管理页面</li>\n<li>从注册中心中获取到所有的提供者 / 消费者进行配置管理</li>\n<li>路由规则、动态配置、服务降级、访问控制、权重调整、负载均衡等管理功能</li>\n<li>dubbo-admin 是一个前后端分离的项目。前端使用vue，后端使用springboot</li>\n<li>安装dubbo-admin 其实就是部署该项目</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309335.webp\" alt=\"image\" style=\"zoom:33%;\">\n<h4 id=\"dubbo-admin-安装\">dubbo-admin 安装</h4>\n<p><strong>环境准备</strong></p>\n<p>dubbo-admin 是一个前后端分离的项目。前端使用vue，后端使用springboot，安装 dubbo-admin 其实就是部署该项目。我们将dubbo-admin安装到开发环境上。要保证开发环境有jdk，maven，node.js</p>\n<p>安装node**(如果当前机器已经安装请忽略)**</p>\n<p>因为前端工程是用vue开发的，所以需要安装node.js，node.js中自带了npm，后面我们会通过npm启动</p>\n<ul>\n<li><a href=\"https://nodejs.org/en/\">下载地址(opens new window)</a></li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309793.webp\" alt=\"image\" style=\"zoom:33%;\">\n<p><strong>下载 Dubbo-Admin</strong></p>\n<p>进入github，搜索dubbo-admin</p>\n<ul>\n<li><a href=\"https://github.com/apache/dubbo-admin\">https://github.com/apache/dubbo-admin</a></li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031311078.png\" alt=\"image-20230503131142005\" style=\"zoom:33%;\">\n<ul>\n<li>可以通过下载ZIP包的方式。如果安装的有git,也可以使用git命令</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> git@github.com:apache/dubbo-admin.git</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>把下载的zip包解压到指定文件夹(解压到那个文件夹随意)</p>\n</li>\n<li>\n<p>修改配置文件,解压后我们进入…\\dubbo-admin-develop\\dubbo-admin-server\\src\\main\\resources目录</p>\n<p>找到 <strong>application.properties</strong> 配置文件 进行配置修改</p>\n</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031316486.png\" alt=\"image-20230503131645436\" style=\"zoom: 25%;\">\n<ul>\n<li>修改zookeeper地址</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031315654.png\" alt=\"image-20230503131537601\" style=\"zoom:25%;\">\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># centers in dubbo2.7</span></span><br><span class=\"line\"><span class=\"attr\">admin.registry.address</span>=<span class=\"string\">zookeeper://172.16.108.135:2181</span></span><br><span class=\"line\"><span class=\"attr\">admin.config-center</span>=<span class=\"string\">zookeeper://172.16.108.135:2181</span></span><br><span class=\"line\"><span class=\"attr\">admin.metadata-report.address</span>=<span class=\"string\">zookeeper://172.16.108.135:2181</span></span><br></pre></td></tr></table></figure>\n<p>admin.registry.address注册中心 admin.config-center 配置中心 admin.metadata-report.address元数据中心</p>\n<ul>\n<li>打包项目</li>\n</ul>\n<p>在 dubbo-admin-develop 目录执行打包命令</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn  clean package</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309519.webp\" alt></p>\n<ul>\n<li>启动后端</li>\n</ul>\n<p>切换到目录</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dubbo-Admin-develop\\dubbo-admin-distribution\\target&gt;</span><br></pre></td></tr></table></figure>\n<p>执行下面的命令启动 dubbo-admin，dubbo-admin后台由SpringBoot构建。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -jar .\\dubbo-admin-0.1.jar</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309191.webp\" alt></p>\n<p><strong>前台后端</strong></p>\n<p>dubbo-admin-ui 目录下执行命令</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031322051.png\" alt=\"image-20230503132221995\" style=\"zoom:33%;\">\n<h4 id=\"访问测试\">访问测试</h4>\n<ul>\n<li><a href=\"http://localhost:8081/\">http://localhost:8081/</a></li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031322785.png\" alt=\"image-20230503132229635\" style=\"zoom:33%;\">\n<h3 id=\"dubbo-admin简单使用\">dubbo-admin简单使用</h3>\n<p>注意:Dubbo Admin【服务Mock】【服务统计】将在后续版本发布…</p>\n<p>在上面的步骤中，我们已经进入了Dubbo-Admin的主界面，在【快速入门】章节中，我们定义了服务生产者、和服务消费者，下面我们从Dubbo-Admin管理界面找到这个两个服务</p>\n<h4 id=\"点击服务查询\">点击服务查询</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309058.webp\" alt=\"image\" style=\"zoom:33%;\">\n<h4 id=\"查看详情\">查看详情</h4>\n<p>我们查看<code>com.frx01.service.UserService </code>（服务提供者）的具体详细信息，包含【元数据信息】</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309310.webp\" alt=\"image\" style=\"zoom:33%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031327076.png\" alt=\"image-20230503132724024\" style=\"zoom:33%;\">\n<p>从【详情】界面查看，主要分为3个区域</p>\n<p>A区域：主要包含服务端 基础信息比如服务名称、应用名称等</p>\n<p>B区域：主要包含了生产者、消费者一些基本信息</p>\n<p><strong>C区域：是元数据信息，注意看上面的图,元数据信息是空的</strong></p>\n<blockquote>\n<p>我们需要打开我们的生产者配置文件加入下面配置</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 元数据配置 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:metadata-report</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://192.168.91.200:2181&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"服务测试\">服务测试</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309272.webp\" alt=\"image\" style=\"zoom:33%;\">\n<h3 id=\"dubbo-常用高级配置\">dubbo 常用高级配置</h3>\n<h4 id=\"序列化\">序列化</h4>\n<p><strong>两个机器传输数据，如何传输Java对象?</strong></p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031331821.png\" alt=\"image-20230503133104747\" style=\"zoom:33%;\">\n<ul>\n<li>\n<p>dubbo 内部已经将序列化和反序列化的过程内部封装了</p>\n</li>\n<li>\n<p>我们只需要在定义pojo类时实现Serializable接口即可</p>\n</li>\n<li>\n<p>一般会定义一个公共的pojo模块，让生产者和消费者都依赖该模块。</p>\n</li>\n</ul>\n<h5 id=\"新建dubbo-pojo模块\">新建dubbo-pojo模块</h5>\n<ul>\n<li>创建User类</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//注意：将来所有的pojo都需要实现Serializable接口</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> id;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\">\t<span class=\"comment\">//+set()与get()方法，和AllArgsConstructor</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"在模块dubbo-interface中添加dubbo-pojo模块的依赖\">在模块dubbo-interface中添加dubbo-pojo模块的依赖</h5>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.frx01<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-pojo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>在dubbo-interface模块中添加方法</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//查询用户</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在dubbo-service模块中重写方法</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">    <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"测试-2\">测试</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.从zookeeper注册中心获取userService的访问url</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.远程的调用RPC</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.将结果封装为一个代理的对象，给变量赋值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Reference</span> <span class=\"comment\">//远程注入   上面的细节不用关心  只要调用注解就可以了</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//根据 id 查询</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/find&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">find</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.findUserById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>访问<a href=\"http://localhost:8000/user/find.do?id=1\">http://localhost:8000/user/find.do?id=1</a></li>\n</ul>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309859.webp\" alt></p>\n<h4 id=\"地址缓存\">地址缓存</h4>\n<blockquote>\n<p><strong>注册中心挂了，服务是否可以正常访问？</strong></p>\n</blockquote>\n<ul>\n<li>可以，因为dubbo服务消费者在第一次调用时，会将服务提供方地址缓存到本地，以后在调用则不会访问注册中心。</li>\n<li>当服务提供者地址发生变化时，注册中心会通知服务消费者。</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031309335.webp\" alt=\"image\" style=\"zoom: 50%;\">\n<h4 id=\"超时与重试\">超时与重试</h4>\n<ul>\n<li>正常情况</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031337046.png\" style=\"zoom:33%;\">\n<ul>\n<li>\n<p>异常情况</p>\n</li>\n<li>\n<p>服务消费者在调用服务提供者的时候发生了阻塞、等待的情形，这个时候，服务消费者会一直等待下去。</p>\n</li>\n<li>\n<p>在某个峰值时刻，大量的请求都在同时请求服务消费者，会造成线程的大量堆积，势必会造成雪崩。</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031337202.png\" alt=\"image-20230503133751134\" style=\"zoom:33%;\">\n</li>\n<li>\n<p>dubbo 利用超时机制来解决这个问题，设置一个超时时间，在这个时间段内，无法完成服务访问，则自动断开连接。</p>\n</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031338670.png\" alt=\"image-20230503133809620\" style=\"zoom:33%;\">\n<ul>\n<li>使用timeout属性配置超时时间，<code>默认值1000</code>，单位毫秒。</li>\n</ul>\n<h5 id=\"修改UserServiceImpl-提供方dubbo-service\">修改UserServiceImpl(提供方<code>dubbo-service</code>)</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//将这这类提供的方法(服务)对外发布，将访问的地址,ip,端口,路径注册到注册中心中</span></span><br><span class=\"line\"><span class=\"meta\">@Service(timeout = 3000,retries = 0)</span><span class=\"comment\">//当前服务3秒超时   retries 重新测试次数 </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello,dubbo~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//假如数据库查询很慢，查了5秒</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">5000</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>测试，报超时异常</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.apache.dubbo.remoting.TimeoutException: Waiting server-side response timeout by scan timer. start time: <span class=\"number\">2022</span>-08-<span class=\"number\">11</span> <span class=\"number\">00</span>:<span class=\"number\">18</span>:<span class=\"number\">54.577</span>, end time: <span class=\"number\">2022</span>-08-<span class=\"number\">11</span> <span class=\"number\">00</span>:<span class=\"number\">18</span>:<span class=\"number\">57.606</span>, client elapsed: <span class=\"number\">0</span> ms, server elapsed: <span class=\"number\">3029</span> ms, timeout: <span class=\"number\">3000</span> ms, request: Request [id=<span class=\"number\">2</span>, version=<span class=\"number\">2.0</span><span class=\"number\">.2</span>, twoway=<span class=\"literal\">true</span>, event=<span class=\"literal\">false</span>, broken=<span class=\"literal\">false</span>, data=RpcInvocation [methodName=findUserById, parameterTypes=[<span class=\"type\">int</span>], arguments=[<span class=\"number\">1</span>], attachments=&#123;path=com.frx01.service.UserService, remote.application=dubbo-web, interface=com.frx01.service.UserService, version=<span class=\"number\">0.0</span><span class=\"number\">.0</span>, timeout=<span class=\"number\">3000</span>&#125;]], channel: /<span class=\"number\">10.19</span><span class=\"number\">.242</span><span class=\"number\">.91</span>:<span class=\"number\">56864</span> -&gt; /<span class=\"number\">10.19</span><span class=\"number\">.242</span><span class=\"number\">.91</span>:<span class=\"number\">20880</span></span><br><span class=\"line\">    </span><br><span class=\"line\">\tat org.apache.dubbo.remoting.exchange.support.DefaultFuture.doReceived(DefaultFuture.java:<span class=\"number\">189</span>)</span><br><span class=\"line\">\tat org.apache.dubbo.remoting.exchange.support.DefaultFuture.received(DefaultFuture.java:<span class=\"number\">153</span>)</span><br><span class=\"line\">\tat org.apache.dubbo.remoting.exchange.support.DefaultFuture$TimeoutCheckTask.run(DefaultFuture.java:<span class=\"number\">258</span>)</span><br><span class=\"line\">\tat org.apache.dubbo.common.timer.HashedWheelTimer$HashedWheelTimeout.expire(HashedWheelTimer.java:<span class=\"number\">648</span>)</span><br><span class=\"line\">\tat org.apache.dubbo.common.timer.HashedWheelTimer$HashedWheelBucket.expireTimeouts(HashedWheelTimer.java:<span class=\"number\">727</span>)</span><br><span class=\"line\">\tat org.apache.dubbo.common.timer.HashedWheelTimer$Worker.run(HashedWheelTimer.java:<span class=\"number\">449</span>)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:<span class=\"number\">748</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>注意</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Reference</span><span class=\"comment\">//远程注入，也有超时属性</span></span><br><span class=\"line\"><span class=\"meta\">@Reference(timeout = 1)</span> <span class=\"comment\">//远程注入</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"修改UserController-消费者dubbo-web\">修改UserController(消费者<code>dubbo-web</code>)</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.从zookeeper注册中心获取userService的访问url</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.远程的调用RPC</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.将结果封装为代理的对象，给变量赋值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Reference(timeout = 1000)</span> <span class=\"comment\">//远程注入，当前服务一秒超时</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据id查询用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">id</span> <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/find&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Runnable</span>()&#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">            \t<span class=\"keyword\">while</span> (<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">            \t\tSystem.out.println(i++);</span><br><span class=\"line\">            \t\t<span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            \t\t\tThread.sLeep(millis:<span class=\"number\">1000</span>);</span><br><span class=\"line\">                    &#125;<span class=\"keyword\">catch</span> (InterruptedException e)&#123;</span><br><span class=\"line\">            \t\t\te.printstackTrace();</span><br><span class=\"line\">            \t\t&#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).start();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.findUserById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>问题</p>\n<p>刷新</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031344278.png\" alt=\"image-20230503134418214\" style=\"zoom:25%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031344090.png\" alt=\"image-20230503134441929\" style=\"zoom:33%;\">\n<ul>\n<li>可以发现，出现了个问题，究竟是<code>@Service</code>注解超时3秒生效，还是@Reference注解超时1秒生效。    —答： <code>是超时 1秒生效</code></li>\n</ul>\n<blockquote>\n<p>经过测试，服务<code>提供方(UserService/UserServiceImpl)</code>的超时时间覆盖了消费方(<code>UserController</code>)的超时时间，</p>\n<p>但是超时时间在服务的生产方或者消费方单独地都生效</p>\n<p>所以建议把超时时间配置在服务的<code>提供方</code></p>\n</blockquote>\n<h5 id=\"重试\">重试</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031349365.png\" alt=\"image-20230503134934315\" style=\"zoom:33%;\">\n<ul>\n<li>设置了超时时间，在这个时间段内，无法完成服务访问，则自动断开连接。</li>\n<li>如果出现网络抖动，则这一次请求就会失败。</li>\n<li>Dubbo 提供重试机制来避免类似问题的发生。</li>\n<li>通过 retries 属性来设置重试次数。<code>默认为 2 次</code>。</li>\n</ul>\n<h5 id=\"修改UserServiceImpl-提供方dubbo-service-2\">修改UserServiceImpl(提供方<code>dubbo-service</code>)</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//将这这类提供的方法(服务)对外发布，将访问的地址,ip,端口,路径注册到注册中心中</span></span><br><span class=\"line\"><span class=\"meta\">@Service(timeout = 3,retries = 2)</span><span class=\"comment\">//当前服务3秒超时,重试两次，一共三次</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello,dubbo~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;服务被调用了:&quot;</span>+i+++<span class=\"string\">&quot;次&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//假如数据库查询很慢，查了5秒</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">5000</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>测试后报错</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031350601.png\" alt=\"image-20230503135042549\" style=\"zoom:33%;\">\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">服务被调用了:<span class=\"number\">1</span></span><br><span class=\"line\">服务被调用了:<span class=\"number\">2</span></span><br><span class=\"line\">服务被调用了:<span class=\"number\">3</span></span><br><span class=\"line\"> WARN <span class=\"number\">2022</span>-08-<span class=\"number\">11</span> <span class=\"number\">00</span>:<span class=\"number\">20</span>:<span class=\"number\">22</span>,<span class=\"number\">923</span> org.apache.dubbo.rpc.filter.TimeoutFilter$TimeoutListener:  [DUBBO] invoke time out. method: findUserById arguments: [<span class=\"number\">1</span>] , url is dubbo:<span class=\"comment\">//10.19.242.91:20880/com.frx01.service.UserService?anyhost=true&amp;application=dubbo-service&amp;bean.name=ServiceBean:com.frx01.service.UserService&amp;bind.ip=10.19.242.91&amp;bind.port=20880&amp;deprecated=false&amp;dubbo=2.0.2&amp;dynamic=true&amp;generic=false&amp;interface=com.frx01.service.UserService&amp;methods=sayHello,findUserById&amp;pid=22460&amp;release=2.7.4.1&amp;revision=1.0-SNAPSHOT&amp;side=provider&amp;timeout=3000&amp;timestamp=1660148406833, invoke elapsed 5009 ms., dubbo version: 2.7.4.1, current host: 10.19.242.91</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"多版本\">多版本</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031310280.webp\" alt=\"image\" style=\"zoom: 50%;\">\n<ul>\n<li>灰度发布：当出现新功能时，会让一部分用户先使用新功能，用户反馈没问题时，再将所有用户迁移到新功能。</li>\n<li>dubbo 中使用version 属性来设置和调用同一个接口的不同版本</li>\n</ul>\n<h5 id=\"修改UserServiceImpl-提供方dubbo-service-3\">修改UserServiceImpl(提供方<code>dubbo-service</code>)</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service(version = &quot;v1.0&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello,dubbo~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;old...&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"新增UserServiceImpl2-提供方dubbo-service\">新增UserServiceImpl2(提供方<code>dubbo-service</code>)</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service(version = &quot;v2.0&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl2</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello,dubbo~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;new...&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"修改UserController-消费者dubbo-web-2\">修改UserController(消费者<code>dubbo-web</code>)</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.从zookeeper注册中心获取userService的访问url</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.远程的调用RPC</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.将结果封装为代理的对象，给变量赋值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Reference(version = &quot;v1.0&quot;)</span> <span class=\"comment\">//远程注入</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据id查询用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/find&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.findUserById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"测试结果\">测试结果</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">old...</span><br></pre></td></tr></table></figure>\n<ul>\n<li>将<code>@Reference的version属性修改为v2.0</code>，<code>dubbo-web(消费方)</code>重新启动，测试</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">new...</span><br></pre></td></tr></table></figure>\n<h4 id=\"负载均衡\">负载均衡</h4>\n<ul>\n<li>\n<p>Random ：按权重随机，默认值。按权重设置随机概率</p>\n</li>\n<li>\n<p>RoundRobin ：按权重轮询（上面的轮询方式就是 <code>   1 2 3 2</code>）</p>\n</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031441164.png\" alt=\"image-20230503144128095\" style=\"zoom:33%;\">\n<ul>\n<li>\n<p>LeastActive：最少活跃调用数，相同活跃数的随机</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031310376.webp\" alt=\"image\" style=\"zoom: 50%;\">\n</li>\n<li>\n<p>ConsistentHash：一致性 Hash，相同参数的请求总是发到同一提供者</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031442200.png\" alt=\"image-20230503144235147\" style=\"zoom:33%;\">\n</li>\n</ul>\n<h6 id=\"修改UserServiceImpl\">修改UserServiceImpl</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service(weight = 100)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;1.......&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"随后启动第一个服务\">随后启动第一个服务</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031459634.png\" alt=\"image-20230503145956577\" style=\"zoom:33%;\">\n<h6 id=\"修改UserServiceImpl-2\">修改UserServiceImpl</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service(weight = 200)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;2......&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改applicationContext-xml\">修改applicationContext.xml</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--&lt;context:component-scan base-package=&quot;com.frx01.service&quot;/&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--dubbo的配置--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:protocol</span> <span class=\"attr\">port</span>=<span class=\"string\">&quot;20882&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--1.项目的名称--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dubbo-service&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dubbo:parameter</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;qos.port&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;4444&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dubbo:application</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--2.配置一下注册中心的地址--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://172.16.108.135:2181&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--3.配置dubbo包扫描--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:annotation</span> <span class=\"attr\">package</span>=<span class=\"string\">&quot;com.frx01.service.impl&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:metadata-report</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://172.16.108.135:2181&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"修改pom-xml文件中tomcat启动端口为9002\">修改pom.xml文件中tomcat启动端口为9002</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.tomcat.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>9002<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"随后启动第二个服务\">随后启动第二个服务</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031459634.png\" alt=\"image-20230503145956577\" style=\"zoom:33%;\">\n<h6 id=\"使用dubbo-admin查看服务\">使用dubbo-admin查看服务</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031446289.png\" alt=\"image-20230503144642238\" style=\"zoom:33%;\">\n<p>同样的</p>\n<h6 id=\"修改-UserServiceImpl-applicationContext-xml-tomcat\">修改   UserServiceImpl   applicationContext.xml   tomcat</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service(weight = 100)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;3......&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--&lt;context:component-scan base-package=&quot;com.frx01.service&quot;/&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--dubbo的配置--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:protocol</span> <span class=\"attr\">port</span>=<span class=\"string\">&quot;20883&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--1.项目的名称--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dubbo-service&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dubbo:parameter</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;qos.port&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;5555&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dubbo:application</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--2.配置一下注册中心的地址--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://172.16.108.135:2181&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--3.配置dubbo包扫描--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:annotation</span> <span class=\"attr\">package</span>=<span class=\"string\">&quot;com.frx01.service.impl&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:metadata-report</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://172.16.108.135:2181&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.tomcat.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>9003<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"随后启动第三个服务\">随后启动第三个服务</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031459634.png\" alt=\"image-20230503145956577\" style=\"zoom:33%;\">\n<h6 id=\"修改UserController\">修改UserController</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.从zookeeper注册中心获取userService的访问url</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.远程的调用RPC</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.将结果封装为代理的对象，给变量赋值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Reference(loadbalance = &quot;random&quot;)</span> <span class=\"comment\">//远程注入 //random:按权重随机</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据id查询用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/find&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.findUserById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031451727.png\" alt=\"image-20230503145123552\" style=\"zoom: 25%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031452454.png\" alt=\"image-20230503145243274\" style=\"zoom:33%;\">\n<ul>\n<li>经过测试，发现第二台的机器服务生成的概率更高些</li>\n</ul>\n<h4 id=\"集群容错\">集群容错</h4>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031310839.webp\" alt></p>\n<h5 id=\"集群容错模式：\">集群容错模式：</h5>\n<ul>\n<li>Failover Cluster：失败重试。默认值。当出现失败，重试其它服务器 ，默认重试2次，使用 retries 配置。一般用于读操作</li>\n<li>Failfast Cluster ：快速失败，只发起一次调用，失败立即报错。通常用于写操作。</li>\n<li>Failsafe Cluster ：失败安全，出现异常时，直接忽略。返回一个空结果。</li>\n<li>Failback Cluster ：失败自动恢复，后台记录失败请求，定时重发。通常用于消息通知操作。</li>\n<li>Forking Cluster ：并行调用多个服务器，只要一个成功即返回。</li>\n<li>Broadcast Cluster ：广播调用所有提供者，逐个调用，任意一台报错则报错。</li>\n</ul>\n<h5 id=\"失败重试演示\">失败重试演示</h5>\n<h6 id=\"第一台机器\">第一台机器</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello dubbo Test~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>  &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;1...&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"启动此机器\">启动此机器</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031459634.png\" alt=\"image-20230503145956577\" style=\"zoom:33%;\">\n<h6 id=\"第二台机器\">第二台机器</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello dubbo Test~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>  &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;2...&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改对应的xml-文件\">修改对应的xml 文件</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--dubbo的配置--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:protocol</span> <span class=\"attr\">port</span>=<span class=\"string\">&quot;20882&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--&amp;lt;!&amp;ndash;1.项目的名称&amp;ndash;&amp;gt;--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dubbo-service&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dubbo:parameter</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;qos.port&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;4445&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dubbo:application</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--2.配置一下注册中心的地址--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://192.168.91.200:2181&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--3.配置dubbo包扫描--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:annotation</span> <span class=\"attr\">package</span>=<span class=\"string\">&quot;com.frx01.service.impl&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:metadata-report</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://192.168.91.200:2181&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"修改tomcat端口为9002\">修改tomcat端口为9002</h5>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.tomcat.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>9002<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"启动此机器-2\">启动此机器</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031459634.png\" alt=\"image-20230503145956577\" style=\"zoom:33%;\">\n<h6 id=\"第三台机器\">第三台机器</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello dubbo Test~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>  &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;3...&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//try &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//  Thread.sleep(3000);</span></span><br><span class=\"line\">        <span class=\"comment\">//&#125; catch (InterruptedException e) &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//    e.printStackTrace();</span></span><br><span class=\"line\">        <span class=\"comment\">//&#125;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:protocol</span> <span class=\"attr\">port</span>=<span class=\"string\">&quot;20888&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--&amp;lt;!&amp;ndash;1.项目的名称&amp;ndash;&amp;gt;--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dubbo-service&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dubbo:parameter</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;qos.port&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;4446&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dubbo:application</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--2.配置一下注册中心的地址--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://192.168.91.200:2181&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--3.配置dubbo包扫描--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:annotation</span> <span class=\"attr\">package</span>=<span class=\"string\">&quot;com.frx01.service.impl&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dubbo:metadata-report</span> <span class=\"attr\">address</span>=<span class=\"string\">&quot;zookeeper://192.168.91.200:2181&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"修改tomcat端口号为9003\">修改tomcat端口号为9003</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.tomcat.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>9003<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"启动此机器-3\">启动此机器</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031459634.png\" alt=\"image-20230503145956577\" style=\"zoom:33%;\">\n<h6 id=\"使用dubbo-admin查看服务-2\">使用dubbo-admin查看服务</h6>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031310560.webp\" alt></p>\n<h5 id=\"设置集群容错策略\">设置集群容错策略</h5>\n<h6 id=\"修改UserController-2\">修改UserController</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.从zookeeper注册中心获取userService的访问url</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.远程的调用RPC</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.将结果封装为代理的对象，给变量赋值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Reference(cluster = &quot;failover&quot;)</span> <span class=\"comment\">//重试 并且重试两次】</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据id查询用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/find&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.findUserById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"启动dubbo-web-并访问http-localhost-8000-user-find-do-id-1\">启动dubbo-web,并访问<a href=\"http://localhost:8000/user/find.do?id=1\">http://localhost:8000/user/find.do?id=1</a></h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031502062.png\" alt=\"image-20230503150159992\" style=\"zoom:33%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031502798.png\" alt=\"image-20230503150253733\" style=\"zoom:53%;\">\n<ul>\n<li>中间dubbo-web报超时错误，超时只是中间错误，依然能返回正确结果</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031503347.png\" alt=\"image-20230503150320161\" style=\"zoom:25%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031503469.png\" alt=\"image-20230503150338287\" style=\"zoom:53%;\">\n<h4 id=\"服务降级\">服务降级</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031310999.webp\" alt=\"image\" style=\"zoom:33%;\">\n<p>服务降级方式:</p>\n<ul>\n<li>mock=force:return null 表示消费方对该服务的方法调用都<code>直接</code>返回null值，不发起远程调用。用来屏蔽不重要服务不可用时对调用方的影响。</li>\n<li>mock=fail:return null 表示消费方应对该服务的方法调用在<code>失败后</code>，再返回null值，不抛异常。用来容忍不重要服务不稳定时对调用方的影响。</li>\n</ul>\n<h5 id=\"dubbo-service\">dubbo-service</h5>\n<h6 id=\"UserService先不改动\">UserService先不改动</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">UserService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello dubbo Test~&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>  &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;2...&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//查询User对象</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"number\">1</span>, <span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"直接启动dubbo-service\">直接启动dubbo-service</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031508017.png\" alt=\"image-20230503150855955\" style=\"zoom:33%;\">\n<h5 id=\"dubbo-web\">dubbo-web</h5>\n<h6 id=\"修改UserServiceImpl-3\">修改UserServiceImpl</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.从zookeeper注册中心获取userService的访问url</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.远程的调用RPC</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.将结果封装为代理的对象，给变量赋值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Reference(mock = &quot;force:return null&quot;)</span><span class=\"comment\">//不再去调用userService的服务了</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据id查询用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/find&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.findUserById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>访问测试:<a href=\"http://localhost:8000/user/find.do?id=1\">http://localhost:8000/user/find.do?id=1(opens new window)</a></li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031510204.png\" alt=\"image-20230503151009141\" style=\"zoom:33%;\">\n<p>返回为null,也不报错，一个空白的页面</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031510302.png\" alt=\"image-20230503151015242\" style=\"zoom:43%;\">\n<ul>\n<li>将@Reference(mock = “force:return null”)改为@Reference(mock = “fail:return null”),再次访问</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.从zookeeper注册中心获取userService的访问url</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.远程的调用RPC</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.将结果封装为代理的对象，给变量赋值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Reference(mock = &quot;fail:return null&quot;)</span><span class=\"comment\">//不再去调用userService的服务了</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.sayHello();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据id查询用户信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/find&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">findUserById</span><span class=\"params\">(<span class=\"type\">int</span> id)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.findUserById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>控制台报错，超时，但是仍然是空白的页面</li>\n</ul>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031511241.png\" alt=\"image-20230503151103114\" style=\"zoom:42%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031512961.png\" alt=\"image-20230503151205839\" style=\"zoom:36%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305031512155.png\" alt=\"image-20230503151245029\" style=\"zoom:35%;\">\n<h2 id=\"深入原理\">深入原理</h2>\n<h3 id=\"1、RPC原理\">1、RPC原理</h3>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051507327.jpg\" alt=\"img\" style=\"zoom:33%;\">\n<p>一次完整的RPC调用流程（同步调用，异步另说）如下：</p>\n<p><strong>1）服务消费方（client）调用以本地调用方式调用服务；</strong></p>\n<p>2）client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体；</p>\n<p>3）client stub找到服务地址，并将消息发送到服务端；</p>\n<p>4）server stub收到消息后进行解码；</p>\n<p>5）server stub根据解码结果调用本地的服务；</p>\n<p>6）本地服务执行并将结果返回给server stub；</p>\n<p>7）server stub将返回结果打包成消息并发送至消费方；</p>\n<p>8）client stub接收到消息，并进行解码；</p>\n<p>**9）服务消费方得到最终结果。**RPC框架的目标就是要2~8这些步骤都封装起来，这些细节对用户来说是透明的，不可见的。</p>\n<h3 id=\"2、netty通信原理\">2、netty通信原理</h3>\n<p>Netty是一个异步事件驱动的网络应用程序框架， 用于快速开发可维护的高性能协议服务器和客户端。它极大地简化并简化了TCP和UDP套接字服务器等网络编程。</p>\n<p>BIO：(Blocking IO)</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051508744.png\" alt=\"image-20230505150840631\" style=\"zoom:33%;\"> \n<p>NIO (Non-Blocking IO)</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051507330.jpg\" alt=\"img\" style=\"zoom:25%;\"> \n<p>Selector 一般称 为<strong>选择器</strong> ，也可以翻译为 <strong>多路复用器，</strong></p>\n<p>Connect（连接就绪）、Accept（接受就绪）、Read（读就绪）、Write（写就绪）</p>\n<h6 id=\"Netty基本原理：\">Netty基本原理：</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051507332.jpg\" alt=\"img\" style=\"zoom:33%;\"> \n<h3 id=\"3、dubbo原理\">3、dubbo原理</h3>\n<h5 id=\"3-1、dubbo原理-框架设计\">3.1、dubbo原理\t-框架设计</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051511664.png\" alt=\"image-20230505151100625\" style=\"zoom:33%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051511172.png\" alt=\"image-20230505151123134\" style=\"zoom:33%;\">\n<ul>\n<li>\n<p>config 配置层：对外配置接口，以 ServiceConfig, ReferenceConfig 为中心，可以直接初始化配置类，也可以通过 spring 解析配置生成配置类</p>\n</li>\n<li>\n<p>proxy 服务代理层：服务接口透明代理，生成服务的客户端 Stub 和服务器端 Skeleton, 以 ServiceProxy 为中心，扩展接口为 ProxyFactory</p>\n</li>\n<li>\n<p>registry 注册中心层：封装服务地址的注册与发现，以服务 URL 为中心，扩展接口为 RegistryFactory, Registry, RegistryService</p>\n</li>\n<li>\n<p>cluster 路由层：封装多个提供者的路由及负载均衡，并桥接注册中心，以 Invoker 为中心，扩展接口为 Cluster, Directory, Router, LoadBalance</p>\n</li>\n<li>\n<p>monitor 监控层：RPC 调用次数和调用时间监控，以 Statistics 为中心，扩展接口为 MonitorFactory, Monitor, MonitorService</p>\n</li>\n<li>\n<p>protocol 远程调用层：封装 RPC 调用，以 Invocation, Result 为中心，扩展接口为 Protocol, Invoker, Exporter</p>\n</li>\n<li>\n<p>exchange 信息交换层：封装请求响应模式，同步转异步，以 Request, Response 为中心，扩展接口为 Exchanger, ExchangeChannel, ExchangeClient, ExchangeServer</p>\n</li>\n<li>\n<p>transport 网络传输层：抽象 mina 和 netty 为统一接口，以 Message 为中心，扩展接口为 Channel, Transporter, Client, Server, Codec</p>\n</li>\n<li>\n<p>serialize 数据序列化层：可复用的一些工具，扩展接口为 Serialization, ObjectInput, ObjectOutput, ThreadPool</p>\n</li>\n</ul>\n<h5 id=\"3-2、dubbo原理-启动解析、加载配置信息\">3.2、dubbo原理\t-启动解析、加载配置信息</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051512810.png\" alt=\"image-20230505151232772\" style=\"zoom:33%;\">\n<h5 id=\"3-3、dubbo原理-服务暴露\">3.3、dubbo原理\t-服务暴露</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051512721.png\" alt=\"image-20230505151250676\" style=\"zoom:33%;\">\n<h5 id=\"3-4、dubbo原理-服务引用\">3.4、dubbo原理\t-服务引用</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051513110.png\" alt=\"image-20230505151305075\" style=\"zoom:33%;\">\n<h5 id=\"3-5、dubbo原理-服务调用\">3.5、dubbo原理\t-服务调用</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051513858.png\" alt=\"image-20230505151346820\" style=\"zoom:33%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202305051514836.png\" alt=\"image-20230505151405751\" style=\"zoom:33%;\">\n","_path":"post/f6253398.html","_link":"http://rycan.top/post/f6253398.html","_id":"cloioo9dl000gni0p0u1s247s"}}