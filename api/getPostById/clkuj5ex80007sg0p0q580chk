{"type":"getPostById","data":{"title":"Maven","date":"2023-07-03T12:50:28.000Z","description":"Maven","categories":[{"name":"中间件","_id":"clkuj5ex70004sg0p7z9759km"}],"tags":[{"name":"Maven","_id":"clkuj5exb000lsg0pgnka7w3c"}],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n<h2 id=\"Maven-JavaWeb-基本操作\">Maven-JavaWeb 基本操作</h2>\n<h3 id=\"终端-IDEA代码操作\">终端+IDEA代码操作</h3>\n<h4 id=\"配置环境\">配置环境</h4>\n<p>配置maven本地仓库</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012119107.png\" alt=\"image-20230301211923065\" style=\"zoom:25%;\">\n<h6 id=\"配置阿里云镜像\">配置阿里云镜像</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012120289.png\" alt=\"image-20230301212023261\" style=\"zoom:25%;\">\n<h6 id=\"配置基础版本的JDK\">配置基础版本的JDK</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012120722.png\" alt=\"image-20230301212046702\" style=\"zoom:25%;\">\n<h6 id=\"配置环境变量JAVAHOME、MAVENHOME\">配置环境变量JAVAHOME、MAVENHOME</h6>\n<p>终端：<code>vim ~/.bash_profile</code></p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012123351.png\" alt=\"image-20230301212314328\" style=\"zoom:25%;\">\n<h6 id=\"创建maven工作环境\">创建maven工作环境</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012124720.png\" alt=\"image-20230301212423700\" style=\"zoom:25%;\">\n<h6 id=\"解读pom-xml文件\">解读pom.xml文件</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012126896.png\" alt=\"image-20230301212637866\" style=\"zoom:25%;\">\n<h4 id=\"命令\">命令</h4>\n<h6 id=\"创建操作\">创建操作</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303121659035.png\" alt=\"image-20230312165941995\" style=\"zoom:25%;\">\n<h6 id=\"清理、编译、测试、打包、安装操作\">清理、编译、测试、打包、安装操作</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012136489.png\" alt=\"202303012134686\" style=\"zoom:25%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012134445.png\" alt=\"image-20230301213421424\" style=\"zoom:25%;\">\n<h4 id=\"创建maven版web工程\">创建maven版web工程</h4>\n<h6 id=\"说明\">说明</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012144930.png\" alt=\"image-20230301214425371\" style=\"zoom:25%;\">\n<h6 id=\"操作\">操作</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012138532.png\" alt=\"image-20230301213800510\" style=\"zoom:25%;\">\n<h6 id=\"命令-2\">命令</h6>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-webapp -DarchetypeVersion=1.4 </span><br></pre></td></tr></table></figure>\n<h6 id=\"基本web操作逻辑\">基本web操作逻辑</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012146098.png\" alt=\"image-20230301214633075\" style=\"zoom:25%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012146496.png\" alt=\"image-20230301214656474\" style=\"zoom:25%;\">\n<h6 id=\"编译出错\">编译出错</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012145021.png\" alt=\"image-20230301214525989\" style=\"zoom:25%;\">\n<h6 id=\"解决：找到依赖并添加到pom文件中\">解决：找到依赖并添加到pom文件中</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012147564.png\" alt=\"image-20230301214757530\" style=\"zoom:25%;\">\n<h6 id=\"启动tomcat\">启动tomcat</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012148162.png\" alt=\"image-20230301214827137\" style=\"zoom:25%;\">\n<h4 id=\"使Web依赖于Java工程\">使Web依赖于Java工程</h4>\n<h6 id=\"观念、配置、测试代码\">观念、配置、测试代码</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012154948.png\" alt=\"image-20230301215446920\" style=\"zoom:25%;\">\n<h6 id=\"执行maven命令并查看依赖\">执行maven命令并查看依赖</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012156066.png\" alt=\"image-20230301215651037\" style=\"zoom:25%;\">\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012157746.png\" alt></p>\n<h4 id=\"测试依赖范围\">测试依赖范围</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012158231.png\" alt=\"image-20230301215814194\" style=\"zoom:125%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012159840.png\" alt=\"image-20230301215932803\" style=\"zoom:25%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012200645.png\" alt=\"image-20230301220011609\" style=\"zoom:25%;\">\n<h4 id=\"测试依赖传递性\">测试依赖传递性</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012201802.png\" alt=\"image-20230301220100764\" style=\"zoom:25%;\">\n<h4 id=\"测试依赖排除\">测试依赖排除</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012202305.png\" alt=\"image-20230301220218262\" style=\"zoom:25%;\">\n<h4 id=\"继承\">继承</h4>\n<h6 id=\"概念与作用\">概念与作用</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012204909.png\" alt=\"image-20230301220406873\" style=\"zoom:25%;\">\n<h6 id=\"操作-2\">操作</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012204730.png\" alt=\"image-20230301220451691\" style=\"zoom:25%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012205356.png\" alt=\"image-20230301220512319\" style=\"zoom:25%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012205800.png\" alt=\"image-20230301220527762\" style=\"zoom:25%;\">\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012205981.png\" alt></p>\n<h4 id=\"聚合\">聚合</h4>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012206540.png\" alt></p>\n<h6 id=\"配置\">配置</h6>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012207991.png\" alt></p>\n<h3 id=\"IDEA中整合Maven\">IDEA中整合Maven</h3>\n<h4 id=\"创建Maven工程\">创建Maven工程</h4>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012208895.png\" alt></p>\n<h4 id=\"配置Maven信息\">配置Maven信息</h4>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012208300.png\" alt></p>\n<h4 id=\"创建java模块工程与maven命令\">创建java模块工程与maven命令</h4>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012211273.png\" alt></p>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012209215.png\" alt></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean install -Dmaven.test.skip=true</span><br></pre></td></tr></table></figure>\n<h4 id=\"创建web模块工程\">创建web模块工程</h4>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012212919.png\" alt></p>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012212509.png\" alt></p>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012212324.png\" alt></p>\n<h4 id=\"一些操作\">一些操作</h4>\n<h5 id=\"在IDEA中执行Maven命令\">在IDEA中执行Maven命令</h5>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012213006.png\" alt></p>\n<h5 id=\"IDEA中查看某个模块的依赖信息\">IDEA中查看某个模块的依赖信息</h5>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012215064.png\" alt></p>\n<h5 id=\"工程导入\">工程导入</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012215731.png\" alt=\"image-20230301221535692\" style=\"zoom:50%;\">\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012217519.png\" alt=\"image-20230301221709479\" style=\"zoom:25%;\">\n<h5 id=\"模块导入\">模块导入</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012218310.png\" alt=\"image-20230301221809268\" style=\"zoom: 50%;\">\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012219378.png\" alt></p>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012219903.png\" alt></p>\n<h2 id=\"一个完整项目的流程-Web回顾\">一个完整项目的流程&lt;Web回顾&gt;</h2>\n<h3 id=\"一、-创建maven工程\">一、 创建maven工程</h3>\n<h3 id=\"二、引入依赖\">二、引入依赖</h3>\n<p>在 <a href=\"https://mvnrepository.com/\">https://mvnrepository.com/</a> 中找到对应的依赖并添加到pom.xml中</p>\n<h3 id=\"三、创建项目的各个层级的包\">三、创建项目的各个层级的包</h3>\n<p>如：</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012315583.png\" alt=\"image-20230301231528547\" style=\"zoom: 50%;\">\n<h3 id=\"四、IDEA连接数据库\">四、IDEA连接数据库</h3>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303012222381.png\" alt=\"image-20230301222250328\" style=\"zoom: 33%;\">\n<h3 id=\"五、-持久化层的环境搭建\">五、 持久化层的环境搭建</h3>\n<h4 id=\"5-1-SQL语句实例\">5.1 SQL语句实例</h4>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> database db_imperial_court; </span><br><span class=\"line\">use db_imperial_court; </span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> t_emp ( </span><br><span class=\"line\">    emp_id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key auto_increment, </span><br><span class=\"line\">    emp_name <span class=\"type\">char</span>(<span class=\"number\">100</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, </span><br><span class=\"line\">    emp_position <span class=\"type\">char</span>(<span class=\"number\">100</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, </span><br><span class=\"line\">\tlogin_account <span class=\"type\">char</span>(<span class=\"number\">100</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">unique</span>, </span><br><span class=\"line\">    login_password <span class=\"type\">char</span>(<span class=\"number\">100</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> </span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t_emp(emp_name, emp_position, login_account, login_password) <span class=\"keyword\">values</span> </span><br><span class=\"line\">(<span class=\"string\">&#x27;爱新觉罗·玄烨&#x27;</span>, <span class=\"string\">&#x27;emperor&#x27;</span>, <span class=\"string\">&#x27;xiaoxuanzi1654&#x27;</span>, <span class=\"string\">&#x27;25325C896624D444B2E241807DCAC98B&#x27;</span>), # <span class=\"number\">16540504</span> </span><br><span class=\"line\">(<span class=\"string\">&#x27;纳兰明珠&#x27;</span>, <span class=\"string\">&#x27;minister&#x27;</span>, <span class=\"string\">&#x27;brightball1635&#x27;</span>, <span class=\"string\">&#x27;A580D0EF93C22036C859E194C14CB777&#x27;</span>), # <span class=\"number\">16351119</span> </span><br><span class=\"line\">(<span class=\"string\">&#x27;赫舍里·索额图&#x27;</span>, <span class=\"string\">&#x27;minister&#x27;</span>, <span class=\"string\">&#x27;tutu1636&#x27;</span>, <span class=\"string\">&#x27;E40FD7D49B8B7EF46F47407D583C3538&#x27;</span>); # <span class=\"number\">17030921</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> t_memorials ( </span><br><span class=\"line\">    memorials_id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key auto_increment, </span><br><span class=\"line\">    memorials_title <span class=\"type\">char</span>(<span class=\"number\">100</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, </span><br><span class=\"line\">    memorials_content <span class=\"type\">varchar</span>(<span class=\"number\">5000</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, </span><br><span class=\"line\">    memorials_emp <span class=\"type\">int</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>, </span><br><span class=\"line\">    memorials_create_time <span class=\"type\">char</span>(<span class=\"number\">100</span>), </span><br><span class=\"line\">    feedback_time <span class=\"type\">char</span>(<span class=\"number\">100</span>), </span><br><span class=\"line\">    feedback_content <span class=\"type\">varchar</span>(<span class=\"number\">1000</span>), </span><br><span class=\"line\">    memorials_status <span class=\"type\">int</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> </span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"5-2-创建和DB对应的实体类\">5.2 创建和DB对应的实体类</h4>\n<p>如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Emp</span> &#123; </span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer empId; </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String empName; </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String empPosition; </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String loginAccount; </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String loginPassword;</span><br><span class=\"line\">    <span class=\"comment\">//还有一些getXXX setXXX 等方法</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"5-3-配置数据库信息\">5.3 配置数据库信息</h4>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">username</span>=<span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">password</span>=<span class=\"string\">00000000</span></span><br><span class=\"line\"><span class=\"attr\">url</span>=<span class=\"string\">jdbc:mysql://localhost:3306/db_imperial_court</span></span><br><span class=\"line\"><span class=\"attr\">driverClassName</span>=<span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\"><span class=\"attr\">initialSize</span>=<span class=\"string\">5</span></span><br><span class=\"line\"><span class=\"attr\">maxActive</span>=<span class=\"string\">10</span></span><br><span class=\"line\"><span class=\"attr\">maxWait</span>=<span class=\"string\">10000</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"5-4-获取数据库连接\">5.4 获取数据库连接</h4>\n<h5 id=\"5-4-1-JDBCUtils工具类\">5.4.1 JDBCUtils工具类</h5>\n<h6 id=\"创建-javax-sql-DataSource-对象\"><strong>创建</strong> <strong>javax.sql.DataSource</strong> <strong>对象</strong></h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JDBCUtils</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 将数据源对象设置为静态属性，保证大对象的单一实例 </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> DataSource dataSource; </span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123; </span><br><span class=\"line\">        <span class=\"comment\">// 1.创建一个用于存储外部属性文件信息的Properties对象 </span></span><br><span class=\"line\">        <span class=\"type\">Properties</span> <span class=\"variable\">properties</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Properties</span>(); </span><br><span class=\"line\">        <span class=\"comment\">// 2.使用当前类的类加载器加载外部属性文件：</span></span><br><span class=\"line\">        jdbc.properties <span class=\"type\">InputStream</span> <span class=\"variable\">inputStream</span> <span class=\"operator\">=</span> JDBCUtils.class.getClassLoader()</span><br><span class=\"line\">                                            .getResourceAsStream(<span class=\"string\">&quot;jdbc.properties&quot;</span>); </span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 3.将外部属性文件jdbc.properties中的数据加载到properties对象中 </span></span><br><span class=\"line\">                properties.load(inputStream); </span><br><span class=\"line\">                <span class=\"comment\">// 4.创建数据源对象 </span></span><br><span class=\"line\">                dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Exception e) &#123; </span><br><span class=\"line\">                e.printStackTrace(); </span><br><span class=\"line\">             &#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"总体实现及优化实现思路：\">总体实现及优化实现思路：</h6>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、从数据源（Datasource）中获取连接</span><br><span class=\"line\">1.1 创建数据源对象</span><br><span class=\"line\">1.2、初始化数据源并从配置文件中读取数据库信息，步骤：</span><br><span class=\"line\">1.2.1、获取类加载器：getClassLoader()</span><br><span class=\"line\">1.2.2、由类加载器从目录下读取文件getResourceStream()</span><br><span class=\"line\">1.2.3、使用Properties的类属性进行封装属性文件中的数据newpropertier.load()</span><br><span class=\"line\">1.2.4、由properties对象创建数据源对象</span><br><span class=\"line\">dataSource = DruidDataSourceFactory.createDataSource(properties); </span><br><span class=\"line\"></span><br><span class=\"line\">//  优化：</span><br><span class=\"line\"></span><br><span class=\"line\">2、进行数据库的连接以及一些对一个数据库进行的sql语句书写&lt;写在BaseDao中&gt;并进行事务管理</span><br><span class=\"line\">2.1值得注意的是：</span><br><span class=\"line\">2.1.1 将上面的操作封装到一个doFilter方法中</span><br><span class=\"line\">2.2.2 但是 connection对象没有办法传递到doFilter中，需要进行跨方法传递，这时候可以通过线程解决，将所有的调用过程都放在一个线程内。  private static ThreadLocal&lt;Connection&gt; threadLocal = new ThreadLocal&lt;&gt;();</span><br><span class=\"line\">2.2.3此时，需要用到线程的三个方法：</span><br><span class=\"line\">set()\t\t\t将数据进行绑定到当前线程 </span><br><span class=\"line\">get()\t\t\t从当前线程获取已绑定的数据 </span><br><span class=\"line\">remove()\t\t将数据从当前线程移除</span><br><span class=\"line\"></span><br><span class=\"line\">3、获取数据库连接</span><br><span class=\"line\">3.1、先看线程中是否已经有绑定的connection对象  get()</span><br><span class=\"line\">3.2、通过判断connection对象是否为空来进行是否需要重新从数据源中建立连接\t\t\tgetconnection()</span><br><span class=\"line\">3.3、要是从数据源中建立的连接还需要和ThreadLocal进行绑定 set(...)</span><br><span class=\"line\"></span><br><span class=\"line\">4、释放连接</span><br><span class=\"line\">close()方法进行释放连接，并进行数据库与线程的移除  remove()</span><br><span class=\"line\">注意druid和mysql的版本问题要注意匹配一致！</span><br></pre></td></tr></table></figure>\n<h5 id=\"5-4-2-JDBCUtils工具类优化：创建ThreadLocal对象\">5.4.2  JDBCUtils工具类优化：创建ThreadLocal对象</h5>\n<h6 id=\"1-需求与问题：\">[1]需求与问题：</h6>\n<p><strong>提出需求</strong></p>\n<p><strong>在一个方法内控制事务</strong>；如果在每一个 Service 方法中都写下面代码，那么代码重复性就太高了</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//伪代码</span></span><br><span class=\"line\"><span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">// 1、获取数据库连接 </span></span><br><span class=\"line\"><span class=\"comment\">// 重要：要保证参与事务的多个数据库操作（SQL 语句）使用的是同一个数据库连接 </span></span><br><span class=\"line\"><span class=\"type\">Connection</span> <span class=\"variable\">conn</span> <span class=\"operator\">=</span> JDBCUtils.getConnection(); </span><br><span class=\"line\"><span class=\"comment\">// 2、核心操作 </span></span><br><span class=\"line\"><span class=\"comment\">// ... </span></span><br><span class=\"line\"><span class=\"comment\">// 3、核心操作成功结束，可以提交事务 </span></span><br><span class=\"line\">conn.commit(); </span><br><span class=\"line\">&#125;<span class=\"keyword\">catch</span>(Exception e)&#123; </span><br><span class=\"line\"><span class=\"comment\">// 4、核心操作抛出异常，必须回滚事务 </span></span><br><span class=\"line\">conn.rollBack(); </span><br><span class=\"line\">&#125;<span class=\"keyword\">finally</span>&#123; </span><br><span class=\"line\"><span class=\"comment\">// 5、释放数据库连接 </span></span><br><span class=\"line\">    JDBCUtils.releaseConnection(conn); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"初步解决办法是：\">初步解决办法是：</h6>\n<p><strong>将重复代码抽取到</strong> <strong>Filter包中</strong></p>\n<p>所谓『当前请求覆盖的 Servlet 方法、Service 方法、Dao 方法』其实就是 chain.doFilter(request,response) <strong>间接调用</strong>的方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TransactionFilter</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Filter</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doFilter</span><span class=\"params\">(ServletRequest request, ServletResponse response, FilterChain chain)</span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 1、获取数据库连接 </span></span><br><span class=\"line\">            <span class=\"comment\">// 重要：要保证参与事务的多个数据库操作（SQL 语句）使用的是同一个数据库连接 </span></span><br><span class=\"line\">            <span class=\"type\">Connection</span> <span class=\"variable\">conn</span> <span class=\"operator\">=</span> JDBCUtils.getConnection(); </span><br><span class=\"line\">            <span class=\"comment\">// 重要操作：关闭自动提交功能 </span></span><br><span class=\"line\">            connection.setAutoCommit(<span class=\"literal\">false</span>); </span><br><span class=\"line\">            <span class=\"comment\">// 2、核心操作：通过 chain 对象放行当前请求 </span></span><br><span class=\"line\">            <span class=\"comment\">// 这样就可以保证当前请求覆盖的 Servlet 方法、Service 方法、Dao 方法都在同一个事务中。</span></span><br><span class=\"line\">            <span class=\"comment\">// 同时各个请求都经过这个 Filter，所以当前事务控制的代码在这里只写一遍就行了， 避免了代码的冗余。 </span></span><br><span class=\"line\">            chain.doFilter(request, response); </span><br><span class=\"line\">            <span class=\"comment\">// 3、核心操作成功结束，可以提交事务 </span></span><br><span class=\"line\">            conn.commit(); &#125;<span class=\"keyword\">catch</span>(Exception e)&#123; </span><br><span class=\"line\">            <span class=\"comment\">// 4、核心操作抛出异常，必须回滚事务 </span></span><br><span class=\"line\">            conn.rollBack(); </span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span>&#123; </span><br><span class=\"line\">            <span class=\"comment\">// 5、释放数据库连接 </span></span><br><span class=\"line\">            JDBCUtils.releaseConnection(conn); </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"2-又引出的问题是：\">[2] 又引出的问题是：</h6>\n<p><strong>数据的跨方法传递</strong></p>\n<p>通过 JDBCUtils 工具类获取到的 Connection 对象需要传递给 Dao 方法，让事务涉及到的所有 Dao 方法用的都是同一个 Connection 对象。但是 Connection 对象无法通过 chain.doFilter() 方法以参数的形式传递过去。所以从获取到 Connection 对象到使用 Connection 对象中间隔着很多不是我们自己声明的方法——我们无法决定它们的参数</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303020012449.png\" alt=\"image-20230302001230389\" style=\"zoom: 33%;\">\n<h6 id=\"解决思路：\">解决思路：</h6>\n<p><strong>ThreadLocal</strong> <strong>对象的功能</strong></p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303020015480.png\" alt=\"image-20230302001534441\" style=\"zoom:33%;\">\n<blockquote>\n<p>全类名：java.lang.ThreadLocal</p>\n<p>泛型 T：要绑定到当前线程的数据的类型</p>\n<p>具体三个主要的方法：</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>方法名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>set(T value)</td>\n<td>将数据绑定到当前线程</td>\n</tr>\n<tr>\n<td>get()</td>\n<td>从当前线程获取已绑定的数据</td>\n</tr>\n<tr>\n<td>remove()</td>\n<td>将数据从当前线程移除</td>\n</tr>\n</tbody>\n</table>\n<h6 id=\"实现是\">实现是:</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 由于 ThreadLocal 对象需要作为绑定数据时 k-v 对中的 key，所以要保证唯一性 </span></span><br><span class=\"line\"><span class=\"comment\">// 加 static 声明为静态资源即可保证唯一性</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ThreadLocal&lt;Connection&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadLocal</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>\n<h6 id=\"获取数据库连接\">获取数据库连接</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 工具方法：获取数据库连接并返回 </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">*/</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Connection <span class=\"title function_\">getConnection</span><span class=\"params\">()</span> &#123; </span><br><span class=\"line\">    <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>; </span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1、尝试从当前线程检查是否存在已经绑定的 Connection 对象 </span></span><br><span class=\"line\">        connection = threadLocal.get(); </span><br><span class=\"line\">        <span class=\"comment\">// 2、检查 Connection 对象是否为 null </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (connection == <span class=\"literal\">null</span>) &#123; </span><br><span class=\"line\">        <span class=\"comment\">// 3、如果为 null，则从数据源获取数据库连接</span></span><br><span class=\"line\">            connection = dataSource.getConnection(); </span><br><span class=\"line\">        <span class=\"comment\">// 4、获取到数据库连接后绑定到当前线程 </span></span><br><span class=\"line\">            threadLocal.set(connection); </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123; </span><br><span class=\"line\">        e.printStackTrace(); </span><br><span class=\"line\">        <span class=\"comment\">// 为了调用工具方法方便，编译时异常不往外抛 </span></span><br><span class=\"line\">        <span class=\"comment\">// 为了不掩盖问题，捕获到的编译时异常封装为运行时异常抛出 </span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e); </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> connection; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"释放数据库连接\">释放数据库连接</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 释放数据库连接 </span></span><br><span class=\"line\"><span class=\"comment\">*/</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">releaseConnection</span><span class=\"params\">(Connection connection)</span> &#123; </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (connection != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 在数据库连接池中将当前连接对象标记为空闲 </span></span><br><span class=\"line\">            connection.close(); </span><br><span class=\"line\">            <span class=\"comment\">// 将当前数据库连接从当前线程上移除 </span></span><br><span class=\"line\">            threadLocal.remove(); </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123; </span><br><span class=\"line\">            e.printStackTrace(); </span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e); </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"进行数据库连接测试\">进行数据库连接测试</h6>\n<p>在test/java下编写测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImperialCourtTest</span> &#123; </span><br><span class=\"line\">    <span class=\"meta\">@Test</span> <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testGetConnection</span><span class=\"params\">()</span> &#123; </span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> JDBCUtils.getConnection(); </span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;connection = &quot;</span> + connection); </span><br><span class=\"line\">        JDBCUtils.releaseConnection(connection); </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"JDBCUtils工具类完整代码\">JDBCUtils工具类完整代码:</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 功能1:从数据源获取数据库连接</span></span><br><span class=\"line\"><span class=\"comment\"> * 功能2:将数据库获取到数据连接后，绑定到本地线程(借助ThreadLocal)</span></span><br><span class=\"line\"><span class=\"comment\"> * 功能3:释放线程时和本地线程解除绑定</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JDBCUtils</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 将数据源对象设置为静态属性，保证大对象的单一实例;同时保证静态方法中可以访问</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> DataSource dataSource;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 由于 ThreadLocal 对象需要作为绑定数据时 k-v 对中的 key，所以要保证唯一性</span></span><br><span class=\"line\">    <span class=\"comment\">// 加 static 声明为静态资源即可保证唯一性</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ThreadLocal&lt;Connection&gt; threadLocal = <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadLocal</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"comment\">//在静态代码块中初始化数据源</span></span><br><span class=\"line\">         <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 操作思路分析：</span></span><br><span class=\"line\">         \t<span class=\"comment\">//从jdbc.properties文件中读取数据库的信息</span></span><br><span class=\"line\">            <span class=\"comment\">//为了保证程序代码的可移植性，需要基于一个确定的基准来读取这个文件</span></span><br><span class=\"line\">            <span class=\"comment\">//确定的基准:类路径的根目录。</span></span><br><span class=\"line\">            <span class=\"comment\">//resources 目录下的内容经过构建操作中的打包操作后会确定放在WEB- INF/classes目录下。</span></span><br><span class=\"line\">            <span class=\"comment\">// WEB- INF/classes目录存放编译好的*.class 字节码文件，所以这个目录我们就称之为类路径。</span></span><br><span class=\"line\">            <span class=\"comment\">//类路径无论在本地运行还是在服务器端运行都是一个确定的基准。</span></span><br><span class=\"line\">            <span class=\"comment\">//具体操作:</span></span><br><span class=\"line\">                 <span class=\"comment\">//1.创建一个用于存储外部属性文件信息的Properties对象</span></span><br><span class=\"line\">                 <span class=\"type\">Properties</span> <span class=\"variable\">properties</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Properties</span>();</span><br><span class=\"line\">                 <span class=\"comment\">//2.使用当前类的类加载器加载外部属性文件：jdbc.properties</span></span><br><span class=\"line\">                 <span class=\"type\">InputStream</span> <span class=\"variable\">inputStream</span> <span class=\"operator\">=</span> JDBCUtils.class.getClassLoader()</span><br><span class=\"line\">                     \t\t\t\t\t\t.getResourceAsStream(<span class=\"string\">&quot;jdbc.properties&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                 <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                     <span class=\"comment\">//3.将外部属性文件jdbc.properties中的数据加载到properties对象中</span></span><br><span class=\"line\">                     properties.load(inputStream);</span><br><span class=\"line\">                     <span class=\"comment\">//4.创建数据源对象</span></span><br><span class=\"line\">                     dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class=\"line\">                 &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                     e.printStackTrace();</span><br><span class=\"line\">                     <span class=\"comment\">//为了避免在真正抛出异常后，catch 块捕获到异常从而掩盖问题，</span></span><br><span class=\"line\">                     <span class=\"comment\">//这里将所捕获到的异常封装为运行时异常继续抛出</span></span><br><span class=\"line\">                    <span class=\"keyword\">throw</span>  <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>();</span><br><span class=\"line\">                 &#125;</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  工具方法：获取数据库连接并返回</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Connection <span class=\"title function_\">getConnection</span><span class=\"params\">()</span> &#123; <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1、尝试从当前线程检查是否存在已经绑定的 Connection 对象</span></span><br><span class=\"line\">        connection = threadLocal.get();</span><br><span class=\"line\">        <span class=\"comment\">// 2、检查 Connection 对象是否为 null</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (connection == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 3、如果为 null，则从数据源获取数据库连接</span></span><br><span class=\"line\">        connection = dataSource.getConnection();</span><br><span class=\"line\">        <span class=\"comment\">//4、获取到数据库连接后绑定到当前线程</span></span><br><span class=\"line\">        threadLocal.set(connection);</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">        <span class=\"comment\">// 为了调用工具方法方便，编译时异常不往外抛</span></span><br><span class=\"line\">        <span class=\"comment\">// 为了不掩盖问题，捕获到的编译时异常封装为运行时异常抛出</span></span><br><span class=\"line\">         <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> connection;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  释放数据库连接</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">releaseConnection</span><span class=\"params\">(Connection connection)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (connection != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 在数据库连接池中将当前连接对象标记为空闲</span></span><br><span class=\"line\">                connection.close();</span><br><span class=\"line\">                <span class=\"comment\">// 将当前数据库连接从当前线程上移除</span></span><br><span class=\"line\">                threadLocal.remove();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"5-5、创建所有Dao层的父Dao\">5.5、创建所有Dao层的父Dao</h4>\n<h5 id=\"BaseDao\"><strong>BaseDao</strong></h5>\n<h6 id=\"泛型说明\">泛型说明</h6>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303020102881.png\" alt></p>\n<h6 id=\"创建QueryRunner对象\">创建QueryRunner对象</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// DBUtils 工具包提供的数据库操作对象</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"type\">QueryRunner</span> <span class=\"variable\">runner</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">QueryRunner</span>();</span><br></pre></td></tr></table></figure>\n<h6 id=\"增、删、改方法\">增、删、改方法</h6>\n<p><strong>特别说明</strong>：在 BaseDao 方法中获取数据库连接但是不做释放，因为我们要在控制事务的 Filter 中统一释放。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 通用的增删改方法，insert、delete、update 操作都可以用这个方法</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> sql 执行操作的 SQL 语句</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> parameters SQL 语句的参数</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span> 受影响的行数</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">update</span><span class=\"params\">(String sql, Object ... parameters)</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> JDBCUtils.getConnection();</span><br><span class=\"line\">           <span class=\"type\">int</span> <span class=\"variable\">affectedRowNumbers</span> <span class=\"operator\">=</span> runner.update(connection, sql, parameters);</span><br><span class=\"line\">           <span class=\"keyword\">return</span> affectedRowNumbers;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">           e.printStackTrace();</span><br><span class=\"line\">           <span class=\"comment\">// 如果真的抛出异常，则将编译时异常封装为运行时异常抛出</span></span><br><span class=\"line\">           <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"查询一个\">查询一个</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 查询单个对象</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> sql 执行查询的 SQL 语句</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> entityClass 实体类对应的 Class 对象</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> parameters 传给 SQL 语句的参数</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> 查询到的实体类对象</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> T <span class=\"title function_\">getSingleBean</span><span class=\"params\">(String sql, Class&lt;T&gt; entityClass, Object ... parameters)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 获取数据库连接</span></span><br><span class=\"line\">          <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> JDBCUtils.getConnection();</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">return</span> runner.query(connection, sql, <span class=\"keyword\">new</span> <span class=\"title class_\">BeanHandler</span>&lt;&gt;(entityClass), parameters);</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">          e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// 如果真的抛出异常，则将编译时异常封装为运行时异常抛出</span></span><br><span class=\"line\">          <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"查询多个\">查询多个</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 查询返回多个对象的方法</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> sql 执行查询操作的 SQL 语句</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> entityClass 实体类的 Class 对象</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> parameters SQL 语句的参数</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span> 查询结果</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> List&lt;T&gt; <span class=\"title function_\">getBeanList</span><span class=\"params\">(String sql, Class&lt;T&gt; entityClass, Object ... parameters)</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">// 获取数据库连接</span></span><br><span class=\"line\">           <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> JDBCUtils.getConnection();</span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"keyword\">return</span> runner.query(connection, sql, <span class=\"keyword\">new</span> <span class=\"title class_\">BeanListHandler</span>&lt;&gt;(entityClass), parameters);</span><br><span class=\"line\"></span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">           e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"comment\">// 如果真的抛出异常，则将编译时异常封装为运行时异常抛出</span></span><br><span class=\"line\">           <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"完整的BaseDao\">完整的BaseDao:</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * BaseDao 类：所有 Dao 实现类的基类</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &lt;T&gt; 实体类的类型</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">BaseDao</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// DBUtils 工具包提供的数据库操作对象</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">QueryRunner</span> <span class=\"variable\">runner</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">QueryRunner</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 查询返回多个对象的方法</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sql 执行查询操作的 SQL 语句</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> entityClass 实体类的 Class 对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> parameters SQL 语句的参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 查询结果</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;T&gt; <span class=\"title function_\">getBeanList</span><span class=\"params\">(String sql, Class&lt;T&gt; entityClass, Object ... parameters)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取数据库连接</span></span><br><span class=\"line\">            <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> JDBCUtils.getConnection();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> runner.query(connection, sql, <span class=\"keyword\">new</span> <span class=\"title class_\">BeanListHandler</span>&lt;&gt;(entityClass), parameters);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 如果真的抛出异常，则将编译时异常封装为运行时异常抛出</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 查询单个对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sql 执行查询的 SQL 语句</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> entityClass 实体类对应的 Class 对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> parameters 传给 SQL 语句的参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 查询到的实体类对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">getSingleBean</span><span class=\"params\">(String sql, Class&lt;T&gt; entityClass, Object ... parameters)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取数据库连接</span></span><br><span class=\"line\">            <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> JDBCUtils.getConnection();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> runner.query(connection, sql, <span class=\"keyword\">new</span> <span class=\"title class_\">BeanHandler</span>&lt;&gt;(entityClass), parameters);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 如果真的抛出异常，则将编译时异常封装为运行时异常抛出</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 通用的增删改方法，insert、delete、update 操作都可以用这个方法</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sql 执行操作的 SQL 语句</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> parameters SQL 语句的参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 受影响的行数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">update</span><span class=\"params\">(String sql, Object ... parameters)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> JDBCUtils.getConnection();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">affectedRowNumbers</span> <span class=\"operator\">=</span> runner.update(connection, sql, parameters);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> affectedRowNumbers;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 如果真的抛出异常，则将编译时异常封装为运行时异常抛出</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"test-java下进行测试\">test/java下进行测试</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImperialCourtTest</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> BaseDao&lt;Emp&gt; baseDao = <span class=\"keyword\">new</span> <span class=\"title class_\">BaseDao</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testGetSingleBean</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;select emp_id empId,emp_name empName,emp_position empPosition,login_account loginAccount,login_password loginPassword from t_emp where emp_id=?&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">Emp</span> <span class=\"variable\">emp</span> <span class=\"operator\">=</span> baseDao.getSingleBean(sql, Emp.class, <span class=\"number\">1</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;emp = &quot;</span> + emp);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testGetBeanList</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;select emp_id empId,emp_name empName,emp_position empPosition,login_account loginAccount,login_password loginPassword from t_emp&quot;</span>;</span><br><span class=\"line\">        List&lt;Emp&gt; empList = baseDao.getBeanList(sql, Emp.class);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Emp emp : empList) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;emp = &quot;</span> + emp);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testUpdate</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;update t_emp set emp_position=? where emp_id=?&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">empPosition</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;minister&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">empId</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;3&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">affectedRowNumber</span> <span class=\"operator\">=</span> baseDao.update(sql, empPosition, empId);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;affectedRowNumber = &quot;</span> + affectedRowNumber);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//数据库连接的测试</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testGetConnection</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> JDBCUtils.getConnection();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;connection = &quot;</span> + connection);</span><br><span class=\"line\"></span><br><span class=\"line\">        JDBCUtils.releaseConnection(connection);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//文件上传的测试</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testSubString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">substring</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;aaa.png&quot;</span>.substring(<span class=\"string\">&quot;aaa.png&quot;</span>.lastIndexOf(<span class=\"string\">&quot;.&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;substring = &quot;</span> + substring);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"5-6-、创建子类Dao以及实现类\">5.6 、创建子类Dao以及实现类</h4>\n<h6 id=\"Dao\">Dao</h6>\n<p>如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">EmpDao</span> &#123;</span><br><span class=\"line\">    Emp <span class=\"title function_\">selectEmpByLoginAccount</span><span class=\"params\">(String loginAccount, String encodedLoginPassword)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"DaoImpl\">DaoImpl</h6>\n<p>如:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EmpDaoImpl</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BaseDao</span>&lt;Emp&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">EmpDao</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Emp <span class=\"title function_\">selectEmpByLoginAccount</span><span class=\"params\">(String loginAccount, String encodedLoginPassword)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1、编写 SQL 语句</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;select emp_id empId,&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;emp_name empName,&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;emp_position empPosition,&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;login_account loginAccount,&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;login_password loginPassword &quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;from t_emp where login_account=? and login_password=?&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2、调用父类方法查询单个对象</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.getSingleBean(sql, Emp.class, loginAccount, encodedLoginPassword);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"优化：用事务进行控制\">优化：用事务进行控制</h3>\n<h4 id=\"总体思路：\">总体思路：</h4>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303020112579.png\" alt=\"image-20230302011217549\" style=\"zoom:33%;\">\n<h4 id=\"创建TransactionFilter类\">创建<strong>TransactionFilter类</strong></h4>\n<h5 id=\"完整代码：\">完整代码：</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TransactionFilter</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Filter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 声明集合保存静态资源扩展名</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Set&lt;String&gt; staticResourceExtNameSet;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        staticResourceExtNameSet = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;();</span><br><span class=\"line\">        staticResourceExtNameSet.add(<span class=\"string\">&quot;.png&quot;</span>);</span><br><span class=\"line\">        staticResourceExtNameSet.add(<span class=\"string\">&quot;.jpg&quot;</span>);</span><br><span class=\"line\">        staticResourceExtNameSet.add(<span class=\"string\">&quot;.css&quot;</span>);</span><br><span class=\"line\">        staticResourceExtNameSet.add(<span class=\"string\">&quot;.js&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doFilter</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class=\"keyword\">throws</span> IOException, ServletException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 前置操作：排除静态资源</span></span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> (HttpServletRequest) servletRequest;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">servletPath</span> <span class=\"operator\">=</span> request.getServletPath();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (servletPath.contains(<span class=\"string\">&quot;.&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">extName</span> <span class=\"operator\">=</span> servletPath.substring(servletPath.lastIndexOf(<span class=\"string\">&quot;.&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (staticResourceExtNameSet.contains(extName)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 如果检测到当前请求确实是静态资源，则直接放行，不做事务操作</span></span><br><span class=\"line\">                filterChain.doFilter(servletRequest, servletResponse);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 当前方法立即返回</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 1、获取数据库连接</span></span><br><span class=\"line\">            connection = JDBCUtils.getConnection();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 重要操作：关闭自动提交功能</span></span><br><span class=\"line\">            connection.setAutoCommit(<span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 2、核心操作</span></span><br><span class=\"line\">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 3、提交事务</span></span><br><span class=\"line\">            connection.commit();</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 4、回滚事务</span></span><br><span class=\"line\">                connection.rollback();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (SQLException ex) &#123;</span><br><span class=\"line\">                ex.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 页面显示：将这里捕获到的异常发送到指定页面显示</span></span><br><span class=\"line\">            <span class=\"comment\">// 获取异常信息</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> e.getMessage();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 将异常信息存入请求域</span></span><br><span class=\"line\">            request.setAttribute(<span class=\"string\">&quot;systemMessage&quot;</span>, message);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 将请求转发到指定页面</span></span><br><span class=\"line\">            request.getRequestDispatcher(<span class=\"string\">&quot;/&quot;</span>).forward(request, servletResponse);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 5、释放数据库连接</span></span><br><span class=\"line\">            JDBCUtils.releaseConnection(connection);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">(FilterConfig filterConfig)</span> <span class=\"keyword\">throws</span> ServletException &#123;&#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"配置web-xml\">配置web.xml</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>txFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>com.atguigu.imperial.court.filter.TransactionFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>txFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"注意点\">注意点</h4>\n<p><strong>[1]确保异常回滚</strong></p>\n<p>在程序执行的过程中，必须让所有 catch 块都把编译时异常转换为运行时异常抛出；如果不这么做，在TransactionFilter 中 catch 就无法捕获到底层抛出的异常，那么该回滚的时候就无法回滚。</p>\n<p><strong>[2]谨防数据库连接提前释放</strong></p>\n<p>由于诸多操作都是在使用同一个数据库连接，那么中间任何一个环节释放数据库连接都会导致后续操作无法正常完成</p>\n<h3 id=\"六、表述层环境搭建\">六、表述层环境搭建</h3>\n<h4 id=\"6-1-视图模版技术Thymeleaf\">6.1 视图模版技术Thymeleaf</h4>\n<h5 id=\"工作机制\">工作机制</h5>\n<h6 id=\"初始化阶段\">初始化阶段</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021033131.png\" alt=\"image-20230302103301068\" style=\"zoom:25%;\">\n<h6 id=\"请求处理阶段\">请求处理阶段</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021047886.png\" alt=\"image-20230302104716826\" style=\"zoom:33%;\">\n<h6 id=\"逻辑视图和物理视图\">逻辑视图和物理视图</h6>\n<p>物理视图：可以通过诸如：/WEB-INF/pages/apple.html这样的地址直接访问到页面本身；</p>\n<p>逻辑视图：物理视图中前面、后面的固定内容抽取出来，让每次请求指定中间变化部分即可，那么<strong>中间变化</strong>部分就叫：<strong>逻辑视图</strong></p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021117198.png\" alt=\"image-20230302111711141\" style=\"zoom:33%;\">\n<h5 id=\"封装ViewBaseServlet\">封装ViewBaseServlet</h5>\n<h6 id=\"将引擎模版初始化和请求处理阶过程封装到ViewBaseServlet\">将引擎模版初始化和请求处理阶过程封装到ViewBaseServlet</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ViewBaseServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">HttpServlet</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TemplateEngine templateEngine;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> ServletException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1.获取ServletContext对象</span></span><br><span class=\"line\">        <span class=\"type\">ServletContext</span> <span class=\"variable\">servletContext</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.getServletContext();</span><br><span class=\"line\">        <span class=\"comment\">// 2.创建Thymeleaf解析器对象</span></span><br><span class=\"line\">        <span class=\"type\">ServletContextTemplateResolver</span> <span class=\"variable\">templateResolver</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">            \t\t\t\t\t\t\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">ServletContextTemplateResolver</span>(servletContext);</span><br><span class=\"line\">        <span class=\"comment\">// 3.给解析器对象设置参数</span></span><br><span class=\"line\">        <span class=\"comment\">// ①HTML是默认模式，明确设置是为了代码更容易理解</span></span><br><span class=\"line\">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class=\"line\">        <span class=\"comment\">// ②设置前缀</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">viewPrefix</span> <span class=\"operator\">=</span> servletContext.getInitParameter(<span class=\"string\">&quot;view-prefix&quot;</span>);</span><br><span class=\"line\">       templateResolver.setPrefix(viewPrefix);</span><br><span class=\"line\">        <span class=\"comment\">// ③设置后缀</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">viewSuffix</span> <span class=\"operator\">=</span> servletContext.getInitParameter(<span class=\"string\">&quot;view-suffix&quot;</span>);</span><br><span class=\"line\">        templateResolver.setSuffix(viewSuffix);</span><br><span class=\"line\">        <span class=\"comment\">// ④设置缓存过期时间（毫秒）</span></span><br><span class=\"line\">        templateResolver.setCacheTTLMs(<span class=\"number\">60000L</span>);</span><br><span class=\"line\">        <span class=\"comment\">// ⑤设置是否缓存</span></span><br><span class=\"line\">        templateResolver.setCacheable(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"comment\">// ⑥设置服务器端编码方式</span></span><br><span class=\"line\">        templateResolver.setCharacterEncoding(<span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 4.创建模板引擎对象</span></span><br><span class=\"line\">        templateEngine = <span class=\"keyword\">new</span> <span class=\"title class_\">TemplateEngine</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 5.给模板引擎对象设置模板解析器</span></span><br><span class=\"line\">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">processTemplate</span><span class=\"params\">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1.设置响应体内容类型和字符集</span></span><br><span class=\"line\">        resp.setContentType(<span class=\"string\">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 2.创建WebContext对象</span></span><br><span class=\"line\">        <span class=\"type\">WebContext</span> <span class=\"variable\">webContext</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">WebContext</span>(req, resp, getServletContext());</span><br><span class=\"line\">        <span class=\"comment\">// 3.处理模板数据</span></span><br><span class=\"line\">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"配置xml\">配置xml</h5>\n<h6 id=\"部分代码\">部分代码</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 配置 Web 应用初始化参数指定视图前缀、后缀 --&gt;</span> </span><br><span class=\"line\">    <span class=\"comment\">&lt;!--物理视图举例：/WEB-INF/pages/index.html 对应逻辑视图：index --&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>view-prefix<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>/WEB-INF/pages/<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>view-suffix<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>.html<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"附：Thymeleaf语法\">附：Thymeleaf语法</h5>\n<p>http://heavy_code_industry.gitee.io/code_heavy_industry/pro001-javaweb/lecture/chapter08/</p>\n<h4 id=\"6-2-ModelBaseServlet\">6.2 ModelBaseServlet</h4>\n<h5 id=\"需求：\">需求：</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021124650.png\" alt=\"image-20230302112433580\" style=\"zoom:33%;\">\n<h5 id=\"HttpServlet局限\">HttpServlet局限</h5>\n<p>​\t\tdoGet() 方法：处理 GET 请求</p>\n<p>​\t\tdoPost() 方法：处理 POST 请求</p>\n<h5 id=\"解决\">解决</h5>\n<p>​\t\t每个请求附带一个<strong>请求参数</strong>，表明自己要调用的目标方法</p>\n<p>​\t\tServlet 根据目标方法名通过<strong>反射</strong>调用目标方法</p>\n<p><strong>特别提醒</strong>：为了配合 TransactionFilter 实现事务控制，捕获的异常必须抛出。</p>\n<h6 id=\"完整代码\">完整代码</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ModelBaseServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ViewBaseServlet</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 在doGet()方法中调用doPost()方法，这样就可以在doPost()方法中集中处理所有请求</span></span><br><span class=\"line\">        doPost(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.在所有request.getParameter()前面设置解析请求体的字符集</span></span><br><span class=\"line\">        request.setCharacterEncoding(<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.从请求参数中获取method对应的数据</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;method&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.通过反射调用method对应的方法</span></span><br><span class=\"line\">        <span class=\"comment\">// ①获取Class对象</span></span><br><span class=\"line\">        Class&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">ModelBaseServlet</span>&gt; clazz = <span class=\"built_in\">this</span>.getClass();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ②获取method对应的Method对象</span></span><br><span class=\"line\">            <span class=\"type\">Method</span> <span class=\"variable\">methodObject</span> <span class=\"operator\">=</span> clazz.getDeclaredMethod(method, HttpServletRequest.class, \t\t\t\t\t\t\t\t\t\t\t\t\t\tHttpServletResponse.class);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// ③打开访问权限</span></span><br><span class=\"line\">            methodObject.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// ④通过Method对象调用目标方法</span></span><br><span class=\"line\">            methodObject.invoke(<span class=\"built_in\">this</span>, request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 重要提醒：为了配合 TransactionFilter 实现事务控制，捕获的异常必须抛出。</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"继承关系\">继承关系</h5>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021152195.png\" alt=\"image-20230302115253123\" style=\"zoom:25%;\">\n<h4 id=\"6-3-工具类模块\">6.3 工具类模块</h4>\n<h5 id=\"辅助功能——常量类\">辅助功能——常量类</h5>\n<p>如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImperialCourtConst</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">LOGIN_FAILED_MESSAGE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;账号、密码错误，不可进宫！&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">ACCESS_DENIED_MESSAGE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;宫闱禁地，不得擅入！&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">LOGIN_EMP_ATTR_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;loginInfo&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"辅助功能——MD5加密算法\">辅助功能——MD5加密算法</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MD5Util</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 针对明文字符串执行MD5加密</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> source</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">encode</span><span class=\"params\">(String source)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.判断明文字符串是否有效</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (source == <span class=\"literal\">null</span> || <span class=\"string\">&quot;&quot;</span>.equals(source)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;用于加密的明文不可为空&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.声明算法名称</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">algorithm</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;md5&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.获取MessageDigest对象</span></span><br><span class=\"line\">        <span class=\"type\">MessageDigest</span> <span class=\"variable\">messageDigest</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            messageDigest = MessageDigest.getInstance(algorithm);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4.获取明文字符串对应的字节数组</span></span><br><span class=\"line\">        <span class=\"type\">byte</span>[] input = source.getBytes();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5.执行加密</span></span><br><span class=\"line\">        <span class=\"type\">byte</span>[] output = messageDigest.digest(input);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 6.创建BigInteger对象</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">signum</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"type\">BigInteger</span> <span class=\"variable\">bigInteger</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BigInteger</span>(signum, output);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 7.按照16进制将bigInteger的值转换为字符串</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">radix</span> <span class=\"operator\">=</span> <span class=\"number\">16</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">encoded</span> <span class=\"operator\">=</span> bigInteger.toString(radix).toUpperCase();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> encoded;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"辅助功能——日志配置文件\">辅助功能——日志配置文件</h5>\n<h6 id=\"logback-xml\">logback.xml</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span> <span class=\"attr\">debug</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 指定日志输出的位置 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;STDOUT&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">              <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 日志输出的格式 --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 按照顺序分别是：时间、日志级别、线程名称、打印日志的类、日志主体内容、换行 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%d&#123;HH:mm:ss.SSS&#125;] [%-5level] [%thread] [%logger] [%msg]%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">charset</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">charset</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 设置全局日志级别。日志级别按顺序分别是：DEBUG、INFO、WARN、ERROR --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 指定任何一个日志级别都只打印当前级别和后面级别的日志。 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;INFO&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 指定打印日志的appender，这里通过“STDOUT”引用了前面配置的appender --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 专门给某一个包指定日志级别 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;com.atguigu&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span> <span class=\"attr\">additivity</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">logger</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"七、业务功能实现\">七、业务功能实现</h3>\n<h4 id=\"登录：\">登录：</h4>\n<h5 id=\"显示首页：\">显示首页：</h5>\n<h6 id=\"首页逻辑流程图\">首页逻辑流程图</h6>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021159342.png\" alt=\"image-20230302115943265\" style=\"zoom:25%;\">\n<h6 id=\"在IndexServlet逻辑书写\">在IndexServlet逻辑书写</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">IndexServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ViewBaseServlet</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doGet</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\">        doPost(req, resp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doPost</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 声明要访问的首页的逻辑视图</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">templateName</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;index&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 调用父类的方法根据逻辑视图名称渲染视图</span></span><br><span class=\"line\">        processTemplate(templateName, req, resp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h6 id=\"在web-xml进行配置\">在web.xml进行配置</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>indexServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.atguigu.imperial.court.servlet.module.IndexServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>indexServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"index-html前端界面书写\">index.html前端界面书写</h6>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span> <span class=\"attr\">xml:th</span>=<span class=\"string\">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- @&#123;/auth&#125; 解析后：/demo/auth --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">th:action</span>=<span class=\"string\">&quot;@&#123;/auth&#125;&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 传递 method 请求参数，目的是为了让当前请求调用 AuthServlet 中的 login() 方法 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;method&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;login&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- th:text 解析表达式后会替换标签体 --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- $&#123;attrName&#125; 从请求域获取属性名为 attrName 的属性值 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: red;font-weight: bold;&quot;</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;message&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: red;font-weight: bold;&quot;</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;systemMessage&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    账号：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;loginAccount&quot;</span>/&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></span><br><span class=\"line\">    密码：<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;loginPassword&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span>进宫<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"进行登录和退出登录：\">进行登录和退出登录：</h5>\n<h6 id=\"操作逻辑流程图：\">操作逻辑流程图：</h6>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021227045.png\" alt></p>\n<h6 id=\"AuthServlet完整代码：\">AuthServlet完整代码：</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AuthServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ModelBaseServlet</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">EmpService</span> <span class=\"variable\">empService</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">EmpServiceImpl</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">login</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">            HttpServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">            HttpServletResponse response)</span></span><br><span class=\"line\">            <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 1、获取请求参数</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">loginAccount</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;loginAccount&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">loginPassword</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;loginPassword&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 2、调用 EmpService 方法执行登录逻辑</span></span><br><span class=\"line\">            <span class=\"type\">Emp</span> <span class=\"variable\">emp</span> <span class=\"operator\">=</span> empService.getEmpByLoginAccount(loginAccount, loginPassword);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 3、通过 request 获取 HttpSession 对象</span></span><br><span class=\"line\">            <span class=\"type\">HttpSession</span> <span class=\"variable\">session</span> <span class=\"operator\">=</span> request.getSession();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 4、将查询到的 Emp 对象存入 Session 域</span></span><br><span class=\"line\">            session.setAttribute(ImperialCourtConst.LOGIN_EMP_ATTR_NAME, emp);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 5、前往指定页面视图</span></span><br><span class=\"line\">            <span class=\"comment\">// 前往临时页面</span></span><br><span class=\"line\">            <span class=\"comment\">// String templateName = &quot;temp&quot;;</span></span><br><span class=\"line\">            <span class=\"comment\">// processTemplate(templateName, request, response);</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 前往正式的目标地址</span></span><br><span class=\"line\">            response.sendRedirect(request.getContextPath() + </span><br><span class=\"line\">                                 \t\t\t\t <span class=\"string\">&quot;/work?method=showMemorialsDigestList&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 6、判断此处捕获到的异常是否是登录失败异常</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> LoginFailedException) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 7、如果是登录失败异常则跳转回登录页面</span></span><br><span class=\"line\">                <span class=\"comment\">// ①将异常信息存入请求域</span></span><br><span class=\"line\">                request.setAttribute(<span class=\"string\">&quot;message&quot;</span>, e.getMessage());</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// ②处理视图：index</span></span><br><span class=\"line\">                processTemplate(<span class=\"string\">&quot;index&quot;</span>, request, response);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 8、如果不是登录异常则封装为运行时异常继续抛出</span></span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">logout</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1、通过 request 对象获取 HttpSession 对象</span></span><br><span class=\"line\">        <span class=\"type\">HttpSession</span> <span class=\"variable\">session</span> <span class=\"operator\">=</span> request.getSession();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2、将 HttpSession 对象强制失效</span></span><br><span class=\"line\">        session.invalidate();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3、回到首页</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">templateName</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;index&quot;</span>;</span><br><span class=\"line\">        processTemplate(templateName, request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h6 id=\"配置web-xml-2\">配置web.xml</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>authServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.atguigu.imperial.court.servlet.module.AuthServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>authServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/auth<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h6 id=\"service包：\">service包：</h6>\n<p>如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">EmpService</span> &#123;</span><br><span class=\"line\">    Emp <span class=\"title function_\">getEmpByLoginAccount</span><span class=\"params\">(String loginAccount, String loginPassword)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"serviceImpl包：\">serviceImpl包：</h6>\n<p>如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EmpServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">EmpService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">EmpDao</span> <span class=\"variable\">empDao</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">EmpDaoImpl</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Emp <span class=\"title function_\">getEmpByLoginAccount</span><span class=\"params\">(String loginAccount, String loginPassword)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1、对密码执行加密</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">encodedLoginPassword</span> <span class=\"operator\">=</span> MD5Util.encode(loginPassword);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2、根据账户和加密密码查询数据库</span></span><br><span class=\"line\">        <span class=\"type\">Emp</span> <span class=\"variable\">emp</span> <span class=\"operator\">=</span> empDao.selectEmpByLoginAccount(loginAccount, encodedLoginPassword);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3、检查 Emp 对象是否为 null</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (emp != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//\t①不为 null：返回 Emp</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> emp;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//\t②为 null：抛登录失败异常</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LoginFailedException</span>(ImperialCourtConst.LOGIN_FAILED_MESSAGE);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"登录失败的异常类\">登录失败的异常类</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LoginFailedException</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">RuntimeException</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LoginFailedException</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LoginFailedException</span><span class=\"params\">(String message)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LoginFailedException</span><span class=\"params\">(String message, Throwable cause)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(message, cause);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LoginFailedException</span><span class=\"params\">(Throwable cause)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(cause);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LoginFailedException</span><span class=\"params\">(String message, Throwable cause, </span></span><br><span class=\"line\"><span class=\"params\">                                <span class=\"type\">boolean</span> enableSuppression,<span class=\"type\">boolean</span> writableStackTrace)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(message, cause, enableSuppression, writableStackTrace);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"Dao包-DaoImpl包-逻辑见-5-6\">Dao包  DaoImpl包  逻辑见 5.6</h6>\n<h4 id=\"奏折列表显示：\">奏折列表显示：</h4>\n<h5 id=\"显示逻辑流程图：\">显示逻辑流程图：</h5>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021312308.png\" alt></p>\n<h5 id=\"创建Servlet\">创建Servlet</h5>\n<h6 id=\"workservlet完整代码\">workservlet完整代码</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WorkServlet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ModelBaseServlet</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">MemorialsService</span> <span class=\"variable\">memorialsService</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MemorialsServiceImpl</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">showMemorialsDigestList</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1、调用 Service 方法查询数据</span></span><br><span class=\"line\">        List&lt;Memorials&gt; memorialsList = memorialsService.getAllMemorialsDigest();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2、将查询得到的数据存入请求域</span></span><br><span class=\"line\">        request.setAttribute(<span class=\"string\">&quot;memorialsList&quot;</span>, memorialsList);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3、渲染视图</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">templateName</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;memorials-list&quot;</span>;</span><br><span class=\"line\">        processTemplate(templateName, request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">showMemorialsDetail</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">            HttpServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">            HttpServletResponse response)</span></span><br><span class=\"line\">            <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1、从请求参数读取 memorialsId</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">memorialsId</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;memorialsId&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2、根据 memorialsId 从 Service 中查询 Memorials 对象</span></span><br><span class=\"line\">        <span class=\"type\">Memorials</span> <span class=\"variable\">memorials</span> <span class=\"operator\">=</span> memorialsService.getMemorialsDetailById(memorialsId);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// **********************补充功能**********************</span></span><br><span class=\"line\">        <span class=\"comment\">// 获取当前奏折对象的状态</span></span><br><span class=\"line\">        <span class=\"type\">Integer</span> <span class=\"variable\">memorialsStatus</span> <span class=\"operator\">=</span> memorials.getMemorialsStatus();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 判断奏折状态</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (memorialsStatus == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 更新奏折状态：数据库修改</span></span><br><span class=\"line\">            memorialsService.updateMemorialsStatusToRead(memorialsId);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 更新奏折状态：当前对象修改</span></span><br><span class=\"line\">            memorials.setMemorialsStatus(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// **********************补充功能**********************</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3、将 Memorials 对象存入请求域</span></span><br><span class=\"line\">        request.setAttribute(<span class=\"string\">&quot;memorials&quot;</span>, memorials);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4、解析渲染视图</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">templateName</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;memorials_detail&quot;</span>;</span><br><span class=\"line\">        processTemplate(templateName, request, response);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">feedBack</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取表单提交的请求参数</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">memorialsId</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;memorialsId&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">feedbackContent</span> <span class=\"operator\">=</span> request.getParameter(<span class=\"string\">&quot;feedbackContent&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 执行更新</span></span><br><span class=\"line\">        memorialsService.updateMemorialsFeedBack(memorialsId, feedbackContent);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 重定向回显示奏折列表页面</span></span><br><span class=\"line\">        response.sendRedirect(request.getContextPath() + <span class=\"string\">&quot;/work?method=showMemorialsDigestList&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h6 id=\"web-xml配置\">web.xml配置</h6>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>workServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>com.atguigu.imperial.court.servlet.module.WorkServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>workServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/work<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"创建Service\">创建Service</h5>\n<h6 id=\"service\">service</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">MemorialsService</span> &#123;</span><br><span class=\"line\">    List&lt;Memorials&gt; <span class=\"title function_\">getAllMemorialsDigest</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    Memorials <span class=\"title function_\">getMemorialsDetailById</span><span class=\"params\">(String memorialsId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">updateMemorialsStatusToRead</span><span class=\"params\">(String memorialsId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">updateMemorialsFeedBack</span><span class=\"params\">(String memorialsId, String feedbackContent)</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h6 id=\"serviceImpl\">serviceImpl</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MemorialsServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">MemorialsService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">MemorialsDao</span> <span class=\"variable\">memorialsDao</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MemorialsDaoImpl</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Memorials&gt; <span class=\"title function_\">getAllMemorialsDigest</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> memorialsDao.selectAllMemorialsDigest();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Memorials <span class=\"title function_\">getMemorialsDetailById</span><span class=\"params\">(String memorialsId)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> memorialsDao.selectMemorialsById(memorialsId);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">updateMemorialsStatusToRead</span><span class=\"params\">(String memorialsId)</span> &#123;</span><br><span class=\"line\">        memorialsDao.updateMemorialsStatusToRead(memorialsId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">updateMemorialsFeedBack</span><span class=\"params\">(String memorialsId, String feedbackContent)</span> &#123;</span><br><span class=\"line\">        memorialsDao.updateMemorialsFeedBack(memorialsId, feedbackContent);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"创建Dao\">创建Dao</h5>\n<h6 id=\"Dao-2\">Dao</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">MemorialsDao</span> &#123;</span><br><span class=\"line\">    List&lt;Memorials&gt; <span class=\"title function_\">selectAllMemorialsDigest</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    Memorials <span class=\"title function_\">selectMemorialsById</span><span class=\"params\">(String memorialsId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">updateMemorialsStatusToRead</span><span class=\"params\">(String memorialsId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">updateMemorialsFeedBack</span><span class=\"params\">(String memorialsId, String feedbackContent)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"DaoImpl-2\">DaoImpl</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MemorialsDaoImpl</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BaseDao</span>&lt;Memorials&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">MemorialsDao</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Memorials&gt; <span class=\"title function_\">selectAllMemorialsDigest</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;select memorials_id memorialsId,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       memorials_title memorialsTitle,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       concat(left(memorials_content, 10), \\&quot;...\\&quot;) memorialsContentDigest,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       emp_name memorialsEmpName,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       memorials_create_time memorialsCreateTime,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       memorials_status memorialsStatus\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;from t_memorials m left join  t_emp e on m.memorials_emp=e.emp_id;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> getBeanList(sql, Memorials.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Memorials <span class=\"title function_\">selectMemorialsById</span><span class=\"params\">(String memorialsId)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;select memorials_id memorialsId,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       memorials_title memorialsTitle,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       memorials_content memorialsContent,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       emp_name memorialsEmpName,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       memorials_create_time memorialsCreateTime,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       memorials_status memorialsStatus,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       feedback_time feedbackTime,\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;       feedback_content feedbackContent\\n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;from t_memorials m left join  t_emp e on m.memorials_emp=e.emp_id &quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;where memorials_id=?&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> getSingleBean(sql, Memorials.class, memorialsId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">updateMemorialsStatusToRead</span><span class=\"params\">(String memorialsId)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;update t_memorials set memorials_status=1 where memorials_id=?&quot;</span>;</span><br><span class=\"line\">        update(sql, memorialsId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">updateMemorialsFeedBack</span><span class=\"params\">(String memorialsId, String feedbackContent)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">feedbackTime</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleDateFormat</span>(<span class=\"string\">&quot;yyyy-MM-dd&quot;</span>).format(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;update t_memorials set memorials_status=2,feedback_content=?,feedback_time=? where memorials_id=?&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        update(sql, feedbackContent, feedbackTime, memorialsId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"页面实现部分（前端）\">页面实现部分（前端）</h5>\n<h6 id=\"css-html\">css+html</h6>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span> <span class=\"attr\">xml:th</span>=<span class=\"string\">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/css&quot;</span>&gt;</span><span class=\"language-css\"></span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"selector-tag\">table</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">border-collapse</span>: collapse;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0px</span> auto <span class=\"number\">0px</span> auto;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">th</span>, <span class=\"selector-tag\">td</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid black;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">text-align</span>: center;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"selector-tag\">div</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">text-align</span>: right;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"comment\">&lt;!-- 登录信息部分 --&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;session.loginInfo.empPosition == &#x27;emperor&#x27;&#125;&quot;</span>&gt;</span>恭请皇上圣安<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;session.loginInfo.empPosition == &#x27;minister&#x27;&#125;&quot;</span>&gt;</span>给<span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;session.loginInfo.empName&#125;&quot;</span>&gt;</span>XXX<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span>大人请安<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">th:href</span>=<span class=\"string\">&quot;@&#123;/auth?method=logout&#125;&quot;</span>&gt;</span>退朝<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"comment\">&lt;!-- 数据显示部分 --&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>奏折标题<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>内容摘要<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>上疏大臣<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>上疏时间<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>奏折状态<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>奏折详情<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">tbody</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;#lists.isEmpty(memorialsList)&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">colspan</span>=<span class=\"string\">&quot;6&quot;</span>&gt;</span>没有人上过折子<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">tbody</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;not #lists.isEmpty(memorialsList)&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">th:each</span>=<span class=\"string\">&quot;memorials : $&#123;memorialsList&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:switch</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsStatus&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsTitle&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: red;&quot;</span>&gt;</span>奏折标题<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsTitle&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;1&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: blue;&quot;</span>&gt;</span>奏折标题<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsTitle&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;2&quot;</span>&gt;</span>奏折标题<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:switch</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsStatus&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsContentDigest&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: red;&quot;</span>&gt;</span>内容摘要<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsContentDigest&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;1&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: blue;&quot;</span>&gt;</span>内容摘要<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsContentDigest&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;2&quot;</span>&gt;</span>内容摘要<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:switch</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsStatus&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsEmpName&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: red;&quot;</span>&gt;</span>上疏大臣<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsEmpName&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;1&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: blue;&quot;</span>&gt;</span>上疏大臣<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsEmpName&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;2&quot;</span>&gt;</span>上疏大臣<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:switch</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsStatus&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsCreateTime&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: red;&quot;</span>&gt;</span>上疏时间<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsCreateTime&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;1&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: blue;&quot;</span>&gt;</span>上疏时间<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsCreateTime&#125;&quot;</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;2&quot;</span>&gt;</span>上疏时间<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:switch</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsStatus&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: red;&quot;</span>&gt;</span>未读<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;1&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: blue;&quot;</span>&gt;</span>已读<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:case</span>=<span class=\"string\">&quot;2&quot;</span>&gt;</span>已批示<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">th:href</span>=<span class=\"string\">&quot;@&#123;/work(method=&#x27;showMemorialsDetail&#x27;,memorialsId=$&#123;memorials.memorialsId&#125;)&#125;&quot;</span>&gt;</span>奏折详情<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">                <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<h5 id=\"与登录对接模块\">与登录对接模块</h5>\n<p>见AuthServlet中的下述代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 5、前往指定页面视图 </span></span><br><span class=\"line\"><span class=\"comment\">// 前往临时页面 </span></span><br><span class=\"line\"><span class=\"comment\">// String templateName = &quot;temp&quot;; </span></span><br><span class=\"line\"><span class=\"comment\">// processTemplate(templateName, request, response); </span></span><br><span class=\"line\"><span class=\"comment\">// 前往正式的目标地址 </span></span><br><span class=\"line\">response.sendRedirect(request.getContextPath() + <span class=\"string\">&quot;/work? method=showMemorialsDigestList&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"奏折详情显示\">奏折详情显示</h4>\n<h5 id=\"详情显示逻辑流程图\">详情显示逻辑流程图</h5>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021337434.png\" alt></p>\n<h5 id=\"Servlet、Service、Dao\">Servlet、Service、Dao</h5>\n<p>三者大致流程同<strong>奏折列表显示</strong>，只是函数变化，代码见<strong>奏折列表</strong>中的完整代码</p>\n<h5 id=\"html界面发生变化\">html界面发生变化</h5>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/css&quot;</span>&gt;</span><span class=\"language-css\"></span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"selector-tag\">table</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">border-collapse</span>: collapse;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0px</span> auto <span class=\"number\">0px</span> auto;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">width</span>: <span class=\"number\">70%</span>;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">th</span>, <span class=\"selector-tag\">td</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid black;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">text-align</span>: center;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        <span class=\"selector-tag\">div</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">            <span class=\"attribute\">text-align</span>: right;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">        &#125;</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"language-xml\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"comment\">&lt;!-- 登录信息部分 --&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;session.loginInfo.empPosition == &#x27;emperor&#x27;&#125;&quot;</span>&gt;</span>恭请皇上圣安<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;session.loginInfo.empPosition == &#x27;minister&#x27;&#125;&quot;</span>&gt;</span>给<span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;session.loginInfo.empName&#125;&quot;</span>&gt;</span>XXX<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span>大人请安<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">th:href</span>=<span class=\"string\">&quot;@&#123;/auth?method=logout&#125;&quot;</span>&gt;</span>退朝<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>奏折标题<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsTitle&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>上疏大臣<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsEmpName&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>上疏时间<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsCreateTime&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>奏折内容<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsContent&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsStatus == 2&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>批复时间<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.feedbackTime&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsStatus == 2&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>批复时间<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">th:text</span>=<span class=\"string\">&quot;$&#123;memorials.feedbackContent&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;margin: 0 auto 0 auto;width: 60%;&quot;</span> <span class=\"attr\">th:if</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsStatus != 2&#125;&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">th:action</span>=<span class=\"string\">&quot;@&#123;/work&#125;&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;method&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;feedBack&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;memorialsId&quot;</span> <span class=\"attr\">th:value</span>=<span class=\"string\">&quot;$&#123;memorials.memorialsId&#125;&quot;</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">textarea</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;feedbackContent&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 500px;height: 200px;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">textarea</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span>&gt;</span>御批<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">th:href</span>=<span class=\"string\">&quot;@&#123;/work?method=showMemorialsDigestList&#125;&quot;</span>&gt;</span>返回列表<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<h4 id=\"奏折状态更新\">奏折状态更新</h4>\n<p>即：一份<strong>未读</strong>奏折，点击查看后，需要从未读变成已读</p>\n<h5 id=\"Servlet、Service、Dao-2\">Servlet、Service、Dao</h5>\n<p>上面三层中依次添加对应的逻辑代码</p>\n<h4 id=\"批复奏折\">批复奏折</h4>\n<h5 id=\"本质\">本质</h5>\n<p>提交表单，更新数据</p>\n<h5 id=\"Servlet、Service、Dao-3\">Servlet、Service、Dao</h5>\n<p>上面三层中依次添加对应的逻辑代码</p>\n<h4 id=\"优化之：登录检查\">优化之：登录检查</h4>\n<h5 id=\"检查逻辑流程图：\">检查逻辑流程图：</h5>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021344365.png\" alt></p>\n<h5 id=\"使用Filter进行优化\">使用Filter进行优化</h5>\n<p>利用Filter进行拦截、过滤从而实现检查</p>\n<h6 id=\"Filter完整代码\">Filter完整代码</h6>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LoginFilter</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Filter</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">(FilterConfig filterConfig)</span> <span class=\"keyword\">throws</span> ServletException &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doFilter</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class=\"keyword\">throws</span> IOException, ServletException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1、获取 HttpSession 对象</span></span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> (HttpServletRequest) servletRequest;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">HttpSession</span> <span class=\"variable\">session</span> <span class=\"operator\">=</span> request.getSession();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 2、尝试从 Session 域获取已登录的对象</span></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">loginEmp</span> <span class=\"operator\">=</span> session.getAttribute(ImperialCourtConst.LOGIN_EMP_ATTR_NAME);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3、判断 loginEmp 是否为空</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (loginEmp != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 4、若不为空则说明当前请求已登录，直接放行</span></span><br><span class=\"line\">            filterChain.doFilter(request, servletResponse);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5、若为空说明尚未登录，则回到登录页面</span></span><br><span class=\"line\">        request.setAttribute(<span class=\"string\">&quot;systemMessage&quot;</span>, ImperialCourtConst.ACCESS_DENIED_MESSAGE);</span><br><span class=\"line\">        request.getRequestDispatcher(<span class=\"string\">&quot;/&quot;</span>).forward(request, servletResponse);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"配置web-xml-3\">配置web.xml</h5>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>loginFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>com.atguigu.imperial.court.filter.LoginFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>loginFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/work<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"Maven打包部署\">Maven打包部署</h2>\n<h3 id=\"一、适配部署环境\">一、适配部署环境</h3>\n<p>properties配置文件中的 MySQL 连接信息中，IP 地址部分需要改成 localhost</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">url</span>=<span class=\"string\">jdbc:mysql://localhost:3306/db_imperial_court</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"二、跳过测试打包\">二、跳过测试打包</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean package -Dmaven.test.skip=true</span><br></pre></td></tr></table></figure>\n<h3 id=\"三、部署执行\">三、部署执行</h3>\n<p><img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303021426709.png\" alt></p>\n<h2 id=\"Maven-SSM操作-SSM流程回顾\">Maven-SSM操作&lt;SSM流程回顾&gt;</h2>\n<h3 id=\"1、创建各个Maven工程\">1、创建各个Maven工程</h3>\n<table>\n<thead>\n<tr>\n<th>工程名</th>\n<th>地位</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>demo-imperial-court-ssm-show</td>\n<td>父工程</td>\n<td>总体管理各个子工程</td>\n</tr>\n<tr>\n<td>demo-module01-web</td>\n<td>子工程</td>\n<td>唯一的 war 包工程</td>\n</tr>\n<tr>\n<td>demo-module02-component</td>\n<td>子工程</td>\n<td>管理项目中的各种组件</td>\n</tr>\n<tr>\n<td>demo-module03-entity</td>\n<td>子工程</td>\n<td>管理项目中的实体类</td>\n</tr>\n<tr>\n<td>demo-module04-util</td>\n<td>子工程</td>\n<td>管理项目中的工具类</td>\n</tr>\n<tr>\n<td>demo-module05-environment</td>\n<td>子工程</td>\n<td>框架环境所需依赖</td>\n</tr>\n<tr>\n<td>demo-module06-generate</td>\n<td>子工程</td>\n<td>Mybatis 逆向工程</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"对各个工程进行说明：\">对各个工程进行说明：</h4>\n<blockquote>\n<p>01：web工程</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303070007855.png\" alt=\"image-20230307000750824\" style=\"zoom:25%;\">\n<p>02：组件工程</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303062353846.png\" alt=\"image-20230306235321808\" style=\"zoom:25%;\">\n<p>03：实体类工程</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303062353715.png\" alt=\"image-20230306235341682\" style=\"zoom:25%;\">\n<p>04：工具类工程</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303062353333.png\" alt=\"image-20230306235359297\" style=\"zoom:25%;\">\n<p>05：环境工程</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303062354749.png\" alt=\"image-20230306235417706\" style=\"zoom:25%;\">\n<p>06：逆向工程</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303062354846.png\" alt=\"image-20230306235440808\" style=\"zoom:25%;\">\n</blockquote>\n<h3 id=\"2、在各工程中的pom-xml中加上对应的依赖\">2、在各工程中的pom.xml中加上对应的依赖</h3>\n<blockquote>\n<p>01：web工程：</p>\n<!--junit5    Spring 的测试功能-->\n<p>02：组件工程</p>\n<!--ServletAPI-->\n<p>03：实体类工程</p>\n<p>\\</p>\n<p>04：工具类工程</p>\n<p>\\</p>\n<p>05：环境工程</p>\n<!-- 数据源  MySQL驱动  Mybatis核心  Mybatis 和 Spring 的整合包 Spring5和Thymeleaf整合包 日志  Spring 持久化层所需依赖  SpringMVC -->  \n<p>06：逆向工程</p>\n<!--  依赖MyBatis核心包 逆向工程的核心依赖  数据库连接池    MySQL驱动 -->  \n</blockquote>\n<h3 id=\"3、建立数据库的表\">3、建立数据库的表</h3>\n<h3 id=\"4、Mybatis逆向工程生成文件\">4、Mybatis逆向工程生成文件</h3>\n<blockquote>\n<p>01：web工程</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303070007731.png\" alt=\"image-20230307000728708\" style=\"zoom:25%;\">\n<p>02：组件工程</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303070016090.png\" alt=\"image-20230307001642065\" style=\"zoom:25%;\">\n<p>03：实体类工程(Mybatis 逆向工程生成的实体类只有字段和 get、set 方法，我们可以自己添加无参构造器、有参构造器、toString() 方法。)</p>\n<img src=\"https://gitee.com/Ryang1118/typora/raw/master/images/202303070017070.png\" alt=\"image-20230307001712042\" style=\"zoom:25%;\">\n<p>04：工具类工程</p>\n<p>\\</p>\n<p>05：环境工程</p>\n<p>\\</p>\n<p>06：逆向工程</p>\n<p>\\</p>\n</blockquote>\n<h3 id=\"5、配置jdbc-properties\">5、配置jdbc.properties</h3>\n<h3 id=\"6、配置Spring-xml\">6、配置Spring.xml</h3>\n<h3 id=\"7、配置web-xml\">7、配置web.xml</h3>\n<h3 id=\"8、配置SpringMVC-xml\">8、配置SpringMVC.xml</h3>\n<h3 id=\"9、配置logback-xml\">9、配置logback.xml</h3>\n<p>5、6、7、8、9配置内容见SSM整合部分 这几个配置文件都在<code>…….01-web/src/main/resources</code>下</p>\n<p><code>前端页面</code>和<code>测试代码</code>以及<code>Mybatis逆向工程创建的XXMapper.xml</code>也在<strong>01web</strong>目录下</p>\n<h3 id=\"10、在工具类工程放Exception、Const、MD5Util类\">10、在工具类工程放Exception、Const、MD5Util类</h3>\n<p>上述文件在<strong>04-uti</strong>l中</p>\n<h3 id=\"11、业务功能Controller\">11、业务功能Controller</h3>\n<p>controller自动注入(@Autowrite)Service，Service会r自动注入(@Autowrite)XXMapper,Service层会直接调用逆向工程的QBC查询方式进行查询</p>\n<p><code>业务功能的实现</code> <code>Service层</code> <code>ServiceImpl层``逆向工程生成的Mapper接口</code>都是在<strong>02-component</strong>工程中的</p>\n<p><strong>03-entity</strong>  中的是<code>数据库表对应的实体类(由逆向工程自动生成的)</code></p>\n<p><strong>05-environment</strong>无内容</p>\n<p><strong>06-generate</strong>是<code>逆向工程生成需要的的配置文件</code>和<code>执行改配置文件之后生成的entity、xxMapper.xml、xxMapper.java</code></p>\n","_path":"post/7273cdc.html","_link":"http://rycan.top/post/7273cdc.html","_id":"clkuj5ex80007sg0p0q580chk"}}