{"type":"getPostByPath","data":{"title":"策略模式","date":"2023-11-03T13:41:51.000Z","description":"设计模式","categories":[{"name":"设计模式","_id":"cloioo9ek006pni0p4yn52heq"}],"tags":[{"name":"设计模式","_id":"cloioo9es009hni0p7ldzhmzb"}],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n<h2 id=\"策略模式\">策略模式</h2>\n<p>一种行为设计模式: 将不同的策略放在不同的实现类中，可以进行互相替换；</p>\n<h3 id=\"作用：\">作用：</h3>\n<p>减少对原代码的修改，避免之后对代码扩展时可能产生的风险，提高代码的扩展性。</p>\n<h3 id=\"组成：\">组成：</h3>\n<ul>\n<li>\n<p>策略接口: 所有策略的通用接口，声明了一个用于执行策略的方法</p>\n</li>\n<li>\n<p>具体策略：所有算法策略的实体</p>\n</li>\n<li>\n<p>上下文：使用一个成员变量对不同的策略类进行引用，上下文不执行任务（不选择算法），只是将工作<code>委派</code>给策略对象，独立于具体的策略</p>\n</li>\n<li>\n<p>客户端：创建特定的策略对象并使用上下文进行传递</p>\n</li>\n</ul>\n<h3 id=\"使用场景：\">使用场景：</h3>\n<ul>\n<li>使用不同的算法的变体，并希望能在运行时切换算法</li>\n<li>仅仅是在执行行为的时候有很多相似的类</li>\n<li>算法的上下文逻辑不是特别重要的时候，使用此模式可以将业务逻辑与算法实现的细节隔离</li>\n</ul>\n<h4 id=\"优点：\">优点：</h4>\n<ul>\n<li>符合 <code>开闭原则</code>，无需对上下文进行修改就可以引入新的策略</li>\n<li>符合 <code>使用组合代替继承 </code>，可以将算法的实现和使用进行隔离，运行时可以切换对象内的算法</li>\n</ul>\n<h4 id=\"缺点：\">缺点：</h4>\n<ul>\n<li>可能会是代码复杂化</li>\n<li>客户端必须知道所有的策略</li>\n</ul>\n<h4 id=\"相似模式：\">相似模式：</h4>\n<p>==桥接、状态==（视为策略模式的扩展，基于组合模式）==、适配器==——基于组合模式；==命令==模式——可以通过行为进行参数化对象。</p>\n<h4 id=\"区别的模式：\">区别的模式：</h4>\n<ul>\n<li>\n<p>==模板==方法模式基于继承机制；通过扩展子类中的部分内容来改变部分算法；是静态的</p>\n</li>\n<li>\n<p>==策略==则是基于组合机制： 你可以通过对相应行为提供不同的策略来改变对象的部分行为；可以运行时切换，是动态的</p>\n</li>\n</ul>\n<h4 id=\"使用的实际案例\">使用的实际案例:</h4>\n<ul>\n<li>对 <code>java.util.Comparator#compare()</code> 的调用来自 <code>Collections#sort()</code>.</li>\n<li><code>javax.servlet.http.HttpServlet</code>：  <code>service­()</code>方法， 还有所有接受 <code>Http­Servlet­Request</code>和 <code>Http­Servlet­Response</code>对象作为参数的 <code>do­XXX()</code>方法。</li>\n<li><code>javax.servlet.Filter#doFilter()</code>:</li>\n</ul>\n<h3 id=\"使用\">使用</h3>\n<h4 id=\"Context\">Context</h4>\n<blockquote>\n<p>持有策略接口的引用</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ry.learning.study.pattern.Stategies.Context;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ry.learning.study.pattern.Stategies.Strategy.PayStrategy;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PriceContext</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> PayStrategy payStrategy;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">getPriceInfo</span><span class=\"params\">(<span class=\"type\">double</span> priceInfo)</span>&#123;</span><br><span class=\"line\">        payStrategy.payForWho();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> payStrategy.collectionPaymentDetail(priceInfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setPayStrategy</span><span class=\"params\">(PayStrategy payStrategy)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.payStrategy = payStrategy;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"策略的抽象类\">策略的抽象类</h4>\n<blockquote>\n<p>策略的接口，所有的实现方法的抽象</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ry.learning.study.pattern.Stategies.Strategy;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">PayStrategy</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">payForWho</span><span class=\"params\">()</span>;</span><br><span class=\"line\">    <span class=\"type\">double</span>  <span class=\"title function_\">collectionPaymentDetail</span><span class=\"params\">(<span class=\"type\">double</span> payment)</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"策略的实现类\">策略的实现类</h4>\n<blockquote>\n<p>策略的实现类以及所有的实现方法的具体实现</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ry.learning.study.pattern.Stategies.Strategy;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">VIPPayStrategy</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">PayStrategy</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">payForWho</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;VIP strategy&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">collectionPaymentDetail</span><span class=\"params\">(<span class=\"type\">double</span> payment)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>  payment * <span class=\"number\">0.8</span> ;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ry.learning.study.pattern.Stategies.Strategy;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ComPayStrategy</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">PayStrategy</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">payForWho</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Com strategy&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">collectionPaymentDetail</span><span class=\"params\">(<span class=\"type\">double</span> payment)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>  payment * <span class=\"number\">0.95</span> ;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"Client\">Client</h4>\n<blockquote>\n<p>使用Context  对上下问进行不同策略的定制</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ry.learning.study.pattern.Stategies;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ry.learning.study.pattern.Stategies.Context.PriceContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ry.learning.study.pattern.Stategies.Strategy.ComPayStrategy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ry.learning.study.pattern.Stategies.Strategy.VIPPayStrategy;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">double</span> <span class=\"variable\">originprice</span> <span class=\"operator\">=</span> <span class=\"number\">99.9</span>;</span><br><span class=\"line\">        <span class=\"type\">PriceContext</span> <span class=\"variable\">priceContext</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PriceContext</span>();</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">double</span> <span class=\"variable\">comPrice</span> <span class=\"operator\">=</span> <span class=\"number\">0.0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">BufferedReader</span> <span class=\"variable\">bufferedReader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BufferedReader</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">InputStreamReader</span>(System.in));</span><br><span class=\"line\">            s = bufferedReader.readLine();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (s.equals(<span class=\"string\">&quot;1&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//策略一：</span></span><br><span class=\"line\">            <span class=\"type\">ComPayStrategy</span> <span class=\"variable\">comPayStrategy</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ComPayStrategy</span>();</span><br><span class=\"line\">            priceContext.setPayStrategy(comPayStrategy);</span><br><span class=\"line\">            comPrice = comPayStrategy.collectionPaymentDetail(originprice);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;使用策略一：普通用户的到手价：&quot;</span> + comPrice);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//策略二：</span></span><br><span class=\"line\">            <span class=\"type\">VIPPayStrategy</span> <span class=\"variable\">vipPayStrategy</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">VIPPayStrategy</span>();</span><br><span class=\"line\">            priceContext.setPayStrategy(vipPayStrategy);</span><br><span class=\"line\">            <span class=\"type\">double</span> <span class=\"variable\">vipPrice</span> <span class=\"operator\">=</span> vipPayStrategy.collectionPaymentDetail(originprice);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;使用策略二：vip用户的到手价：&quot;</span> + vipPrice);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"结果\">结果</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1</span><br><span class=\"line\">使用策略一：普通用户的到手价：94.905</span><br><span class=\"line\"></span><br><span class=\"line\">2</span><br><span class=\"line\">使用策略二：vip用户的到手价：79.92000000000002</span><br></pre></td></tr></table></figure>\n<h4 id=\"结构\">结构</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── Client.java\t\t\t\t\t\t\t\t--  Client</span><br><span class=\"line\">├── Context\t\t</span><br><span class=\"line\">│   └── PriceContext.java\t\t\t--  Context</span><br><span class=\"line\">└── Strategy</span><br><span class=\"line\">    ├── ComPayStrategy.java   --  具体策略类</span><br><span class=\"line\">    ├── PayStrategy.java\t\t\t--  策略接口</span><br><span class=\"line\">    └── VIPPayStrategy.java   --  具体策略类</span><br></pre></td></tr></table></figure>\n","_path":"post/72e3b671.html","_link":"http://rycan.top/post/72e3b671.html","_id":"cloioo9ej006mni0p8uq83rez"}}