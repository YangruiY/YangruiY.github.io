{"type":"getPostByPath","data":{"title":"AOP切面","date":"2023-11-03T13:40:27.000Z","description":"AOP实现日志打印的功能","categories":[{"name":"AOP","_id":"cloioo9dh0004ni0p6vg49tep"}],"tags":[{"name":"AOP","_id":"cloioo9di0005ni0pacedb5q7"}],"content":"<meta name=\"referrer\" content=\"no-referrer\">\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 自定义注解接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span> <span class=\"comment\">// 表示被注解的元素在编译之后是否可用以及合适可用，RetentionPolicy.RUNTIME 表示的是在运行时保留，可以通过反射机制获取</span></span><br><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.METHOD&#125;)</span> <span class=\"comment\">//表示指定的注解可以应用于哪些元素，ElementType.METHOD 表示注解可以应用于方法上</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> SystemLog &#123;</span><br><span class=\"line\">    String <span class=\"title function_\">logging</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"定义和实现-日志切面\">定义和实现  日志切面</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 定义和实现  日志切面</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Aspect</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Lazy(value = false)</span></span><br><span class=\"line\"><span class=\"comment\">// @Lazy 注解:容器一般都会在启动的时候实例化所有单实例 bean，</span></span><br><span class=\"line\"><span class=\"comment\">// 如果我们想要 Spring 在启动的时候延迟加载 bean，需要用到这个注解</span></span><br><span class=\"line\"><span class=\"comment\">// value为true、false 默认为true,即延迟加载，</span></span><br><span class=\"line\"><span class=\"comment\">// @Lazy(false)表示对象会在初始化的时候创建</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AopAspectJ</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 定义切入点</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Pointcut(&quot;@annotation(com.ry.learning.study.demos.Aop.SystemLog)&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">cutMethod</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 前置通知：在目标方法执行前调用</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Before(&quot;cutMethod()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">before</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====@BEFORE=======before======&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 后置通知：在目标方法执行后调用，若目标方法出现异常，则不执行</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@AfterReturning(&quot;cutMethod()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">afterReturning</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====@AfterReturning=======AfterReturning======&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 后置/最终通知：无论目标方法在执行过程中出现一场都会在它之后调用</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@After(&quot;cutMethod()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">after</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;==@after==after&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 异常通知：目标方法抛出异常时执行</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@AfterThrowing(&quot;cutMethod()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">afterThrowing</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;==@AfterThrowing==AfterThrowing&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 环绕通知：灵活自由的在目标方法中切入代码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> joinPoint</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Around(&quot;cutMethod()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">printLog</span><span class=\"params\">(ProceedingJoinPoint joinPoint)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">process</span>  <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            handleBefore(joinPoint);</span><br><span class=\"line\">            <span class=\"comment\">// 执行 源方法</span></span><br><span class=\"line\">            process = joinPoint.proceed();</span><br><span class=\"line\">            handleAfter(process);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;=====printLog__finally=====&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>  process;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleBefore</span><span class=\"params\">(ProceedingJoinPoint process)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// log.info(&quot;===== Before打印日志 &#123;&#125;=====&quot;, JSON.toJSONString(process));</span></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;===== Before打印日志 &#123;&#125;=====&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">ServletRequestAttributes</span>  <span class=\"variable\">req</span> <span class=\"operator\">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> req.getRequest();</span><br><span class=\"line\">        <span class=\"type\">SystemLog</span> <span class=\"variable\">systemLog</span> <span class=\"operator\">=</span> getSystemLog(process);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;controller 的全类名 &#123;&#125;, 执行的方法的名称&#123;&#125;&quot;</span>,process.getSignature().getDeclaringTypeName(),process.getSignature().getName());</span><br><span class=\"line\">       <span class=\"comment\">// log.info(&quot;====打印请求的参数====&#123;&#125;&quot;,JSON.toJSONString(process.getArgs()));</span></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====打印请求的参数====&#123;&#125;&quot;</span>,process.getArgs());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====Start====&quot;</span>);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====URL==== &#123;&#125;&quot;</span>,request.getRequestURL());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====URI====&#123;&#125;&quot;</span>,request.getRequestURI());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====PathInfo====&#123;&#125;&quot;</span>,request.getPathInfo());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====AuthType====&#123;&#125;&quot;</span>,request.getAuthType());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====Method====&#123;&#125;&quot;</span>,request.getMethod());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====Cookies====&#123;&#125;&quot;</span>, (Object) request.getCookies());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====IP====&#123;&#125;&quot;</span>,request.getRemoteHost());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot; 描述信息logging   : &#123;&#125;&quot;</span> ,systemLog.logging());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> SystemLog <span class=\"title function_\">getSystemLog</span><span class=\"params\">(ProceedingJoinPoint process)</span> <span class=\"keyword\">throws</span> NoSuchMethodException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// process 可以用于获取关于正在执行的方法的信息</span></span><br><span class=\"line\">        <span class=\"comment\">// MethodSignature 提供了方法：getSignature 可以获取到正在执行的方法的签名信息</span></span><br><span class=\"line\">        <span class=\"type\">MethodSignature</span> <span class=\"variable\">signature</span> <span class=\"operator\">=</span> (MethodSignature)process.getSignature();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//获取方法名</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">methodName</span>  <span class=\"operator\">=</span> signature.getName();</span><br><span class=\"line\">        <span class=\"comment\">//反射获取目标类</span></span><br><span class=\"line\">        Class&lt;?&gt; aClass = process.getTarget().getClass();</span><br><span class=\"line\">        <span class=\"comment\">//拿到方法对应的参数类型</span></span><br><span class=\"line\">        Class[] parameterTypes = ((MethodSignature) process.getSignature()).getParameterTypes();</span><br><span class=\"line\">        <span class=\"type\">Method</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> aClass.getMethod(methodName, parameterTypes);</span><br><span class=\"line\">        <span class=\"comment\">// 获取 signature 方法  的 自定义注解 的  实例</span></span><br><span class=\"line\">        <span class=\"type\">SystemLog</span> <span class=\"variable\">systemLog</span> <span class=\"operator\">=</span> method.getAnnotation(SystemLog.class);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> systemLog;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleAfter</span><span class=\"params\">(Object process)</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//  log.info(&quot;===== After打印日志 &#123;&#125;=====&quot;, JSON.toJSONString(process));</span></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;====After 打印日志=====&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"调用切面类\">调用切面类</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 调用切面类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AopServiceImpl</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@SystemLog(logging = &quot;rycan&quot;)</span>   <span class=\"comment\">// 这里可以放在任何想要打印日志的地方</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loggerApply</span><span class=\"params\">(String name)</span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;rycan &#123;&#125;&quot;</span>, name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"测试方式一\">测试方式一</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AopController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    AopServiceImpl aopService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/aop&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">reqHunterAnno</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        aopService.loggerApply(<span class=\"string\">&quot;rycan&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello rycan!!&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"结果\">结果</h2>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2023-10-18 22:23:34.097  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ===== Before打印日志 &#123;&#125;=====</span><br><span class=\"line\">2023-10-18 22:23:34.098  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : controller 的全类名 com.ry.learning.study.demos.Aop.AopServiceImpl, 执行的方法的名称loggerApply</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====打印请求的参数====rycan</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====Start====</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====URL==== http://localhost:8080/aop</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====URI====/aop</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====PathInfo====null</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====AuthType====null</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====Method====GET</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====Cookies====null</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====IP====0:0:0:0:0:0:0:1</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  :  描述信息logging   : yangrui</span><br><span class=\"line\">2023-10-18 22:23:34.099  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====@BEFORE=======before======</span><br><span class=\"line\">2023-10-18 22:23:34.105  INFO 48136 --- [nio-8080-exec-1] c.r.l.study.demos.Aop.AopServiceImpl     : rycan rycan</span><br><span class=\"line\">2023-10-18 22:23:34.105  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====@AfterReturning=======AfterReturning======</span><br><span class=\"line\">2023-10-18 22:23:34.105  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ==@after==after</span><br><span class=\"line\">2023-10-18 22:23:34.105  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : ====After 打印日志=====</span><br><span class=\"line\">2023-10-18 22:23:34.105  INFO 48136 --- [nio-8080-exec-1] c.r.learning.study.demos.Aop.AopAspectJ  : =====printLog__finally=====</span><br></pre></td></tr></table></figure>\n<h2 id=\"测试方式二\">测试方式二</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 测试代码</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AopControllerTest</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> AopServiceImpl aopService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">aop</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;event&quot;</span>;</span><br><span class=\"line\">            aopService.loggerApply(aop);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"结果-2\">结果</h2>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2023-10-18 22:26:28.223  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ===== Before打印日志 &#123;&#125;=====</span><br><span class=\"line\">2023-10-18 22:26:28.223  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : controller 的全类名 com.ry.learning.study.demos.Aop.AopServiceImpl, 执行的方法的名称loggerApply</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====打印请求的参数====event</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====Start====</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====URL==== http://localhost</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====URI====</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====PathInfo====null</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====AuthType====null</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====Method====</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====Cookies====null</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====IP====localhost</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  :  描述信息logging   : yangrui</span><br><span class=\"line\">2023-10-18 22:26:28.224  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====@BEFORE=======before======</span><br><span class=\"line\">2023-10-18 22:26:28.229  INFO 48209 --- [           main] c.r.l.study.demos.Aop.AopServiceImpl     : rycan event</span><br><span class=\"line\">2023-10-18 22:26:28.229  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====@AfterReturning=======AfterReturning======</span><br><span class=\"line\">2023-10-18 22:26:28.229  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ==@after==after</span><br><span class=\"line\">2023-10-18 22:26:28.229  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : ====After 打印日志=====</span><br><span class=\"line\">2023-10-18 22:26:28.229  INFO 48209 --- [           main] c.r.learning.study.demos.Aop.AopAspectJ  : =====printLog__finally=====</span><br></pre></td></tr></table></figure>\n","_path":"post/111d1840.html","_link":"http://rycan.top/post/111d1840.html","_id":"cloioo9db0001ni0pheqvbjl0"}}